<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://xiongchun.github.io/blog</id>
    <title>程序员老熊的博客网站® Blog</title>
    <updated>2023-07-20T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://xiongchun.github.io/blog"/>
    <subtitle>程序员老熊的博客网站® Blog</subtitle>
    <icon>https://xiongchun.github.io/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[基于 Dubbo3 的 Triple 协议实现消息的流式通信]]></title>
        <id>dubbo/triple/stream_push</id>
        <link href="https://xiongchun.github.io/blog/dubbo/triple/stream_push"/>
        <updated>2023-07-20T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Apache Dubbo 的大版本 Dubbo3 发布有一段时间了。最近花时间看了一下，最为亮眼的就是推出了全新的基于 HTTP/2 且完全兼容 gRPC 的 Triple 通信协议。 Triple 协议使用 Protocol Buffers 作为序列化格式，但 Triple 实现并不绑定 IDL，比如你可以直接使用 Java Interface 定义和发布 Triple 服务。这想必是习惯了面向 Java 接口编程的用户的福音啊，否则每个服务都得去定义一个 IDL 的话就太繁琐了。Triple 协议完全兼容 gRPC 的意思就是说，Triple 消费端可以直接调用注册到 Dubbo 服务中心的 gRPC 提供者，gRPC的消费端也可以直接调用 Triple 提供者。（注意：Triple 协议自身并不依赖 gRPC, 只是协议实现上兼容了 gRPC 规范，Triple 仅依赖 protobuf-java 做序列化）]]></summary>
        <content type="html"><![CDATA[<p><a href="https://cn.dubbo.apache.org/en/" target="_blank" rel="noopener noreferrer">Apache Dubbo</a> 的大版本 Dubbo3 发布有一段时间了。最近花时间看了一下，最为亮眼的就是推出了全新的基于 HTTP/2 且完全兼容 gRPC 的 Triple 通信协议。 Triple 协议使用 Protocol Buffers 作为序列化格式，但 Triple 实现并不绑定 IDL，比如你可以直接使用 Java Interface 定义和发布 Triple 服务。这想必是习惯了面向 Java 接口编程的用户的福音啊，否则每个服务都得去定义一个 IDL 的话就太繁琐了。Triple 协议完全兼容 gRPC 的意思就是说，Triple 消费端可以直接调用注册到 Dubbo 服务中心的 gRPC 提供者，gRPC的消费端也可以直接调用 Triple 提供者。（注意：Triple 协议自身并不依赖 gRPC, 只是协议实现上兼容了 gRPC 规范，Triple 仅依赖 protobuf-java 做序列化）</p><blockquote><p>目前，Dubbo3 官方支持的通信协议有：基于 HTTP/2 的 Triple 协议 和 基于 TCP 的 Dubbo2 协议。除此之外，Dubbo 框架支持任意第三方通信协议，如官方支持的 gRPC、Thrift、REST、JsonRPC、Hessian2 等。更多协议可以通过自定义扩展实现。这对于微服务实践中经常要处理的多协议通信场景非常有用。</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="triple-请求模型">Triple 请求模型<a class="hash-link" href="#triple-请求模型" title="标题的直接链接">​</a></h2><ul><li>UNARY：传统的 Request/Response 一元调用。</li><li>SERVER_STREAM：服务端流推送。（服务端像客户端使用流的方式推送数据）</li><li>CLIENT_STREAM：客户端流推送。（客户端像服务端使用流的方式推送数据）</li><li>BIDIRECTIONAL_STREAM：双向流推送。（客户端和服务端互相使用流的方式推送数据）</li></ul><blockquote><p>注：CLIENT_STREAM 和 BIDIRECTIONAL_STREAM 是同一个实现方式，从后面的示例代码可以看出来。</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="stream-流式通信应用场景">Stream 流式通信应用场景<a class="hash-link" href="#stream-流式通信应用场景" title="标题的直接链接">​</a></h2><ul><li>接口需要发送大量数据。这些数据无法被放在一个 RPC 的请求或响应中，需要分批发送，但应用层如果按照传统的多次 RPC 方式无法解决顺序和性能的问题。</li><li>流式场景。数据需要按照发送顺序处理, 数据本身是没有确定边界的。</li><li>推送类场景，多个消息在同一个调用的上下文中被发送和处理。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="示例代码">示例代码<a class="hash-link" href="#示例代码" title="标题的直接链接">​</a></h2><blockquote><p>本实例使用接口声明的方式来定义服务，不使用 .proto IDL 文件。</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="相关组件依赖版本">相关组件依赖版本<a class="hash-link" href="#相关组件依赖版本" title="标题的直接链接">​</a></h3><ul><li>SpringBoot: 2.7.16 或 3.X</li><li>Nacos Server: 2.2.3</li><li>nacos-config-spring-boot-starter: 2.2.3</li><li>dubbo-spring-boot-starter: 3.2.7</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="关键配置信息">关键配置信息<a class="hash-link" href="#关键配置信息" title="标题的直接链接">​</a></h3><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Provider 配置</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Consumer 配置</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">dubbo</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">registry</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">address</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> nacos</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">10.141</span><span class="token number" style="color:#36acaa">.17</span><span class="token number" style="color:#36acaa">.143</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8848</span><span class="token operator" style="color:#393A34">?</span><span class="token plain">namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">username</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> nacos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">password</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> nacos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">protocol</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> tri</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">port</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">dubbo</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">registry</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">address</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> nacos</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">10.141</span><span class="token number" style="color:#36acaa">.17</span><span class="token number" style="color:#36acaa">.143</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8848</span><span class="token operator" style="color:#393A34">?</span><span class="token plain">namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">username</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> nacos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">password</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> nacos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">protocol</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> tri</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">port</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">application</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    qos</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">port</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">22224</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">consumer</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">check</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="服务接口定义">服务接口定义<a class="hash-link" href="#服务接口定义" title="标题的直接链接">​</a></h3><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// UNARY 传统一元调用（request / response）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token known-class-name class-name">String</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">greet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token known-class-name class-name">String</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//SERVER_STREAM 服务端推送</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">greetServerStream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token known-class-name class-name">String</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token maybe-class-name">StreamObserver</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">String</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> response);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">// BIDIRECTIONAL_STREAM / CLIENT_STREAM 客户端流推送和双向流推送</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">// !注意 入参为响应流 response；出参为请求流 request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">StreamObserver</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">String</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> greetStream(StreamObserver</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">String</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> response);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="服务接口实现provider端">服务接口实现（Provider端）<a class="hash-link" href="#服务接口实现provider端" title="标题的直接链接">​</a></h3><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:#d73a49">DubboService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"1.0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> group </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"temp_group"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">GreetServiceImpl</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">implements</span><span class="token plain"> </span><span class="token class-name">GreetService</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//public static Map&lt;String, StreamObserver&lt;String&gt;&gt; observerMap = Maps.newHashMap();</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// UNARY调用 REQUEST/RESPONSE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token maybe-class-name">Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">greet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter known-class-name class-name">String</span><span class="token parameter"> request</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Hi, "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 服务器端响应流推送</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token maybe-class-name">Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">greetServerStream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token known-class-name class-name">String</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token maybe-class-name">StreamObserver</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">String</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> response) </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">int i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">onNext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"响应流：hello, "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 如果想持续的对客户端推送，则别关闭这个response流，把response保存下来，在需要推送数据的时候触发response.onNext(）方法即可。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">onCompleted</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    // 请求流或双向流推送</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    public StreamObserver</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">String</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> greetStream(StreamObserver</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">String</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> response) </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 这里 new 的这个是请求流</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">StreamObserver</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">String</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">() </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            @</span><span class="token maybe-class-name">Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">onNext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter known-class-name class-name">String</span><span class="token parameter"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">onNext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"响应流: "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            @</span><span class="token maybe-class-name">Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">onError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter maybe-class-name">Throwable</span><span class="token parameter"> throwable</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                throwable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">printStackTrace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            @</span><span class="token maybe-class-name">Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">onCompleted</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// 检测到 Request 关闭则把 Response 也关闭，BI 双向流结束。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">onCompleted</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="服务接口调用consumer端">服务接口调用（Consumer端）<a class="hash-link" href="#服务接口调用consumer端" title="标题的直接链接">​</a></h3><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:#d73a49">DubboReference</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"1.0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> group </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"temp_provider"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token maybe-class-name">GreetService</span><span class="token plain"> tempService</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 传统一元调用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:#d73a49">RequestMapping</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/greet"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">greet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter maybe-class-name">HttpServletRequest</span><span class="token parameter"> request</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token known-class-name class-name">String</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tempService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">greet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"HY"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 服务端推送</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:#d73a49">PostMapping</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/greetServerStream"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">greetServerStream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter maybe-class-name">HttpServletRequest</span><span class="token parameter"> request</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token known-class-name class-name">String</span><span class="token plain"> clientId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getProperty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"clientId"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"N/A"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tempService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">greetServerStream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">clientId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">StdoutStreamObserver</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">("greetServerStream"));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">// 客户端推送 &amp; 双向推送</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">@PostMapping("/greetStream")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">public void greetStream() </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    final </span><span class="token maybe-class-name">StreamObserver</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">String</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> request = tempService.greetStream(new StdoutStreamObserver</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">("greetStream"));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    for (int i = 0; i &lt; 10; i++) </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">onNext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"请求流消息："</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">"Data From Client"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    request.onCompleted();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">@Slf4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">static class StdoutStreamObserver</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">T</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> implements StreamObserver</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">T</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> final </span><span class="token known-class-name class-name">String</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">StdoutStreamObserver</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter known-class-name class-name">String</span><span class="token parameter"> name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token maybe-class-name">Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">onNext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter constant" style="color:#36acaa">T</span><span class="token parameter"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"客户端收到来自服务端的推送信息:{}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token maybe-class-name">Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">onError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter maybe-class-name">Throwable</span><span class="token parameter"> throwable</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">throwable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getMessage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> throwable</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token maybe-class-name">Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">onCompleted</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"{} stream completed"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="总结-qa">总结 Q&amp;A<a class="hash-link" href="#总结-qa" title="标题的直接链接">​</a></h2><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1triple-协议使用-protobuf-进行序列化发布服务需要定义-proto-idl-文件吗">1.Triple 协议使用 protobuf 进行序列化，发布服务需要定义 .proto IDL 文件吗？<a class="hash-link" href="#1triple-协议使用-protobuf-进行序列化发布服务需要定义-proto-idl-文件吗" title="标题的直接链接">​</a></h4><p>答：可以这么做，但是没必要。这样比较繁琐也不符合我们Java面向接口的开发习惯。事实上，Dubbo框架已经做了包装，我们可以直接定义 Java 接口使用 POJO 的方式来发布服务。那什么时候才需要定义 .proto IDL 文件呢？当需要异构跨语言交互调用的时候才需要。（上述说法同时适用 Unary 调用和 Stream 调用）</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2上述实例中的流式推送都是使用-for-迭代输出模拟流式数据的推送迭代结束直接关闭流如何实现实际业务场景中的无边界定期等的流式推送功能">2.上述实例中的流式推送都是使用 for 迭代输出模拟流式数据的推送，迭代结束直接关闭流。如何实现实际业务场景中的无边界、定期等的流式推送功能？<a class="hash-link" href="#2上述实例中的流式推送都是使用-for-迭代输出模拟流式数据的推送迭代结束直接关闭流如何实现实际业务场景中的无边界定期等的流式推送功能" title="标题的直接链接">​</a></h4><p>答：只需要保存请求流或响应流对象，不调用 onComplete() 方法，然后就可以在想推送数据的时候调用其对应的onNext()方法来实现请求流或响应流的数据推送功能。（比如：当某个事件发生时，某个定时任务执行时等）</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="源代码获取">源代码获取<a class="hash-link" href="#源代码获取" title="标题的直接链接">​</a></h2><p>本实例为 <a href="https://pangu.pulanit.com" target="_blank" rel="noopener noreferrer">盘古开发框架</a> 范例集合中的一组范例。您可以通过如下链接获取全部范例源代码。<br>
<a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-dubbo-triple" target="_blank" rel="noopener noreferrer">https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-dubbo-triple</a></p>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="Dubbo3" term="Dubbo3"/>
        <category label="Triple" term="Triple"/>
        <category label="消息推送" term="消息推送"/>
        <category label="流式通信" term="流式通信"/>
        <category label="服务端开发" term="服务端开发"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[基于 Zipkin 和 OpenTelemetry Java Agent 实现系统调用链路跟踪]]></title>
        <id>observability/zipkin-opentelemetry-java-agent-tracing-quickstart</id>
        <link href="https://xiongchun.github.io/blog/observability/zipkin-opentelemetry-java-agent-tracing-quickstart"/>
        <updated>2023-07-16T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[本文介绍如何基于 Zipkin 和 OpenTelemetry Java Agent 搭架一个分布式链路调用跟踪的系统。它可以帮助我们有效收集一个请求调用链路过程并对链路节点数据进行分析和查找。可以结合 TraceID 和 Log 系统对问题根因进行溯源。同类竞品还有 Uber 开源的 Jaeger，感兴趣的同学可以自行研究。]]></summary>
        <content type="html"><![CDATA[<p>本文介绍如何基于 <a href="https://github.com/openzipkin/zipkin" target="_blank" rel="noopener noreferrer">Zipkin</a> 和 <a href="https://github.com/open-telemetry/opentelemetry-java-instrumentation" target="_blank" rel="noopener noreferrer">OpenTelemetry Java Agent</a> 搭架一个分布式链路调用跟踪的系统。它可以帮助我们有效收集一个请求调用链路过程并对链路节点数据进行分析和查找。可以结合 TraceID 和 Log 系统对问题根因进行溯源。同类竞品还有 Uber 开源的 <a href="https://www.jaegertracing.io/" target="_blank" rel="noopener noreferrer">Jaeger</a>，感兴趣的同学可以自行研究。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="背景">背景<a class="hash-link" href="#背景" title="标题的直接链接">​</a></h2><p>当前大部分系统都基于微服务模式开发，调用关系复杂多变，Observability（可观测性）就显得尤为重要。Observabilit 能让我们清晰的感知到系统当前的运行状态以及它曾经发生了什么。当有故障发生时，我们也可以借助 Observabilit 系统有效的快速定位问题根因并完成修复（这点尤其重要）。Observabilit 主要包括 traces、metrics 和 logs。今天，我们主要讨论 <strong>traces</strong>。</p><blockquote><p>业界把 Observability 翻译为 “可观测性”，本人略感生硬。本站相关文档将直接使用 Observability 单词，不再做中文对照翻译。</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="zipkin-系统架构图">Zipkin 系统架构图<a class="hash-link" href="#zipkin-系统架构图" title="标题的直接链接">​</a></h2><p>想要看明白 Zipkin 的全貌和工作原理，我们必须搞一个架构图出来。如下图所示。</p><img loading="lazy" width="600" src="/assets/images/54-zipkin-c6f5eb7a22f8ee8c0f9b7a15c4bdd3d3.png" alt="Zipkin系统架构图" class="img_ev3q"><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>看图说话</div><div class="admonitionContent_S0QG"><p>The component in an instrumented app that sends data to Zipkin is called a Exporter. Exporter send trace data via one of several transports to Zipkin collectors, which persist trace data to storage. Later, storage is queried by the API to provide data to the UI.</p></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="exporter">Exporter<a class="hash-link" href="#exporter" title="标题的直接链接">​</a></h4><p>指通过Agent或者SDK方式嵌入到了应用中采集并向 Collector 发送 Telemetry 数据能力的组件。Telemetry Data (traces、metrics 和 logs) 数据通过这个 Exporter 发送出去。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="transport">Transport<a class="hash-link" href="#transport" title="标题的直接链接">​</a></h4><p>主要支持三种遥测数据传输模式。HTTP、MQ（ActiveMQ、Kafka、RabbitMQ）、Scribe（NettyScribeServer）。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="collector">Collector<a class="hash-link" href="#collector" title="标题的直接链接">​</a></h4><p>Once the trace data arrives at the Zipkin collector daemon, it is validated, stored, and indexed for lookups by the Zipkin collector.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="storage">Storage<a class="hash-link" href="#storage" title="标题的直接链接">​</a></h4><p>数据存储方案。目前支持 4 种。内存模式、MySQL、ElasticSearch、Cassandra。后期有可能会支持 ClickHouse。内存模式只能用于开发测试、MySQL模式也只能用于开发测试和小规模生产体验。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="apiquery-service">API（Query Service）<a class="hash-link" href="#apiquery-service" title="标题的直接链接">​</a></h4><p>Once the data is stored and indexed, we need a way to extract it. The query daemon provides a simple JSON API for finding and retrieving traces. The primary consumer of this API is the Web UI.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="webui">WebUI<a class="hash-link" href="#webui" title="标题的直接链接">​</a></h4><p>The web UI provides a method for viewing traces based on service, time, and annotations.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装-zipkin-服务端">安装 Zipkin 服务端<a class="hash-link" href="#安装-zipkin-服务端" title="标题的直接链接">​</a></h2><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Java</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Docker</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Running from Source</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -sSL https://zipkin.io/quickstart.sh </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">bash</span><span class="token plain"> -s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java -jar zipkin.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -d -p </span><span class="token number" style="color:#36acaa">9411</span><span class="token plain">:9411 openzipkin/zipkin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># get the latest source</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/openzipkin/zipkin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> zipkin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Build the server and also make its dependencies</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./mvnw -DskipTests --also-make -pl zipkin-server clean </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Run the server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java -jar ./zipkin-server/target/zipkin-server-*exec.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p>为了快速体验，我们使用第一种安装方式：<code>java -jar zipkin.jar</code> 直接启动。这种模式是以内存存储你是启动的，不需要配置后端存储方案。启动后访问：<a href="http://127.0.0.1:9411/zipkin" target="_blank" rel="noopener noreferrer">http://127.0.0.1:9411/zipkin</a>。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装-exporter">安装 Exporter<a class="hash-link" href="#安装-exporter" title="标题的直接链接">​</a></h2><p>基于 OpenTelemetry Automatic Instrumentation 模式为例实现业务系统的数据遥测数据采集。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="下载-agent-安装包">下载 Agent 安装包<a class="hash-link" href="#下载-agent-安装包" title="标题的直接链接">​</a></h4><p>从 opentelemetry-java-instrumentation 官方版本发布页面找到最新的安装包下载。<a href="https://github.com/open-telemetry/opentelemetry-java-instrumentation/releases" target="_blank" rel="noopener noreferrer">opentelemetry-javaagent.jar
</a></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="将-agent-挂载的业务应用上并启动">将 Agent 挂载的业务应用上并启动<a class="hash-link" href="#将-agent-挂载的业务应用上并启动" title="标题的直接链接">​</a></h4><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">java </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">javaagent</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token maybe-class-name">Users</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">xc</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">apps</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">agent</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">opentelemetry</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">javaagent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jar</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token operator" style="color:#393A34">-</span><span class="token maybe-class-name">Dotel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">your</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">service</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">name \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token operator" style="color:#393A34">-</span><span class="token maybe-class-name">Dotel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">traces</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exporter</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">zipkin \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token operator" style="color:#393A34">-</span><span class="token maybe-class-name">Dotel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exporter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">zipkin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">endpoint</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">http</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">127.0</span><span class="token number" style="color:#36acaa">.0</span><span class="token number" style="color:#36acaa">.1</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">9411</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">api</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">v2</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">spans \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">jar myapp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>上述配置是通过 http 协议的方式来采集 Trace 数据，但实际生产环境建议使用 MQ 方式来采集。相关配置查阅 Zipkin 文档。</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="无图无真相">无图无真相<a class="hash-link" href="#无图无真相" title="标题的直接链接">​</a></h2><p>完成如上配置后，当我们操作业务系统就会有相应的链路跟踪数据进入到Zipkin。如下图所示：</p><p><img loading="lazy" alt="Zipkin分布式链路跟踪图" src="/assets/images/55-zipkin-4a1aec117444e8d522765fef3506fd52.png" width="2874" height="1576" class="img_ev3q"></p>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="可观测性" term="可观测性"/>
        <category label="服务端开发" term="服务端开发"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[基于 Seata AT 模式的分布式事务落地方案]]></title>
        <id>pangu-dev-framework-distributed-transaction</id>
        <link href="https://xiongchun.github.io/blog/pangu-dev-framework-distributed-transaction"/>
        <updated>2023-02-25T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[盘古开发框架 集成了事务中间件 Seata 来提供分布式事务管理功能。]]></summary>
        <content type="html"><![CDATA[<p><a href="https://github.com/xiongchun/pangu-framework" target="_blank" rel="noopener noreferrer">盘古开发框架</a> 集成了事务中间件 <a href="https://seata.io/en-us/index.html" target="_blank" rel="noopener noreferrer">Seata</a> 来提供分布式事务管理功能。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="事务概念">事务概念<a class="hash-link" href="#事务概念" title="标题的直接链接">​</a></h2><p>数据库事务需要满足 ACID（原子性、一致性、隔离性、持久性）四个特性。</p><ul><li><strong>原子性</strong>：指事务作为一个整体来执行，要么全都执行，要么全不执行。</li><li><strong>一致性</strong>：指事务应确保数据从一个一致的状态转变为另一个一致的状态。</li><li><strong>隔离性</strong>：指多个事务并发执行时，一个事务的执行不应影响其他事务的执行。</li><li><strong>持久性</strong>：指已提交事务修改的数据会被持久保存。</li></ul><p>在单一数据节点中，事务仅限于对单一数据库资源的访问控制，称之为本地事务。在基于 Spring 的开发中，我们一般使用 <code>@Transactional</code> 注解的声明式事务来管理。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="分布式事务概念">分布式事务概念<a class="hash-link" href="#分布式事务概念" title="标题的直接链接">​</a></h2><p>由于数据库的拆分或分布式架构（微服务）不可避免的带来了分布式事务的问题。如下为当前针对分布式事务的工程实践和处理方式。</p><ul><li><strong>基于业务逻辑和应用场景最小化分布式事务边界</strong><br>言外之意就是说应该在设计阶段尽可能规避没必要的分布式事务场景。</li><li><strong>基于 XA 的强一致性事务</strong><br>XA模式是传统的强一致性分布式事务解决方案，性能较低且锁资源竞争突出。在实际业务中使用较少，本文不做更多讨论。</li><li><strong>追求最终一致性的柔性事务</strong><br>柔性事务通过放宽对强一致性要求，而是通过反向补偿来达到最终一致性，同时换取系统吞吐量的提升和缓解锁资源竞争。目前，Seata 框架提供了多种事务管理模式来支持柔性事务的落地实现。（详见后续章节）</li></ul><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><b>快速 QA：</b>在单体架构的应用中也会有分布式事务吗？</summary><div><div class="collapsibleContent_i85q"><div>在常规情况下，我们在一个进程中操作一个数据库，这属于本地事务。但是，如果在一个进程中操作多个数据库，或者在多个进程中操作一个或多个数据库，就产生了分布式事务。可见，分布式事务并非微服务架构的产物，在单体应用中由于数据库的拆分也一样面临分布式事务的问题。</div></div></div></details><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="seata-分布式事务框架">Seata 分布式事务框架<a class="hash-link" href="#seata-分布式事务框架" title="标题的直接链接">​</a></h2><p><a href="https://seata.io/en-us/index.html" target="_blank" rel="noopener noreferrer">Seata</a> 是一款开源的分布式事务解决方案，致力于提供高性能和简单易用的分布式事务服务，为用户打造一站式的分布式解决方案。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="seata-专业术语">Seata 专业术语<a class="hash-link" href="#seata-专业术语" title="标题的直接链接">​</a></h3><ul><li><p><strong>事务协调者 TC</strong> ( Transaction Coordinator )<br>
<!-- -->维护全局和分支事务的状态，驱动全局事务提交或回滚。</p></li><li><p><strong>事务管理器 TM</strong> ( Transaction Manager )<br>
<!-- -->定义全局事务的范围，开始全局事务、提交或回滚全局事务。</p></li><li><p><strong>资源管理器 RM</strong> ( Resource Manager )<br>
<!-- -->管理分支事务处理的资源，与TC交谈以注册分支事务和报告分支事务的状态并驱动分支事务提交或回滚。</p></li></ul><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_S0QG"><p>其中，TC 是 Seata 服务端，需要独立部署。TM、RM 是嵌入应用侧的 Seata 客户端，通过动态代理后的 <code>DataSource</code> 和 <code>@GlobalTransactional</code> 注解实现。</p></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="seata-分布式事务模型">Seata 分布式事务模型<a class="hash-link" href="#seata-分布式事务模型" title="标题的直接链接">​</a></h3><p>一个分布式的全局事务，整体是『两阶段提交』的模型。如下图所示。</p><img loading="lazy" width="800" src="/assets/images/21-pangu-framework-transaction-c02dfba443c30af858aed9594119624a.png" alt="虚拟业务场景设计" class="img_ev3q"><p>Seata 为用户提供了 AT、TCC、SAGA 和 XA 四种事务模式。如下所述。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="at-模式">AT 模式<a class="hash-link" href="#at-模式" title="标题的直接链接">​</a></h3><p>AT（Automatic Transaction Mode） 模式下，Seata 会代理数据源，在执行业务 SQL 的时候解析 SQL 并生成必要的回滚日志到 <code>undo_log</code> 表，如果需要回滚事务，则根据混滚日志自动生成补偿操作。</p><ul><li>一阶段 prepare 行为：在本地事务中，一并提交业务数据更新和自动生成相应回滚日志记录。</li><li>二阶段 commit 行为：成功结束，自动异步批量清理回滚日志。</li><li>二阶段 rollback 行为：通过回滚日志，自动生成补偿操作，完成数据回滚。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="tcc-模式">TCC 模式<a class="hash-link" href="#tcc-模式" title="标题的直接链接">​</a></h3><p>TCC （Manual Transaction Mode） 模式也可以简单的认为是 MT 模式，即手动模式。TCC 模式的作用范围在应用层，依赖用户自行实现的3个方法「try()、confirm()、cancel()」。本质上是实现针对某种业务逻辑的正向和反向方法，成本较大。</p><ul><li>一阶段 prepare 行为：调用<strong>自定义</strong>的 prepare 逻辑。</li><li>二阶段 commit 行为：调用<strong>自定义</strong>的 commit 逻辑。</li><li>二阶段 rollback 行为：调用<strong>自定义</strong>的 rollback 逻辑。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="其它模式">其它模式<a class="hash-link" href="#其它模式" title="标题的直接链接">​</a></h3><p>本文不再对 Seata 提供的 SAGA 和 XA 事务模式进行描述。</p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Seata 事务和 XA 事务对比</div><div class="admonitionContent_S0QG"><p>本质上，Seata 的3大事务模式（ AT、TCC、SAGA ）都是补偿型的。事务处理机制构建在框架自身或业务应用中。事务资源（数据库等）本身对分布式事务是无感知的。而在 XA 模式下，是有感知的，相应事务资源需要实现对 XA 协议的支持，以 XA 协议的机制来管理分支事务。</p></div></div><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>建议</div><div class="admonitionContent_S0QG"><p>目前，我们认为 Seata 框架的 AT 模式在并发性能、易用性、成熟度等方面达到了一个很好的平衡。因此，在盘古开发分布式事务场景下，我们将 AT 模式作为默认方案，把 TCC 模式作为补充方案。</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="虚拟业务场景设计">虚拟业务场景设计<a class="hash-link" href="#虚拟业务场景设计" title="标题的直接链接">​</a></h2><p>为了能直观的模拟分布式事务，我们特设计如下用户购买商品的虚拟业务场景。整个业务逻辑由如下3个微服务提供支持。</p><ul><li><strong>仓储服务</strong>：对给定的商品扣除仓储数量。</li><li><strong>订单服务</strong>：根据采购需求创建订单。</li><li><strong>帐户服务</strong>：从用户帐户中扣除余额。</li></ul><p>虚拟业务调用结构图如下所示。</p><img loading="lazy" width="600" src="/assets/images/22-pangu-framework-transaction-190957fc781870e0624bc1047213aa5b.png" alt="虚拟业务场景设计" class="img_ev3q"><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">订单服务接口定义</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">账户服务接口定义</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">库存服务接口定义</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">OrderService</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * 创建订单</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * @param buyDto</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createOrder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">BuyDto</span><span class="token plain"> buyDto</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">AccountService</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * 扣减账户余额</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * @param buyDto</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">decreaseAccount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">BuyDto</span><span class="token plain"> buyDto</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">StockService</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * 扣减库存</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * @param buyDto</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">decreaseStock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">BuyDto</span><span class="token plain"> buyDto</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="编程实战at-模式">编程实战（AT 模式）<a class="hash-link" href="#编程实战at-模式" title="标题的直接链接">​</a></h2><p>如下为在盘古框架下基于 Seata 框架 AT 模式的编程实战。分别创建如下几个微服务模块。</p><ul><li>pangu-examples-seata-at-api：服务接口包</li><li>pangu-examples-seata-at-order：订单微服务</li><li>pangu-examples-seata-at-account：账户微服务</li><li>pangu-examples-seata-at-stock：库存微服务</li><li>pangu-examples-seata-at-main：商品购买业务模块</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="初始化数据库环境">初始化数据库环境<a class="hash-link" href="#初始化数据库环境" title="标题的直接链接">​</a></h3><blockquote><p>在真实环境中，订单服务、账户服务、库存服务有可能是分别对应不同的三个数据库。但本文范例为了简便，将使用同一个数据库。但订单、账户、库存分属不通的微服务模块，使用不通的数据源对象，来达到模拟分布式事务测试效果。</p></blockquote><p>Seata 的 AT 模式依赖回滚日志完成业务反向补偿，因此每个业务库中都需要增加一个 <code>undo_log</code> 回滚日志表。</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">回滚日志表 DDL</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">订单表 DDL</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">账户表 DDL</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">库存表 DDL</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">CREATE</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">TABLE</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">undo_log</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">id</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">bigint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NOT</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">AUTO_INCREMENT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">branch_id</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">bigint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NOT</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">xid</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NOT</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">context</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">128</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NOT</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">rollback_info</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> longblob </span><span class="token constant" style="color:#36acaa">NOT</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">log_status</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NOT</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">log_created</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> datetime </span><span class="token constant" style="color:#36acaa">NOT</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">log_modified</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> datetime </span><span class="token constant" style="color:#36acaa">NOT</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">ext</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DEFAULT</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token constant" style="color:#36acaa">PRIMARY</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">id</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token constant" style="color:#36acaa">UNIQUE</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">KEY</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">ux_undo_log</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">xid</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">branch_id</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ENGINE</span><span class="token operator" style="color:#393A34">=</span><span class="token maybe-class-name">InnoDB</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">AUTO_INCREMENT</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DEFAULT</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CHARSET</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">utf8</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">CREATE</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">TABLE</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">order</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">id</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NOT</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">AUTO_INCREMENT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">user_id</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DEFAULT</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">commodity_code</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DEFAULT</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">count</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'0'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">money</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'0'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token constant" style="color:#36acaa">PRIMARY</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">id</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ENGINE</span><span class="token operator" style="color:#393A34">=</span><span class="token maybe-class-name">InnoDB</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">AUTO_INCREMENT</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DEFAULT</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CHARSET</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">utf8</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">CREATE</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">TABLE</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">account</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">id</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NOT</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">AUTO_INCREMENT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">user_id</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DEFAULT</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">money</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'0'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token constant" style="color:#36acaa">PRIMARY</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">id</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token constant" style="color:#36acaa">UNIQUE</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">KEY</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">user_id</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">user_id</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ENGINE</span><span class="token operator" style="color:#393A34">=</span><span class="token maybe-class-name">InnoDB</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">AUTO_INCREMENT</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DEFAULT</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CHARSET</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">utf8</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">INSERT</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">INTO</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">account</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">id</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">user_id</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">money</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'U001'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">CREATE</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">TABLE</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">stock</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">id</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NOT</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">AUTO_INCREMENT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">commodity_code</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DEFAULT</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">count</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'0'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token constant" style="color:#36acaa">PRIMARY</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">id</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token constant" style="color:#36acaa">UNIQUE</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">KEY</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">commodity_code</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">commodity_code</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ENGINE</span><span class="token operator" style="color:#393A34">=</span><span class="token maybe-class-name">InnoDB</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">AUTO_INCREMENT</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DEFAULT</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CHARSET</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">utf8</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">INSERT</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">INTO</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">stock</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">id</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">commodity_code</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">count</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'C001'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装相关盘古模块">安装相关盘古模块<a class="hash-link" href="#安装相关盘古模块" title="标题的直接链接">​</a></h3><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">盘古 Parent</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">基础模块</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">JDBC 模块</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Dubbo 模块</li><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Seata 事务模块</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-parent</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">latest.version.xxx</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">relativePath</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-jdbc-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-dubbo-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6"><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-seata-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本地配置">本地配置<a class="hash-link" href="#本地配置" title="标题的直接链接">​</a></h3><blockquote><p>为便于理解，本文基于本地配置的方式编写。若改为标准的 Nacos 配置中心模式，请参阅：<a href="https://xiongchun.github.io/pangu-framework/docs/advanced-guide/nacos-config-center" target="_blank" rel="noopener noreferrer">配置中心</a> 章节。</p></blockquote><p>如下配置以 <code>pangu-examples-seata-at-order</code> 模块为例，其它模块类似。</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">application.properties</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">application-dev.properties</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">profiles</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">active</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">profiles</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">active</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">dev</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">application</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">seata</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">at</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">order</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">protocol</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">dubbo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">protocol</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">port</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">protocol</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">20882</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">consumer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">registry</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">address</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nacos</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">nacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">server</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">addr</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">?</span><span class="token plain">namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">nacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">namespace</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">consumer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">check</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">seata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">enabled</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">seata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">disable</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">global</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">transaction</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">seata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">tx</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">service</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">group</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">test</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">seata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">vgroup</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">mapping</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">test</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">group</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">seata</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">seata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">grouplist</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">seata</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">server</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">127.0</span><span class="token number" style="color:#36acaa">.0</span><span class="token number" style="color:#36acaa">.1</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8091</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">seata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">seata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">registry</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">zaxxer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">hikari</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">HikariDataSource</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">driver</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">class</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jdbc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">url</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">jdbc</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">localhost</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3306</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">?</span><span class="token plain">useUnicode</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">true</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">characterEncoding</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">utf</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">8</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">autoReconnect</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">true</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">failOverReadOnly</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">false</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">allowMultiQueries</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">true</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">useSSL</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">false</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rewriteBatchedStatements</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">username</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">password</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">root123456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mybatis</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mapperLocations</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">classpath</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mapper</span><span class="token comment" style="color:#999988;font-style:italic">/**/</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">xml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mybatis</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">configuration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">log</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">impl</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">org</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">apache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ibatis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">stdout</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">StdOutImpl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pangu</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jdbc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">db</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">root</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">gitee</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pulanos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pangu</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">INFO</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="关键配置项说明">关键配置项说明<a class="hash-link" href="#关键配置项说明" title="标题的直接链接">​</a></h4><ul><li>seata.service.grouplist.seata-server<br>Seata Server （事务协调者 TC ）的通讯地址。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="主要业务逻辑">主要业务逻辑<a class="hash-link" href="#主要业务逻辑" title="标题的直接链接">​</a></h3><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">购买商品业务代码</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">订单服务接口实现</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">账户服务接口实现</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">库存服务接口实现</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">Component</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">MainBizService</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token function maybe-class-name" style="color:#d73a49">Reference</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"1.0.0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> group </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"pangu-examples-seata-at-account"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token maybe-class-name">AccountService</span><span class="token plain"> accountService</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token function maybe-class-name" style="color:#d73a49">Reference</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"1.0.0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> group </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"pangu-examples-seata-at-order"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token maybe-class-name">OrderService</span><span class="token plain"> orderService</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token function maybe-class-name" style="color:#d73a49">Reference</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"1.0.0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> group </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"pangu-examples-seata-at-stock"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token maybe-class-name">StockService</span><span class="token plain"> stockService</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//此注解开启全局事务管理器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token maybe-class-name">GlobalTransactional</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">buyItems</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter maybe-class-name">BuyDto</span><span class="token parameter"> buyDto</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        orderService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createOrder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buyDto</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        accountService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">decreaseAccount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buyDto</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stockService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">decreaseStock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buyDto</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:#d73a49">Service</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"1.0.0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> group </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"pangu-examples-seata-at-order"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">OrderServiceImpl</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">implements</span><span class="token plain"> </span><span class="token class-name">OrderService</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token maybe-class-name">Autowired</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token maybe-class-name">OrderMapper</span><span class="token plain"> orderMapper</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token maybe-class-name">Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token function maybe-class-name" style="color:#d73a49">Transactional</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rollbackFor </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">RuntimeException</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createOrder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter maybe-class-name">BuyDto</span><span class="token parameter"> buyDto</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">OrderEntity</span><span class="token plain"> orderEntity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">OrderEntity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        orderEntity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setUserId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buyDto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getUserId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        orderEntity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setCommodityCode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buyDto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getCommodityCode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        orderEntity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buyDto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        orderEntity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setMoney</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buyDto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getMoney</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        orderMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">insert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">orderEntity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:#d73a49">Service</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"1.0.0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> group </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"pangu-examples-seata-at-account"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">AccountServiceImpl</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">implements</span><span class="token plain"> </span><span class="token class-name">AccountService</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token maybe-class-name">Autowired</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token maybe-class-name">AccountMapper</span><span class="token plain"> accountMapper</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token maybe-class-name">Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token function maybe-class-name" style="color:#d73a49">Transactional</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rollbackFor </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">RuntimeException</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">decreaseAccount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter maybe-class-name">BuyDto</span><span class="token parameter"> buyDto</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">AccountEntity</span><span class="token plain"> accountEntity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> accountMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">selectOne</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Wrappers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">AccountEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">lambdaQuery().eq(AccountEntity::getUserId, buyDto.getUserId()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        LambdaUpdateWrapper</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">AccountEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> updateWrapper = Wrappers.lambdaUpdate();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        updateWrapper.set(AccountEntity::getMoney, accountEntity.getMoney() - buyDto.getCount() * buyDto.getMoney());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        updateWrapper.eq(AccountEntity::getUserId, buyDto.getUserId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        accountMapper.update(null, updateWrapper);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:#d73a49">Service</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"1.0.0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> group </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"pangu-examples-seata-at-stock"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">StockServiceImpl</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">implements</span><span class="token plain"> </span><span class="token class-name">StockService</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token maybe-class-name">Autowired</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token maybe-class-name">StockMapper</span><span class="token plain"> stockMapper</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token maybe-class-name">Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token function maybe-class-name" style="color:#d73a49">Transactional</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rollbackFor </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">RuntimeException</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">decreaseStock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter maybe-class-name">BuyDto</span><span class="token parameter"> buyDto</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">StockEntity</span><span class="token plain"> stockEntity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> stockMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">selectOne</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Wrappers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">StockEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">lambdaQuery().eq(StockEntity::getCommodityCode, buyDto.getCommodityCode()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        Assert.notNull(stockEntity, "没有查询到商品{}的库存信息。", buyDto.getCommodityCode());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        LambdaUpdateWrapper</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">StockEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> updateWrapper = Wrappers.lambdaUpdate();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        Assert.isTrue(stockEntity.getCount() &gt;= buyDto.getCount(), "库存不够，下单失败");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        updateWrapper.set(StockEntity::getCount, stockEntity.getCount() - buyDto.getCount());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        updateWrapper.eq(StockEntity::getCommodityCode, buyDto.getCommodityCode());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        stockMapper.update(null, updateWrapper);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="测试">测试<a class="hash-link" href="#测试" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启动-seata-服务端-tc-">启动 Seata 服务端（ TC ）<a class="hash-link" href="#启动-seata-服务端-tc-" title="标题的直接链接">​</a></h3><p>可通过官网下载 Seata 服务端，通过如下脚本启动。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sh seata</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sh</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">p </span><span class="token number" style="color:#36acaa">8091</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启动微服务">启动微服务<a class="hash-link" href="#启动微服务" title="标题的直接链接">​</a></h3><p>分别启动订单服务、账户服务、库存服务。需追加如下启动脚本参数。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">-</span><span class="token maybe-class-name">Dnacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">server</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">addr</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10.155</span><span class="token number" style="color:#36acaa">.46</span><span class="token number" style="color:#36acaa">.45</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8888</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token maybe-class-name">Dnacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">dev</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="执行测试用例">执行测试用例<a class="hash-link" href="#执行测试用例" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="模拟提交">模拟提交<a class="hash-link" href="#模拟提交" title="标题的直接链接">​</a></h4><p>模拟业务成功的正常逻辑，分支事务提交、全局事务提交。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">Test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">buyItems</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">BuyDto</span><span class="token plain"> buyDto </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">BuyDto</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buyDto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buyDto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setMoney</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buyDto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setCommodityCode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"C001"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buyDto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setUserId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"U001"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mainBizService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">buyItems</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buyDto</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="事务成功1" src="/assets/images/23-pangu-framework-transaction-f55b7b9da68bf22cb46e1a464317b49f.png" width="1938" height="58" class="img_ev3q">
<img loading="lazy" alt="事务成功2" src="/assets/images/24-pangu-framework-transaction-c84364ff9c5e15311026bd67d386ede3.png" width="1806" height="70" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="模拟回滚">模拟回滚<a class="hash-link" href="#模拟回滚" title="标题的直接链接">​</a></h4><p>模拟业务失败的异常逻辑，分支事务回滚、全局事务回滚。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">Test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">buyItems</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">BuyDto</span><span class="token plain"> buyDto </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">BuyDto</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// !!! 此参数会导致爆库存不足的异常，导致库存服务减库存失败</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buyDto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">101</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buyDto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setMoney</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buyDto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setCommodityCode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"C001"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buyDto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setUserId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"U001"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mainBizService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">buyItems</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buyDto</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="事务失败1" src="/assets/images/25-pangu-framework-transaction-e9b414283fbf760cd213ac266b05b605.png" width="2366" height="58" class="img_ev3q">
<img loading="lazy" alt="事务失败2" src="/assets/images/26-pangu-framework-transaction-571e5a55352246995fd2240ced01bf03.png" width="2582" height="150" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本文相关范例源码">本文相关范例源码<a class="hash-link" href="#本文相关范例源码" title="标题的直接链接">​</a></h2><ul><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-seata-at" target="_blank" rel="noopener noreferrer">pangu-examples-seata-at-api</a>：服务接口包</li><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-seata-at" target="_blank" rel="noopener noreferrer">pangu-examples-seata-at-order</a>：订单微服务</li><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-seata-at" target="_blank" rel="noopener noreferrer">pangu-examples-seata-at-account</a>：账户微服务</li><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-seata-at" target="_blank" rel="noopener noreferrer">pangu-examples-seata-at-stock</a>：库存微服务</li><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-seata-at" target="_blank" rel="noopener noreferrer">pangu-examples-seata-at-main</a>：商品购买业务模块</li></ul>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="服务端开发" term="服务端开发"/>
        <category label="盘古开发框架" term="盘古开发框架"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[盘古微服务开发框架简介]]></title>
        <id>pangu-framework-service-intro</id>
        <link href="https://xiongchun.github.io/blog/pangu-framework-service-intro"/>
        <updated>2023-01-25T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[盘古微服务开发框架 以 Dubbo、Nacos 和 Spring Boot 为核心架构，可在云原生时代构建以「服务」为中心的现代应用架构，帮助用户在云环境中更好的构建、交付和管理自己的微服务平台（也兼容支持垂直单体分层架构开发模式）。]]></summary>
        <content type="html"><![CDATA[<p><a href="https://xiongchun.github.io/pangu-framework/docs/intro" target="_blank" rel="noopener noreferrer">盘古微服务开发框架</a> 以 Dubbo、Nacos 和 Spring Boot 为核心架构，可在云原生时代构建以「服务」为中心的现代应用架构，帮助用户在云环境中更好的构建、交付和管理自己的微服务平台（也兼容支持垂直单体分层架构开发模式）。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="设计原则">设计原则<a class="hash-link" href="#设计原则" title="标题的直接链接">​</a></h2><p>在类设计、模块结构划分、技术组件选型、框架体系架构设计时会优先遵循的一些设计范式和指导原则。</p><ul><li><strong>极简原则</strong><br>大道至简，简单代表好用、稳定、易协作。坚持「Keep it Simple &amp; Stupid」设计理念。</li><li><strong>最佳实践原则</strong><br>通过大量的生产实例检验，沉淀复用最佳实践。</li><li><strong>无为而治原则</strong><br>不求大而全，轻量灵活保持架构的纯洁与透明，坚持「Less is More」设计理念。</li><li><strong>服务优先原则</strong><br>「服务」是盘古开发框架的一等公民，旨在微服务和云原生范式基础上构建「以服务为中心」的现代应用架构。</li><li><strong>一致性原则</strong><br>双架构支持，既是分布式微服务架构的工业级首选，同时也能兼容特定需求场景下的单体应用开发。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="生态架构图">生态架构图<a class="hash-link" href="#生态架构图" title="标题的直接链接">​</a></h2><img loading="lazy" width="800" src="/assets/images/34-pangu-framework-0de7df15d6292c72e5ec79f6ee6b2e0b.png" alt="盘古开发框架生态架构图" class="img_ev3q"><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="主要功能">主要功能<a class="hash-link" href="#主要功能" title="标题的直接链接">​</a></h2><ol><li>自定义的 Spring Boot 启动器，完成各功能组件的自动装配。</li><li>自研轻量 Maven 插件，支持各场景的模版代码生成。</li><li>配置参数外部化、动态化和中心化管理。</li><li>面向接口代理的高性能 RPC 服务调用。</li><li>支持服务调用智能容错和负载均衡、服务限流与熔断、可视化的服务治理与运维等。构建「以服务为中心」的现代应用架构服务平台。</li><li>强大的数据访问能力，内置通用 CRUD 接口；支持 Lambda 表达式；提供逻辑删除、乐观锁、分页、字段值填充等功能。</li><li>支持基于异步非阻塞模型的高性能 HTTP 网关通过泛化调用后端 Dubbo 服务。同时网关支持 HTTP 层的鉴权、动态限流、熔断、防火墙、灰度发布等。</li><li>提供靠谱的最终一致性分布式事务落地方案。</li><li>提供数据治理相关功能，如：读写分离、数据分片、数据加密等。</li><li>提供消息队列在异步通信、服务解耦、消峰填谷、缓存同步等应用场景下的使用能力。</li><li>提供分布式环境下的多级缓存功能(注解式和编程式)。Caffeine 作为一级本地缓存，Redis 作为二级集中式缓存。</li><li>支持可配置、可监控的分布式任务调度。</li><li>支持注解声明式和编程式对业务代码在分布式环境下加并发互斥锁。</li><li>应用日志输出级别动态切换、分布式日志跟踪等...</li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="组件依赖">组件依赖<a class="hash-link" href="#组件依赖" title="标题的直接链接">​</a></h2><ul><li><p><strong>基础核心组件</strong></p><ul><li>Spring Boot ※ Spring Framework</li><li>MyBatis (MyBatis Plus)</li><li>Apache Dubbo</li><li>Aliware Nacos</li></ul></li><li><p><strong>扩展增强型组件</strong></p><ul><li>Apache ShardingSphere</li><li>Aliware Seata</li><li>Aliware Sentinel</li><li>Layering Cache</li><li>Lock4J</li><li>TLog</li></ul></li><li><p><strong>辅助工具类组件</strong></p><ul><li>Lombok</li><li>Apache Commons</li><li>Google Guava</li><li>Hutool</li></ul></li><li><p><strong>可选组件</strong>  </p><blockquote><p>可选组件指由我们优选的做过适配或提供集成方案，但不作为盘古框架缺省或标配的组件。</p></blockquote><ul><li>Apache ShenYu</li><li>XXL Job</li></ul></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="模块列表">模块列表<a class="hash-link" href="#模块列表" title="标题的直接链接">​</a></h2><ul><li><strong>pangu-parent</strong><br>盘古资源依赖声明管理模块</li><li><strong>pangu-common</strong><br>盘古公共基础类库</li><li><strong>pangu-spring-boot-starter</strong><br>盘古启动、中心化配置等基础能力自动装配模块</li><li><strong>pangu-dubbo-spring-boot-starter</strong><br>盘古 Dubbo 服务开发自动装配模块</li><li><strong>pangu-jdbc-spring-boot-starter</strong><br>盘古数据库持久化操作自动装配模块</li><li><strong>pangu-cache-spring-boot-starter</strong><br>盘古缓存开发自动装配模块</li><li><strong>pangu-web-spring-boot-starter</strong><br>盘古 Web 应用自动装配模块</li><li><strong>pangu-rabbitmq-spring-boot-starter</strong><br>盘古消息队列自动装配模块</li><li><strong>pangu-seata-spring-boot-starter</strong><br>盘古分布式事务自动装配模块</li><li><strong>pangu-data-governance-spring-boot-starter</strong><br>盘古数据治理（读写分离、数据分片等）自动装配模块</li><li><strong>pangu-generator-maven-plugin</strong><br>盘古代码生成器Maven插件</li><li><strong>pangu-examples</strong><br>盘古框架模版化参考范例集</li></ul>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="服务端开发" term="服务端开发"/>
        <category label="盘古开发框架" term="盘古开发框架"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[盘古 Admin 简介及快速入门]]></title>
        <id>pangu-dev-framework-admin-intro-quickstart</id>
        <link href="https://xiongchun.github.io/blog/pangu-dev-framework-admin-intro-quickstart"/>
        <updated>2023-01-10T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[盘古 Admin 是一套基于 SCUI(Vue3、Element-Plus) + 盘古服务开发框架的中后台业务系统前后端统一解决方案。并预置了轻量成熟的 权限系统参考实现 。用户可以基于它快速搭建二次开发脚手架，实现商业业务逻辑。]]></summary>
        <content type="html"><![CDATA[<p><a href="https://xiongchun.github.io/pangu-framework/admin/intro" target="_blank" rel="noopener noreferrer">盘古 Admin</a> 是一套基于 <strong>SCUI</strong>(Vue3、Element-Plus) + <strong>盘古服务开发框架</strong>的中后台业务系统前后端统一解决方案。并预置了轻量成熟的 <a href="https://xiongchun.github.io/pangu-framework/online-demo" target="_blank" rel="noopener noreferrer">权限系统参考实现</a> 。用户可以基于它快速搭建二次开发脚手架，实现商业业务逻辑。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="工程结构说明">工程结构说明<a class="hash-link" href="#工程结构说明" title="标题的直接链接">​</a></h2><p>盘古 Admin 仓库代码路径：<code>pangu-framework/pangu-admin</code>。</p><ul><li>pangu-admin-backend：后端<ul><li>pangu-admin-web：统一网关模块</li><li>pangu-admin-system：权限系统模块</li><li>XX-XXN：业务系统模块 N (二次开发)</li></ul></li><li>pangu-admin-frontend：前端</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="后端开发环境搭建">后端开发环境搭建<a class="hash-link" href="#后端开发环境搭建" title="标题的直接链接">​</a></h2><ul><li>将后端工程引入 IDEA。工程代码：pangu-framework/pangu-admin/pangu-admin-backend。</li><li>执行目录 ~/pangu-admin-system/pangu-admin-system-app/src/main/resources/sql 中的数据脚本。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置">配置<a class="hash-link" href="#配置" title="标题的直接链接">​</a></h3><p>分别在 nacos 配置中心创建模块<code>pangu-admin-web</code>和<code>pangu-admin-system-app</code>的配置信息。如下图所示。</p><p><img loading="lazy" alt="盘古开发框架 Admin" src="/assets/images/35-pangu-admin-818905eaab32c4b60423c06db1bb20a7.png" width="2508" height="692" class="img_ev3q"></p><blockquote><p>关于 naocs 配置中心的相关用法请查阅开发指南章节的 <a href="https://xiongchun.github.io/pangu-framework/docs/advanced-guide/nacos-config-center" target="_blank" rel="noopener noreferrer">配置中心</a>。</p></blockquote><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">pangu-admin-web</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">pangu-admin-system-app</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Data Id 为 ppangu-admin-web 的配置数据</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jackson</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">time</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">zone</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">GMT</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pangu</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">web</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cross</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">origin</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">protocol</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">dubbo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">protocol</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">port</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">consumer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">registry</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">address</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nacos</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">nacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">server</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">addr</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">?</span><span class="token plain">namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">nacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">namespace</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">consumer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">check</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jwt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">secret</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">alliswell666</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jwt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ttl</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">min</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">480</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jwt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">persistent</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">disabled</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">excludes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">method</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">start</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">with</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">list</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">find</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">select</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">read</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">consumer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pool</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">threads</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">root</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">gitee</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pulanos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pangu</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">alibaba</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">nacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">impl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">ClientWorker</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">WARN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">yomahub</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">tlog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">filter</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">ERROR</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Data Id 为 pangu-admin-system-app 的配置数据</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">protocol</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">dubbo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">protocol</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">port</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">consumer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">registry</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">address</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nacos</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">nacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">server</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">addr</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">?</span><span class="token plain">namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">nacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">namespace</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">consumer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">check</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">provider</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">filter</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">exception</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">zaxxer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">hikari</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">HikariDataSource</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">driver</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">class</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jdbc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">url</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">jdbc</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">localhost</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3306</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">admin</span><span class="token operator" style="color:#393A34">?</span><span class="token plain">useUnicode</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">true</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">characterEncoding</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">utf</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">8</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">autoReconnect</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">true</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">failOverReadOnly</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">false</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">allowMultiQueries</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">true</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">useSSL</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">false</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rewriteBatchedStatements</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">username</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">password</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">root123456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mybatis</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mapperLocations</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">classpath</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mapper</span><span class="token comment" style="color:#999988;font-style:italic">/**/</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">xml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mybatis</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">configuration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">log</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">impl</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">org</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">apache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ibatis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">slf4j</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Slf4jImpl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mybatis</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">global</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">db</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">logic</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">delete</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">field</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">deleted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mybatis</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">global</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">db</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">logic</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">not</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">delete</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">value</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mybatis</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">global</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">db</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">logic</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">delete</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">value</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pangu</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jdbc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">db</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">file</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">logs</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pangu</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">log</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">root</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">gitee</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pulanos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pangu</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pulanit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pangu</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">admin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">system</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">dao</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">DEBUG</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启动">启动<a class="hash-link" href="#启动" title="标题的直接链接">​</a></h3><p>启动参数说明  </p><ul><li>-Dnacos.server-addr: nacos 服务器地址。</li><li>-Dnacos.namespace: nacos 里的命名空间 ID 。</li></ul><p><strong>启动权限服务模块</strong></p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">启动参数</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">-</span><span class="token maybe-class-name">Dnacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">server</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">addr</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">100.100</span><span class="token number" style="color:#36acaa">.100</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">XXX</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8048</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token maybe-class-name">Dnacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">dev</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>启动成功后在 nacos 服务列表中可看到相关服务提供者信息。如下图所示。</p><p><img loading="lazy" alt="盘古开发框架 Admin" src="/assets/images/36-pangu-admin-eb80f595f745157c04dce5b331633c3a.png" width="2798" height="1058" class="img_ev3q"></p><p><strong>启动网关模块</strong></p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">启动参数</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">-</span><span class="token maybe-class-name">Dnacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">server</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">addr</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">100.100</span><span class="token number" style="color:#36acaa">.100</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">XXX</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8048</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token maybe-class-name">Dnacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">dev</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>启动成功后在 nacos 服务列表中可看到相关服务消费者信息。如下图所示。</p><p><img loading="lazy" alt="盘古开发框架 Admin" src="/assets/images/37-pangu-admin-f74220e027d98f67b4aee8615faff3bf.png" width="2500" height="952" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="前端开发环境搭建">前端开发环境搭建<a class="hash-link" href="#前端开发环境搭建" title="标题的直接链接">​</a></h2><p>前端工程代码路径：pangu-framework/pangu-admin/pangu-admin-frontend。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="介绍">介绍<a class="hash-link" href="#介绍" title="标题的直接链接">​</a></h3><p>盘古 Admin 前端基于 SUCI 开发。SCUI 是一个中后台前端解决方案，基于 VUE3 和 ElementPlus 实现。 使用最新的前端技术栈，提供各类实用的组件方便在业务开发时的调用，并且持续性的提供丰富的业务模板帮助你快速搭建企业级中后台前端任务。更多 SCUI 信息，请直接参考其 <a href="https://lolicode.gitee.io/scui-doc/guide/" target="_blank" rel="noopener noreferrer">项目主页和相关文档</a>。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装--启动">安装 &amp; 启动<a class="hash-link" href="#安装--启动" title="标题的直接链接">​</a></h3><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_S0QG"><p>安装依赖和启动需依赖npm。安装方法：<a href="https://nodejs.org/zh-cn/" target="_blank" rel="noopener noreferrer">https://nodejs.org/zh-cn</a></p></div></div><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 进入项目目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">framework</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">admin</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">admin</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">frontend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 安装依赖</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># </span><span class="token function" style="color:#d73a49">启动项目</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">开发模式</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm run serve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 构建部署（生产模式）：将根目录生成 dist 文件夹发布到服务器即可</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># npm run build</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>编译启动成功后可通过控制台提示信息开始访问。如：http://localhost:2800</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="截屏部分">截屏（部分）<a class="hash-link" href="#截屏部分" title="标题的直接链接">​</a></h3><p>如下为权限系统参考实现的部分截屏。</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">1</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">2</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">3</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">4</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">5</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">6</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">7</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">8</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">9</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">10</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">11</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">12</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">13</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">14</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p><img loading="lazy" alt="盘古开发框架 Admin" src="/assets/images/38-pangu-admin-8fd00b65afe3e10fa86d89da0824b77b.png" width="2874" height="1578" class="img_ev3q"></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><img loading="lazy" alt="盘古开发框架 Admin" src="/assets/images/39-pangu-admin-fbb440059bfc8cfbc6b5026001ad7acb.png" width="2878" height="1582" class="img_ev3q"></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><img loading="lazy" alt="盘古开发框架 Admin" src="/assets/images/40-pangu-admin-ad1dd9e7711793db5b348f73687c2f60.png" width="2880" height="1582" class="img_ev3q"></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><img loading="lazy" alt="盘古开发框架 Admin" src="/assets/images/41-pangu-admin-57ba140bcfb2b45834a5855dc7fd8831.png" width="2876" height="1584" class="img_ev3q"></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><img loading="lazy" alt="盘古开发框架 Admin" src="/assets/images/42-pangu-admin-f4422cb9f17440a291264bf97850fada.png" width="2880" height="1584" class="img_ev3q"></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><img loading="lazy" alt="盘古开发框架 Admin" src="/assets/images/43-pangu-admin-4b1ab7691d2b0c891215a686f5d109cb.png" width="2880" height="1582" class="img_ev3q"></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><img loading="lazy" alt="盘古开发框架 Admin" src="/assets/images/44-pangu-admin-79df08a6afac1c0c203185951a5a4add.png" width="2874" height="1586" class="img_ev3q"></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><img loading="lazy" alt="盘古开发框架 Admin" src="/assets/images/45-pangu-admin-24c8467891fc61f6bd41e082d00db857.png" width="2880" height="1586" class="img_ev3q"></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><img loading="lazy" alt="盘古开发框架 Admin" src="/assets/images/46-pangu-admin-c3d2cc1d8f420786cf9e3138cc35f2cf.png" width="2874" height="1582" class="img_ev3q"></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><img loading="lazy" alt="盘古开发框架 Admin" src="/assets/images/47-pangu-admin-049f9d2f4b2bf9d075fa27778b5fed8a.png" width="2878" height="1584" class="img_ev3q"></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><img loading="lazy" alt="盘古开发框架 Admin" src="/assets/images/48-pangu-admin-e9e17c01a74b8693278c9c1bedc7537f.png" width="2880" height="1584" class="img_ev3q"></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><img loading="lazy" alt="盘古开发框架 Admin" src="/assets/images/51-pangu-admin-b7296a4a5e20475550d11b4ae3b99b35.png" width="2874" height="1584" class="img_ev3q"></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><img loading="lazy" alt="盘古开发框架 Admin" src="/assets/images/50-pangu-admin-a324e2508d61c1d156a6500bea34c705.png" width="2880" height="1586" class="img_ev3q"></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><img loading="lazy" alt="盘古开发框架 Admin" src="/assets/images/49-pangu-admin-d8bc1b4c5bc06e3d48faed2c23b5694b.png" width="2876" height="1582" class="img_ev3q"></p></div></div></div><p>完整体验请访问：<a href="https://xiongchun.github.io/pangu-framework/online-demo" target="_blank" rel="noopener noreferrer">在线演示系统</a>。</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>可以将盘古 Admin 后端改为单体应用吗？</div><div class="admonitionContent_S0QG"><p>必须可以。只需要自己做一些简单的代码合并即可将 RPC 微服务调用改为本地服务调用。如果连配置中心都不想搭建的话，可以将配置直接改为本地配置文件。</p></div></div>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="服务端开发" term="服务端开发"/>
        <category label="盘古开发框架" term="盘古开发框架"/>
        <category label="客户端开发" term="客户端开发"/>
        <category label="Web" term="Web"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[盘古 APP Starter 简介及快速入门]]></title>
        <id>pangu-app-intro-quickstart</id>
        <link href="https://xiongchun.github.io/blog/pangu-app-intro-quickstart"/>
        <updated>2023-01-02T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[盘古 APP Starter 是集成了 uni-app 内置组件、官方扩展组件和全面兼容 nvue 的 uni-app 生态框架 uView UI 的移动端多平台快速开发脚手架。用户可以基于此完成Android/IOS App、微信小程序、H5 应用的快速开发。（一次开发，针对不同平台编译发布版本）]]></summary>
        <content type="html"><![CDATA[<p><a href="https://xiongchun.github.io/pangu-framework/app/intro" target="_blank" rel="noopener noreferrer">盘古 APP Starter</a> 是集成了 uni-app 内置组件、官方扩展组件和全面兼容 nvue 的 uni-app 生态框架 uView UI 的移动端多平台快速开发脚手架。用户可以基于此完成Android/IOS App、微信小程序、H5 应用的快速开发。（一次开发，针对不同平台编译发布版本）</p><ul><li><p><strong>uni-app 介绍</strong><br>
<a href="https://uniapp.dcloud.net.cn" target="_blank" rel="noopener noreferrer">uni-app</a> 是一个使用 Vue.js 开发所有前端应用的框架，开发者编写一套代码，可发布到 iOS、Android、Web（响应式）、以及各种小程序（微信/支付宝/百度/头条/飞书/QQ/快手/钉钉/淘宝）、快应用等多个平台。</p></li><li><p><strong>uView UI 介绍</strong><br>
<a href="https://www.uviewui.com/components/intro.html" target="_blank" rel="noopener noreferrer">uView UI</a> 是全面兼容 nvue 的 uni-app 生态框架，全面的组件和便捷的工具会让您信手拈来，如鱼得水。</p></li><li><p><strong>HBuilderX 介绍</strong><br>
<a href="https://hx.dcloud.net.cn" target="_blank" rel="noopener noreferrer">HbuilderX</a> 是一款免费的前端开发 IDE。uni-app 的多端编译部署能力依赖于它。所以，盘古 APP Starter 的标准开发工具也就是 HBuilderX。</p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="搭建开发环境">搭建开发环境<a class="hash-link" href="#搭建开发环境" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="工程结构说明">工程结构说明<a class="hash-link" href="#工程结构说明" title="标题的直接链接">​</a></h3><p>盘古 App 仓库代码路径：<code>pangu-framework/pangu-app-starter</code>。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="开发环境搭建">开发环境搭建<a class="hash-link" href="#开发环境搭建" title="标题的直接链接">​</a></h3><p>由于 uni-app 依赖 HbuilderX，因此，我们开发盘古 APP 的 IDE 选择为 HbuilderX。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="导入模版工程">导入模版工程<a class="hash-link" href="#导入模版工程" title="标题的直接链接">​</a></h4><p>使用 HbuilderX「文件 -&gt; 导入 -&gt; 从本地目录导入」菜单，导入 pangu-app-starter 模版工程。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装依赖">安装依赖<a class="hash-link" href="#安装依赖" title="标题的直接链接">​</a></h4><blockquote><p>安装依赖和启动需依赖npm。安装方法：<a href="https://nodejs.org/zh-cn/" target="_blank" rel="noopener noreferrer">https://nodejs.org/zh-cn</a></p></blockquote><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 进入项目目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> pangu-framework/pangu-app-starter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 安装依赖</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> i</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="h5-web-浏览器调试启动">H5 Web 浏览器调试启动<a class="hash-link" href="#h5-web-浏览器调试启动" title="标题的直接链接">​</a></h4><p>使用 HbuilderX「运行 -&gt; 运行到浏览器 -&gt; Chrome」菜单，启动工程并通过浏览器访问。如下图所示。</p><img loading="lazy" width="800" src="/assets/images/12-483177a151537512bcb0dda8c77720a5.png" alt="盘古 APP" class="img_ev3q"><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="微信小程序模拟器调试启动">微信小程序模拟器调试启动<a class="hash-link" href="#微信小程序模拟器调试启动" title="标题的直接链接">​</a></h4><ul><li>安装微信开发者工具。</li><li>使用 HbuilderX 「运行 -&gt; 运行到小程序模拟器 -&gt; 微信开发者工具」菜单，HbuilderX 会编译输出小程序应用并连接微信开发者工具启动调试。如下图所示。</li></ul><img loading="lazy" width="800" src="/assets/images/13-d3c87c571e2086e807ec8019b4cff93e.png" alt="盘古 APP" class="img_ev3q"><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="android-app-真机调试启动">Android APP 真机调试启动<a class="hash-link" href="#android-app-真机调试启动" title="标题的直接链接">​</a></h4><ul><li>将 Android 手机用数据线与电脑连接，打开手机开发者调试模式。</li><li>使用 HbuilderX 「运行 -&gt; 运行到手机或模拟器 -&gt; 运行到 Android App 基座」菜单，HbuilderX 会将 Android 基座壳子安装到目标手机，并启动加载页面。如下图所示。</li></ul><img loading="lazy" width="350" src="/assets/images/1-a66c1c9ac895da03cb67006e0dba5393.jpeg" alt="盘古 APP" class="img_ev3q"><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="快速入门指南">快速入门指南<a class="hash-link" href="#快速入门指南" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置底部导航菜单">配置底部导航菜单<a class="hash-link" href="#配置底部导航菜单" title="标题的直接链接">​</a></h3><blockquote><p>以范例 APP 底部的「组件」导航菜单为例，说明如何配置首页底部的导航菜单。</p></blockquote><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置菜单节点信息">配置菜单节点信息<a class="hash-link" href="#配置菜单节点信息" title="标题的直接链接">​</a></h4><p>打开 pages.json 配置文件，找到 tabBar 节点。如下所示：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token property" style="color:#36acaa">"tabBar"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"color"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"#303133"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"selectedColor"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"#529b2e"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"borderStyle"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"black"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"backgroundColor"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"#f4f4f5"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"list"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token property" style="color:#36acaa">"pagePath"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"pages/example/components"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token property" style="color:#36acaa">"iconPath"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"static/common/img/nav/component.png"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token property" style="color:#36acaa">"selectedIconPath"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"static/common/img/nav/component-selected.png"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token property" style="color:#36acaa">"text"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"组件"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// ...其它菜单配置...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置菜单路由信息">配置菜单路由信息<a class="hash-link" href="#配置菜单路由信息" title="标题的直接链接">​</a></h4><p>配置路径 pages/example/components 的路由信息。在 pages.json 配置文件中，找到 pages 节点。如下所示：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"pages"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//pages数组中第一项表示应用启动页</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">"path"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"pages/example/components"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">"style"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"navigationBarTitleText"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"组件"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...其它路由配置...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>该路由配置对应视图文件：pages/example/components.nvue。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="新增业务模块页面路由">新增业务模块页面路由<a class="hash-link" href="#新增业务模块页面路由" title="标题的直接链接">​</a></h3><p>参考 pages.json 相关配置文件即可。</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_S0QG"><p>更多关于 pages.json 的配置，请查阅 uni-app <a href="https://uniapp.dcloud.net.cn/collocation/pages.html" target="_blank" rel="noopener noreferrer">相关文档</a>。</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="部署运维参考">部署运维参考<a class="hash-link" href="#部署运维参考" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="发布-h5-web-应用">发布 H5 Web 应用<a class="hash-link" href="#发布-h5-web-应用" title="标题的直接链接">​</a></h3><blockquote><p>将工程发布为手机 H5 Web 应用部署到静态资源服务器，可通过微信/手机浏览器等访问。</p></blockquote><ul><li><p>使用 HbuilderX「发行 -&gt; 网站 PC-Web 或手机 H5」菜单，编译成功后执行文件将会输出到 unpackage/build/dist/h5 目录下。将该目录下文件直接发布到 Web 服务器即可。</p></li><li><p>如下为发布成功的盘古 APP Starter 模板工程的 H5 Web 应用。 </p><blockquote><p>微信或手机浏览器扫码访问</p><img loading="lazy" width="150" src="/assets/images/18-dc6e887dbaa8688dd6e9811eecb10812.png" alt="盘古 APP Starter" class="img_ev3q"></blockquote><blockquote><p>电脑端浏览器模拟访问<br>
<a href="https://pangu-app-starter.pulanit.com/h5.html" target="_blank" rel="noopener noreferrer">https://pangu-app-starter.pulanit.com/h5.html</a> </p></blockquote></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="发布微信小程序应用">发布微信小程序应用<a class="hash-link" href="#发布微信小程序应用" title="标题的直接链接">​</a></h3><blockquote><p>请事先安装好微信开发者工具。<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html" target="_blank" rel="noopener noreferrer">下载安装</a></p></blockquote><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="第一步注册微信小程序账户">第一步：注册微信小程序账户<a class="hash-link" href="#第一步注册微信小程序账户" title="标题的直接链接">​</a></h5><p>在微信 <a href="https://mp.weixin.qq.com" target="_blank" rel="noopener noreferrer">公众平台</a> 注册小程序账户。（注意：一个邮箱地址注册一个微信小程序账户）。登录后根据提示生成微信小程序 AppID。（后续发布将会使用）</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="第二步编译输出小程序文件">第二步：编译输出小程序文件<a class="hash-link" href="#第二步编译输出小程序文件" title="标题的直接链接">​</a></h5><ul><li><p>使用 HbuilderX「发行 -&gt; 小程序-微信」菜单，在弹出的对话框中填入上一步的 AppID。（注意：不要选择自动上传到微信平台选项。）如下图所示：</p><img loading="lazy" width="500" src="/assets/images/14-06e4a2531fb7f5d5290658e1a31f0bb6.png" alt="盘古 APP" class="img_ev3q"></li><li><p>点击「发行」按钮后会开始编译小程序输出文件并自动打开微信开发者工具导入小程序文件。接着使用微信开发者工具的「上传代码」按钮，将小程序文件上传到微信公众平台。如下图所示：</p><img loading="lazy" width="600" src="/assets/images/15-4bc1543375d44cc94dc026486f708e39.png" alt="盘古 APP" class="img_ev3q"></li><li><p>最后就是一个微信平台的代码审核、发布上线的流程即可，这里不再赘述。根据后台提示操作即可。</p></li><li><p>如下二维码是发布成功的盘古 APP Starter 模板工程的微信小程序示例。</p><blockquote><p>微信扫码体验</p><img loading="lazy" width="150" src="/assets/images/16-f10759511517d51d1a3dfa8884d50518.jpg" alt="盘古 APP" class="img_ev3q"></blockquote></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="发布-android-app-应用">发布 Android APP 应用<a class="hash-link" href="#发布-android-app-应用" title="标题的直接链接">​</a></h3><blockquote><p>将工程打包发布为原生 Android APP 应用。对于.vue 页面将使用 webview 渲染机制；如果使用 .nvue 页面(native vue 的缩写)，则使用原生渲染。</p></blockquote><ul><li><p>使用 HbuilderX 「运行 -&gt; 原生APP-云打包」菜单，打开打包配置窗口。如下图所示为最便捷的配置窗口。（高级用法：自定义证书、自定义基座等可参考uni-app 和 HbuilderX 相关文档）</p><img loading="lazy" width="600" src="/assets/images/17-ecdc1e420d96165e4f82e9a2a6cddbf0.png" alt="盘古 APP" class="img_ev3q"></li><li><p>点击「打包」按钮，IDE 将完成云端打包。打包结束后，.apk 安装包将输出到：unpackage/release/apk 目录。</p></li><li><p>如下是发布成功的盘古 APP Starter 模板工程的 Android 原生 APP 示例。 </p><blockquote><p>手机浏览器扫码下载安装（微信扫码无效）</p><img loading="lazy" width="150" src="/assets/images/19-a670486ab8f869101147654e07a77bf6.png" alt="盘古 APP Starter" class="img_ev3q"></blockquote></li></ul><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_S0QG"><p>更多类型的应用发布方式请参阅 <a href="https://uniapp.dcloud.net.cn/" target="_blank" rel="noopener noreferrer">uni-app</a> 和 <a href="https://hx.dcloud.net.cn/" target="_blank" rel="noopener noreferrer">HbuilderX</a> 相关文档。</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="盘古-app-starter-截屏">盘古 APP Starter 截屏<a class="hash-link" href="#盘古-app-starter-截屏" title="标题的直接链接">​</a></h2><p>如下为盘古 APP Starter 的部分截屏。完整体验请访问：<a href="https://xiongchun.github.io/pangu-framework/online-demo-app" target="_blank" rel="noopener noreferrer">在线演示</a>。</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">1</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">2</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">3</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">4</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">5</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">6</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">7</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">8</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">9</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">10</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">11</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><img loading="lazy" width="350" src="/assets/images/1-a66c1c9ac895da03cb67006e0dba5393.jpeg" alt="盘古 APP Starter" class="img_ev3q"></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><img loading="lazy" width="350" src="/assets/images/2-3d796ddba72dc141d18e7c2c9c4f5538.jpeg" alt="盘古 APP Starter" class="img_ev3q"></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><img loading="lazy" width="350" src="/assets/images/3-82097038c31269abcadc0a6d9d9d1f41.jpeg" alt="盘古 APP Starter" class="img_ev3q"></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><img loading="lazy" width="350" src="/assets/images/4-1fecc381a305e02030b78faa8693f8c1.jpeg" alt="盘古 APP Starter" class="img_ev3q"></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><img loading="lazy" width="350" src="/assets/images/5-d059e621d4c6229ef840d2e6193649a0.jpeg" alt="盘古 APP Starter" class="img_ev3q"></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><img loading="lazy" width="350" src="/assets/images/6-99fd5a827eeb40285ce1ecb100d9962b.jpeg" alt="盘古 APP Starter" class="img_ev3q"></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><img loading="lazy" width="350" src="/assets/images/7-5910dbb0670a8d290a62971eaf6229d6.jpeg" alt="盘古 APP Starter" class="img_ev3q"></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><img loading="lazy" width="350" src="/assets/images/8-947312dc5cb9091b2d6e6a06637ff5c5.jpeg" alt="盘古 APP Starter" class="img_ev3q"></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><img loading="lazy" width="350" src="/assets/images/9-dd795eaf37ba0d1e7e1a59bc5eb68577.jpeg" alt="盘古 APP Starter" class="img_ev3q"></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><img loading="lazy" width="350" src="/assets/images/10-78aa79e0ec0105a8c773f1b17828b0c6.jpeg" alt="盘古 APP Starter" class="img_ev3q"></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><img loading="lazy" width="350" src="/assets/images/11-77bb921162f22118f1c7940bf77aa36d.jpeg" alt="盘古 APP Starter" class="img_ev3q"></div></div></div>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="服务端开发" term="服务端开发"/>
        <category label="盘古开发框架" term="盘古开发框架"/>
        <category label="客户端开发" term="客户端开发"/>
        <category label="APP" term="APP"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[(AIGC) Python 和大数据分析、人工智能是什么关系]]></title>
        <id>aigc-python-bigdata-ai</id>
        <link href="https://xiongchun.github.io/blog/aigc-python-bigdata-ai"/>
        <updated>2022-12-10T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[AIGC 特别标注: 本文内容由大语言模型自动生成或人工演绎。]]></summary>
        <content type="html"><![CDATA[<blockquote><p><strong>AIGC 特别标注</strong>: 本文内容由大语言模型自动生成或人工演绎。</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="python-和大数据分析之间有什么关系">Python 和大数据分析之间有什么关系<a class="hash-link" href="#python-和大数据分析之间有什么关系" title="标题的直接链接">​</a></h2><p>Python 和大数据分析之间的关系非常密切。Python 作为一种高级编程语言，被广泛用于大数据处理和分析的各个环节。以下是 Python 在大数据分析中的一些关键作用。</p><ol><li><strong>数据清洗和处理</strong>：Python 提供了各种强大的库，如 Pandas 和 NumPy，用于数据清洗、转换、重塑和聚合。这些库使得 Python 成为数据预处理的首选语言。</li><li><strong>数据可视化</strong>：Python 的 matplotlib、seaborn 和 plotly 等库可以生成各种高质量的图表和可视化效果，这对于理解大数据非常有帮助。</li><li><strong>机器学习和数据挖掘</strong>：Python 拥有 scikit-learn、TensorFlow 和 Keras 等库，这些库为机器学习和深度学习提供了强大的工具，包括数据拟合、模型选择和评估等。</li><li><strong>大数据处理</strong>：Python 通过 Hadoop 和 Spark 等分布式计算平台进行大数据处理。PySpark 和 PyDoop 等库允许 Python 程序直接与这些平台交互。</li><li><strong>数据存储和管理</strong>：Python 可以通过与数据库交互来管理大规模数据，如使用 SQLAlchemy 与关系数据库交互，或者使用 Pandas 与 NoSQL 数据库交互。</li><li><strong>大数据架构构建</strong>：Python 在构建大数据处理系统时非常有用，如ETL过程、数据管道、批处理和流处理系统等。</li></ol><p>因此，Python 已经成为大数据分析的重要工具之一，特别是在数据科学、机器学习和数据分析等领域中，Python 已经成为主导语言。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="python-和人工智能之间有什么关系">Python 和人工智能之间有什么关系<a class="hash-link" href="#python-和人工智能之间有什么关系" title="标题的直接链接">​</a></h2><p>Python 与人工智能的关系密不可分。Python 作为一种高级编程语言，被广泛用于人工智能领域，是人工智能领域最受欢迎的编程语言之一。以下是一些 Python 在人工智能领域中的重要应用。</p><ol><li><strong>机器学习</strong>：Python 提供了许多强大的机器学习库，如 Scikit-learn、TensorFlow 和 Keras 等，这些库使得开发者能够更容易地构建和训练各种机器学习模型。</li><li><strong>深度学习</strong>：Python 在深度学习领域也发挥了重要作用，许多深度学习框架，如 TensorFlow 和P yTorch，都是用 Python 编写的。这些框架可以帮助人们进行深度学习模型的构建和训练。</li><li><strong>数据科学</strong>：Python 在数据科学领域中广泛使用，提供了许多数据分析和数据可视化工具，如 Pandas、NumPy 和 Matplotlib 等。</li><li><strong>自然语言处理（NLP）</strong>：Python 有许多库可用于自然语言处理，如 NLTK、Spacy 和 Gensim 等，这些库可以帮助开发者实现语音识别、文本分类和机器翻译等应用。</li><li><strong>计算机视觉</strong>：Python有一些优秀的计算机视觉库，如 OpenCV 和 Pillow 等，可以帮助开发者处理图像和视频数据，并进行各种计算机视觉应用的开发。</li></ol><p>总的来说，Python 为人工智能提供了强大的支持，使得人工智能技术的应用更加广泛和深入。</p>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="大数据分析" term="大数据分析"/>
        <category label="Python" term="Python"/>
        <category label="人工智能" term="人工智能"/>
        <category label="AIGC" term="AIGC"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[(AIGC) 文心一言 VS Bard VS ChatGPT]]></title>
        <id>llm-baidu-yiyan-google-bard-openai-chatgpt</id>
        <link href="https://xiongchun.github.io/blog/llm-baidu-yiyan-google-bard-openai-chatgpt"/>
        <updated>2022-12-07T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[AIGC 特别标注: 本文内容由大语言模型自动生成或人工演绎。]]></summary>
        <content type="html"><![CDATA[<blockquote><p><strong>AIGC 特别标注</strong>: 本文内容由大语言模型自动生成或人工演绎。</p></blockquote><p>当下大语言模型如火如荼，我也很好奇。所以，今天我以「大数据分析生态有哪些技术栈」为题，简单体验了一下如下 3 个大语言模型。具体效果大家自己看吧。</p><ul><li><a href="https://yiyan.baidu.com" target="_blank" rel="noopener noreferrer">百度 文心一言</a> (中国互联网访问)</li><li><a href="https://bard.google.com" target="_blank" rel="noopener noreferrer">Google Bard</a> (国际互联网访问)</li><li><a href="https://chat.openai.com" target="_blank" rel="noopener noreferrer">OpenAI ChatGPT 3.5</a> (国际互联网访问)</li></ul><p>此场景答题效果，个人感觉 Google Bard 优于 OpenAI ChatGPT 3.5 优于 百度文心一言。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="大语言模型生成内容">大语言模型生成内容<a class="hash-link" href="#大语言模型生成内容" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="百度-文心一言">百度 文心一言<a class="hash-link" href="#百度-文心一言" title="标题的直接链接">​</a></h3><p><img loading="lazy" alt="盘古开发框架-百度 文心一言" src="/assets/images/56-llm-7a53bd9432e28a806cef5c7e510029cf.png" width="2492" height="1200" class="img_ev3q"></p><p>大数据分析生态涵盖了许多技术，这些技术协同工作，从数据采集、存储、处理、分析到应用，帮助企业更好地理解和利用数据。以下是一些关键的大数据分析生态技术.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="数据采集和存储技术">数据采集和存储技术<a class="hash-link" href="#数据采集和存储技术" title="标题的直接链接">​</a></h4><p>大数据的多样性要求使用不同的数据采集工具和技术。数据采集后，需要有效地存储和管理这些数据，以便后续的处理和分析。常见的数据存储技术包括关系型数据库、NoSQL数据库和分布式文件系统等。  </p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="数据处理和计算技术">数据处理和计算技术<a class="hash-link" href="#数据处理和计算技术" title="标题的直接链接">​</a></h4><p>处理大规模数据需要强大的计算能力。常见的技术包括分布式计算、并行处理、图计算和流式处理等。这些技术能够有效地处理大规模数据，提高计算效率和准确性。  </p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="数据管理和存储技术">数据管理和存储技术<a class="hash-link" href="#数据管理和存储技术" title="标题的直接链接">​</a></h4><p>大数据的快速增长要求使用高效的数据管理和存储技术。这些技术包括分布式文件系统、列式数据库、NoSQL数据库等，能够有效地管理和存储大规模数据。 </p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="数据分析和挖掘技术">数据分析和挖掘技术<a class="hash-link" href="#数据分析和挖掘技术" title="标题的直接链接">​</a></h4><p>大数据分析的核心是使用各种技术和工具从大规模数据中提取有价值的信息和知识。常见的技术包括统计分析、机器学习、数据挖掘和自然语言处理等。这些技术能够发现数据中的模式、趋势和关联，为企业提供有价值的洞察。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="数据可视化技术">数据可视化技术<a class="hash-link" href="#数据可视化技术" title="标题的直接链接">​</a></h4><p>将分析结果以直观、易懂的方式呈现给非技术人员是大数据分析的重要环节。常见的数据可视化技术包括图表、仪表板、报告等，这些技术能够有效地传达数据中的信息和洞察。  </p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="数据安全和隐私保护技术">数据安全和隐私保护技术<a class="hash-link" href="#数据安全和隐私保护技术" title="标题的直接链接">​</a></h4><p>随着大数据的广泛应用，数据安全和隐私保护成为越来越重要的议题。这些技术包括数据加密、访问控制、身份认证等，能够保护数据的机密性和完整性，防止数据泄露和未经授权的访问。  </p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="数据集成和整合技术">数据集成和整合技术<a class="hash-link" href="#数据集成和整合技术" title="标题的直接链接">​</a></h4><p>大数据的多样性和复杂性要求将来自不同来源和平台的数据集成和整合在一起。这些技术包括数据抽取、转换、加载（ETL）、数据联邦等，能够将分散的数据整合到一个统一的数据仓库或数据湖中，方便后续的分析和处理。  </p><p>综上所述，大数据分析生态涵盖了多个领域和技术，这些技术协同工作，帮助企业更好地利用数据。了解和掌握这些技术是进行大数据分析和应用的关键。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="google-bard">Google Bard<a class="hash-link" href="#google-bard" title="标题的直接链接">​</a></h3><p><img loading="lazy" alt="盘古开发框架-Google Bard" src="/assets/images/57-llm-97aca4e107567ae27fcfb6f89757e595.png" width="2810" height="1494" class="img_ev3q"></p><p>大数据分析生态是一个庞大的体系，涵盖了数据采集、数据存储、数据分析、数据可视化等多个方面。其中，数据采集、数据存储、数据分析是三大核心技术。</p><p><strong>数据采集</strong> 是指将来自不同来源的数据收集到一起的过程。数据采集技术可以分为两类：</p><ul><li>实时数据采集：将数据实时地从源头收集到。</li><li>离线数据采集：将数据从源头收集到后，存储到本地或云端。</li></ul><p>常用的大数据采集技术包括：</p><ul><li>网络爬虫：用于抓取网页上的文本、图片、视频等数据。</li><li>日志分析：用于分析系统日志、网络日志等数据。</li><li>传感器数据采集：用于收集传感器产生的数据。</li></ul><p><strong>数据存储</strong> 是指将数据以便于管理和分析的方式存储起来的过程。数据存储技术可以分为两类：</p><ul><li>结构化数据存储：用于存储结构化数据，如关系数据库、NoSQL 数据库等。</li><li>非结构化数据存储：用于存储非结构化数据，如文本、图片、视频等。</li></ul><p>常用的大数据存储技术包括：</p><ul><li>关系数据库：用于存储结构化数据，如业务数据、用户数据等。  </li><li>NoSQL 数据库：用于存储非结构化数据，如日志数据、图片数据等。</li><li>分布式文件系统：用于存储大规模的文件数据，如图像、视频等。</li></ul><p><strong>数据分析</strong> 是指对数据进行分析，以发现其中的规律和趋势的过程。数据分析技术可以分为两类：</p><ul><li>传统数据分析：使用传统的统计方法进行数据分析。</li><li>机器学习：使用机器学习算法进行数据分析。</li></ul><p>常用的大数据分析技术包括：</p><ul><li>统计分析：用于对数据进行统计分析，如平均值、方差、标准差等。</li><li>机器学习：用于对数据进行机器学习分析，如分类、回归、聚类等。</li></ul><p><strong>数据可视化</strong> 是指将数据以图表、图形等方式呈现的过程。数据可视化可以帮助人们更直观地理解数据。</p><p>常用的数据可视化技术包括：</p><ul><li>图表：用于展示数据的趋势和分布。</li><li>图形：用于展示数据之间的关系。</li><li>地图：用于展示数据的地理分布。</li></ul><p>除了上述三大核心技术外，大数据分析生态还包括以下技术：</p><p><strong>数据管理</strong>：用于管理数据的生命周期，如数据采集、存储、分析、应用等。<br>
<strong>数据治理</strong>：用于确保数据的质量和安全。<br>
<strong>数据安全</strong>：用于保护数据免受攻击。  </p><p>大数据分析生态是一个不断发展的体系，随着技术的不断进步，新的技术也将不断涌现。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="openai-chatgpt-35">OpenAI ChatGPT 3.5<a class="hash-link" href="#openai-chatgpt-35" title="标题的直接链接">​</a></h3><p><img loading="lazy" alt="盘古开发框架-OpenAI ChatGPT 3.5" src="/assets/images/58-llm-993b7dadc6843c8b16156ff5cbaa5546.png" width="2468" height="1510" class="img_ev3q"></p><p>大数据分析生态系统包括多种技术和工具，用于收集、存储、处理和分析大规模数据。以下是其中一些核心技术。</p><ol><li><p><strong>分布式存储系统</strong>：用于存储海量数据的系统，如Hadoop分布式文件系统（HDFS）、Amazon S3、Google Cloud Storage 等。</p></li><li><p><strong>分布式计算框架</strong>：用于在大规模数据集上执行计算任务的系统，如 Apache Hadoop（MapReduce）、Apache Spark 等。</p></li><li><p><strong>数据处理和清洗工具</strong>：用于清洗、转换和准备数据的工具，如Apache NiFi、Apache Kafka、Apache Flink 等。</p></li><li><p><strong>数据仓库</strong>：用于集成和管理数据的存储系统，如 Apache Hive、Amazon Redshift、Google BigQuery 等。</p></li><li><p><strong>NoSQL 数据库</strong>：非关系型数据库，适用于大规模、高性能的数据存储和检索，如 MongoDB、Cassandra、Redis 等。</p></li><li><p><strong>数据可视化工具</strong>：将数据转换成可视化图表和报表，如 Tableau、Power BI、Matplotlib 等。</p></li><li><p><strong>机器学习和人工智能</strong>：用于在大数据集上进行模型训练和预测的技术，如 TensorFlow、PyTorch、Scikit-learn 等。</p></li><li><p><strong>流数据处理</strong>：处理实时数据流的技术，如 Apache Kafka、Apache Flink、Spark Streaming 等。</p></li><li><p><strong>容器化和编排技术</strong>：用于构建、部署和管理大数据应用程序的容器化环境，如 Docker、Kubernetes 等。</p></li></ol><p>这些技术共同构成了大数据分析生态系统，为企业和组织提供了处理和分析大规模数据的能力，帮助他们从数据中获得洞见和价值。</p>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="大数据分析" term="大数据分析"/>
        <category label="LLM" term="LLM"/>
        <category label="大语言模型" term="大语言模型"/>
        <category label="AIGC" term="AIGC"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[基于 Caddy 部署盘古 Admin]]></title>
        <id>deploy-pangu-admin-by-caddy</id>
        <link href="https://xiongchun.github.io/blog/deploy-pangu-admin-by-caddy"/>
        <updated>2022-10-02T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[本文以部署盘古 Admin 在线演示系统为例讲解如何基于 Caddy 部署盘古 Admin 的静态资源和 Web 节点（业务网关）。]]></summary>
        <content type="html"><![CDATA[<p>本文以部署盘古 Admin 在线演示系统为例讲解如何基于 Caddy 部署盘古 Admin 的静态资源和 Web 节点（业务网关）。<br>
<!-- -->部署效果：<a href="https://pangu-admin.pulanit.com/" target="_blank" rel="noopener noreferrer">https://pangu-admin.pulanit.com</a></p><ul><li>充当 WebServer 部署项目静态网站。</li><li>充当流量网关方向代理后端的 Web 节点（业务网关）。</li><li>全站自动 SSL。包含静态网站和 API 请求。</li><li>解决跨域请求；解决前端 https 后端 http 的协议适配问题。</li></ul><blockquote><p>nginx 也可以做同样的事情。</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="解析二级域名">解析二级域名<a class="hash-link" href="#解析二级域名" title="标题的直接链接">​</a></h3><p>登录域名服务商控制台，添加一条二级域名 <code>pangu-admin.pulanit.com</code> 的解析记录。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="修改配置文件">修改配置文件<a class="hash-link" href="#修改配置文件" title="标题的直接链接">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># vi /etc/caddy/Caddyfile</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pangu-admin.pulanit.com </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Set this path to your site's directory.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        root * /var/www/pangu-admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        encode </span><span class="token function" style="color:#d73a49">gzip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Enable the static file server.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        file_server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Another common task is to set up a reverse proxy:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reverse_proxy /api/* </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># 可以指定多个后端业务网关 WEB 节点</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          to localhost:8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>静态资源文件上传到目录：<code>/var/www/pangu-admin</code>。</li><li>后端 Dubbo 微服务集群的部署不在本文讨论范围，本文仅通过 Caddy 反向代理后后端业务网关。</li><li>通过如上配置，网站和 API 自动都拥有了 https 的能力。</li></ul><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_S0QG"><p>上述部署结构，使得静态网站和 API 处于同一域名下，解决了跨域的问题。但如果 API 需要反向代理到不同的端口下或者域名下，则可以设置业务网关的参数开启跨域支持，也可以在 Caddy 配置文件配置响应头参数以支持跨域访问。</p></div></div><blockquote><p>关于 <a href="https://caddyserver.com/" target="_blank" rel="noopener noreferrer">Caddy</a> 中间件的介绍和基础使用，可以参考我的另外一篇文章。<a href="/blog/deploy-pangu-website-by-caddy">使用 Caddy 部署盘古项目官网</a></p></blockquote>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="技术杂文" term="技术杂文"/>
        <category label="中间件" term="中间件"/>
        <category label="运维" term="运维"/>
        <category label="Caddy" term="Caddy"/>
        <category label="盘古开发框架" term="盘古开发框架"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[盘古开发框架下通过 ShenYu 网关实现 HTTP 到 Dubbo 服务的代理]]></title>
        <id>pangu-dev-framework-apache-shenyu</id>
        <link href="https://xiongchun.github.io/blog/pangu-dev-framework-apache-shenyu"/>
        <updated>2022-01-29T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[盘古开发框架 提供了两种实现微服务网关的方案（详见这里）。本文主要介绍基于 Apache ShenYu 的泛化调用模式。]]></summary>
        <content type="html"><![CDATA[<p><a href="https://github.com/xiongchun/pangu-framework" target="_blank" rel="noopener noreferrer">盘古开发框架</a> 提供了两种实现微服务网关的方案（<a href="https://xiongchun.github.io/pangu-framework/docs/quick-start/gateway/intro" target="_blank" rel="noopener noreferrer">详见这里</a>）。本文主要介绍基于 Apache ShenYu 的泛化调用模式。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="shenyu-网关介绍">ShenYu 网关介绍<a class="hash-link" href="#shenyu-网关介绍" title="标题的直接链接">​</a></h2><p>ShenYu 网关基于 WebFlex 非阻塞模型通过泛化调用后端 Dubbo 服务。不需要引入服务接口包即可调用后端 Dubbo 服务转换为 HTTP API。同时网关支持鉴权、动态限流、熔断、防火墙、灰度发布等。</p><ul><li><strong>实现原理</strong><br>基于 Spring Webflex，依赖 Netty 框架或 Servlet 3.1+ 容器。</li><li><strong>Dubbo 集成</strong><br>不依赖接口 JAR，泛化调用 Dubbo 服务。（需要维护接口元数据，有一定的性能损耗）</li><li><strong>性能 &amp; 复杂度</strong><br>网关自身性能较高（Webflex非阻塞模型）。部署和运维网关系统带来一定的成本。</li><li><strong>其它特性</strong><br>支持流量控制、鉴权、熔断、可观测性等。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="相关名词解释">相关名词解释<a class="hash-link" href="#相关名词解释" title="标题的直接链接">​</a></h3><ul><li><strong>shenyu-admin</strong><br>网关插件和元数据信息配置管理后台。独立 JAR，需要单独部署。</li><li><strong>shenyu-gateway</strong><br>网关模块，代理 Http 请求，泛化调用后端 Dubbo 服务。此模块负责接收 Http 请求。</li><li><strong>数据同步</strong><br>数据同步是指在 ShenYu-Admin 后台操作数据以后，使用何种策略将数据同步到 ShenYu Gateway 网关模块。ShenYu 当前支持 ZooKeeper、WebSocket、Http 长轮询、Nacos 、Etcd 和 Consul 进行数据同步。盘古开发使用的是 WebSocket 方式进行数据同步。</li><li><strong>插件</strong><br>ShenYu 使用插件化设计思想，实现插件的热插拔。内置丰富的插件，包括 RPC 代理、熔断和限流、权限认证、监控等等。</li><li><strong>选择器</strong><br>每个插件可设置多个选择器，对流量进行初步筛选。</li><li><strong>规则</strong><br>每个选择器可设置多个规则，对流量进行更细粒度的控制。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="网关调用结构图">网关调用结构图<a class="hash-link" href="#网关调用结构图" title="标题的直接链接">​</a></h3><p><img loading="lazy" alt="盘古网关系统" src="/assets/images/9-pangu-framework-shenyu-268b830aa5b8f7bbedf8afa2685721ec.png" width="1248" height="626" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="shenyu-网关实战">ShenYu 网关实战<a class="hash-link" href="#shenyu-网关实战" title="标题的直接链接">​</a></h2><p>ShenYu 网关提供的功能非常多，这里我们只关注 HTTP 请求代理功能。即代理前端 HTTP 请求，通过 Dubbo 泛化调用后端 Dubbo 服务。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装相关模块">安装相关模块<a class="hash-link" href="#安装相关模块" title="标题的直接链接">​</a></h3><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">盘古 Parent</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">基础模块</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Dubbo 模块</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">网关模块</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-parent</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">latest.version.xxx</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">relativePath</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-dubbo-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">org.springframework.boot</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">spring-boot-starter-webflux</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">org.apache.shenyu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">shenyu-spring-boot-starter-gateway</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">org.apache.shenyu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">shenyu-spring-boot-starter-sync-data-websocket</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">org.apache.shenyu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">shenyu-spring-boot-starter-plugin-apache-dubbo</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_S0QG"><p>基于 ShenYu 网关开发模式不需要引入 Dubbo 服务接口 Jar，网关会根据服务接口的元数据信息，泛化调用 Dubbo 服务接口。服务接口的元数据信息则根据 Dubbo 服务应用中的配置自动上传到 ShenYu 网关管理系统。此内容在下文会继续讲解。</p></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本地配置">本地配置<a class="hash-link" href="#本地配置" title="标题的直接链接">​</a></h3><blockquote><p>为便于理解，本文基于本地配置的方式编写。若改为标准的 Nacos 配置中心模式，请参阅：<a href="https://xiongchun.github.io/pangu-framework/docs/advanced-guide/nacos-config-center" target="_blank" rel="noopener noreferrer">配置中心</a> 章节。</p></blockquote><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">server</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">port</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9090</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">spring</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">main</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    allow</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">bean</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">definition</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">overriding</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">shenyu</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">cross</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">enabled</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">allowedHeaders</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">allowedMethods</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"*"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">allowedOrigin</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"*"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">allowedExpose</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"*"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">maxAge</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"18000"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">allowCredentials</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">switchConfig</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">local</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">file</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">enabled</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">maxSize</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">sync</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">websocket</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">urls</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">shenyu</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">websocket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">urls</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">ws</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">localhost</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">9095</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">websocket</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">dubbo</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">parameter</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> multi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">exclude</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">enabled</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">paths</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">favicon</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ico</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">extPlugin</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">enabled</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">threads</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">scheduleTime</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">300</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">scheduleDelay</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">scheduler</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">enabled</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> fixed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">threads</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">upstreamCheck</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">enabled</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">timeout</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">healthyThreshold</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">unhealthyThreshold</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">interval</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">printEnabled</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">printInterval</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="关键配置项说明">关键配置项说明<a class="hash-link" href="#关键配置项说明" title="标题的直接链接">​</a></h4><ul><li><strong>shenyu.sync.websocket.urls</strong><br>表示网关和 ShenYu Admin 之间使用 Websocket 的方式进行数据同步，这里是配置 ShenYu Admin 提供的 Websocket 数据同步服务的地址（支持集群，逗号分割）。</li></ul><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_S0QG"><p>上表中提到到 ShenYu Admin 是 ShenYu 网关框架的配置 &amp; 元数据管理后台。这里包含了网关模块自己的配置信息也包含了后台服务接口元数据信息，这理的配置信息和元数据信息需要和网关模块同步。ShenYu 支持多种数据同步方案，Websocket 只是盘古开发选用的一种缺省方案。</p></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="调用微服务接口">调用微服务接口<a class="hash-link" href="#调用微服务接口" title="标题的直接链接">​</a></h3><p>基于 ShenYu 的网关开发模式既不需要引入服务接口 JAR，也不需要编写具体的调用代码。完全由网关根据服务接口元数据进行 Dubbo 泛化调用。</p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>那么问题来了，网关是如何知道 Dubbo 服务接口元数据的呢？</div><div class="admonitionContent_S0QG"><ul><li>通过 ShenYu Admin 后台系统，『基础配置-&gt;元数据管理』菜单，手工新增每一个接口的元数据，然后将数据自动同步到网关模块。（不建议，量大的话太繁琐）</li><li>对Dubbo服务提供者增加 ShenYu Client 支持，通过在接口方法上使用注解 <code>@ShenyuDubboClient</code> 来自动采集上传接口元数据到 ShenYu Admin，然后将数据自动同步到网关模块。（具体实现见下文所述）</li></ul></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="改造-dubbo-服务端自动上传接口元数据">改造 Dubbo 服务端，自动上传接口元数据<a class="hash-link" href="#改造-dubbo-服务端自动上传接口元数据" title="标题的直接链接">​</a></h4><p>对原 Dubbo 服务端做一些配置变更，使其能自动将接口元数据上传到 ShenYu Admin 后台系统。
<strong>安装 ShenYu Client 依赖包</strong></p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">org.apache.shenyu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">shenyu-spring-boot-starter-client-apache-dubbo</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>增加配置项</strong></p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">shenyu</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">register</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shenyu</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">server</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">lists</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">shenyu</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">server</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">lists</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">http</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">localhost</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">9095</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shenyu</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">contextPath</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">dubbo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>shenyu.client.register-type</strong><br>服务接口元数据采集方式，可选 http 直连模式或配置中心 zookeeper、etcd、consul 和 nacos。盘古开发采集接口元数据缺省选择 http 直接 ShenYu Admin 的方式。</li><li><strong>shenyu.client.server-lists</strong><br>ShenYu Admin 地址或配置中心地址。集群时多个地址用逗号分开。</li><li><strong>shenyu.client.props.contextPath</strong><br>本服务在网关中的路由前缀,可自定义按需配置。</li></ul><p><strong>自动上报服务接口元数据</strong><br>
<!-- -->在 Dubbo 服务实现类的方法上使用注解 <code>@ShenyuDubboClient</code> 标记，表示该接口方法元数据自动上传到 ShenYu Admin。如下代码所示。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:#d73a49">Service</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"1.0.0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> group </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"pangu-examples-dubbo-gateway-service"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">UserServiceImpl</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">implements</span><span class="token plain"> </span><span class="token class-name">UserService</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token maybe-class-name">Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token function maybe-class-name" style="color:#d73a49">ShenyuDubboClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/findUserEntity"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> desc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"查询用户信息"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token maybe-class-name">UserEntity</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">findUserEntity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter maybe-class-name">Long</span><span class="token parameter"> id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> userEntity</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>配置网关泛化调用 Dubbo 服务所需的注册中心地址</strong><br>
<!-- -->通过 ShenYu Admin 后台系统『基础配置-&gt;插件管理』菜单，启用 <code>dubbo插件</code> 并填入注册中心地址。比如，我测试用的注册中心地址：<code>nacos://169.188.88.140:1688?namespace=pangu-dev</code>。如下图所示。</p><p><img loading="lazy" alt="盘古框架网关" src="/assets/images/4-pangu-framework-shenyu-dubbo-8571bbae9d99ba6e3c2b539b5409af0b.png" width="2848" height="1360" class="img_ev3q"></p><p><strong>重启服务提供者</strong>  </p><ul><li>进入 ShenYu Admin 后台系统的『基础配置-&gt;元数据管理』菜单，会看到自动上报的服务元数据信息。如下图所示。</li></ul><p><img loading="lazy" alt="盘古开发网关" src="/assets/images/2-pangu-framework-shenyu-metadata-b69293c799df617306c587fdcb78dd94.png" width="2860" height="912" class="img_ev3q"></p><ul><li>进入 ShenYu Admin 后台系统的『插件列表-&gt; proxy -&gt; dubbo』菜单，会看到自动注册的选择器和规则信息。如下图所示。</li></ul><p><img loading="lazy" alt="盘古开发网关" src="/assets/images/3-pangu-framework-shenyu-plugin-3b3a6ed16d27836a25a2a7037423f553.png" width="2842" height="652" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启动入口">启动入口<a class="hash-link" href="#启动入口" title="标题的直接链接">​</a></h3><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">SpringBootApplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">WebApiGatewayApplication</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter known-class-name class-name">String</span><span class="token parameter punctuation" style="color:#393A34">[</span><span class="token parameter punctuation" style="color:#393A34">]</span><span class="token parameter"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">PanGuApplicationBuilder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">WebApiGatewayApplication</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="网关请求url">网关请求URL<a class="hash-link" href="#网关请求url" title="标题的直接链接">​</a></h3><p>至此，网关就可以调用 Dubbo 服务了。但是，如何确定 Dubbo 服务对应的请求 url 地址呢？</p><ul><li>由网关模块配置文件可知网关应用端口是 <code>9090</code>。</li><li>Dubbo 服务的配置项 shenyu.client.props.contextPath 为 <code>/dubbo</code>。</li><li>Dubbo 方法通过 @ShenyuDubboClient 标记的 path 属性为：<code>/findUserEntity</code>。  </li></ul><p>综上，Dubbo 服务 UserService#findUserEntity 的完整请求地址为：<code>http://localhost:9090/dubbo/findUserEntity</code>。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="参数说明">参数说明<a class="hash-link" href="#参数说明" title="标题的直接链接">​</a></h4><p>通过 http 协议，post 方式访问网关。在 http body 中传入 json 格式的参数。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="请求示例">请求示例<a class="hash-link" href="#请求示例" title="标题的直接链接">​</a></h4><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">CURL脚本</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl </span><span class="token operator" style="color:#393A34">--</span><span class="token dom variable" style="color:#36acaa">location</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">request </span><span class="token constant" style="color:#36acaa">POST</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'http://127.0.0.1:9090/dubbo/findUserEntity'</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">--</span><span class="token plain">header </span><span class="token string" style="color:#e3116c">'Content-Type: application/json'</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">--</span><span class="token plain">data </span><span class="token string" style="color:#e3116c">'{id=1}'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">返回结果</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"code"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"message"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Access to success!"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"data"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"name"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"云南程序员老熊"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"id"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"userType"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本范例源码">本范例源码<a class="hash-link" href="#本范例源码" title="标题的直接链接">​</a></h3><ul><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-dubbo-api" target="_blank" rel="noopener noreferrer">pangu-examples-dubbo-api</a>：Dubbo 服务接口包</li><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-dubbo-gateway-shenyu-service" target="_blank" rel="noopener noreferrer">pangu-examples-dubbo-gateway-shenyu-service</a>：Dubbo 服务提供者（支持接口元数据上传到网关系统）</li><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-webapi-gateway-shenyu-based" target="_blank" rel="noopener noreferrer">pangu-examples-webapi-gateway-shenyu-based</a>：基于 ShenYu 网关将 Dubbo 服务发布为 HTTP 接口</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="参考文献">参考文献<a class="hash-link" href="#参考文献" title="标题的直接链接">​</a></h2><ul><li><a href="https://xiongchun.github.io/pangu-framework/docs/quick-start/how-to-create-http-api" target="_blank" rel="noopener noreferrer">如何发布微服务 (API 网关)</a></li><li><a href="https://xiongchun.github.io/pangu-framework/docs/intro" target="_blank" rel="noopener noreferrer">盘古开发框架简介</a></li></ul>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="中间件" term="中间件"/>
        <category label="ShenYu" term="ShenYu"/>
        <category label="盘古开发框架" term="盘古开发框架"/>
        <category label="服务端开发" term="服务端开发"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[TLog 助力盘古框架实现微服务链路日志追踪]]></title>
        <id>tlog</id>
        <link href="https://xiongchun.github.io/blog/tlog"/>
        <updated>2022-01-03T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[随着微服务盛行，很多公司都把系统按照业务边界拆成了很多微服务。因此业务链路贯穿着很多微服务节点，导致定位某个请求的日志以及上下游业务的日志会变得非常困难。]]></summary>
        <content type="html"><![CDATA[<p>随着微服务盛行，很多公司都把系统按照业务边界拆成了很多微服务。因此业务链路贯穿着很多微服务节点，导致定位某个请求的日志以及上下游业务的日志会变得非常困难。</p><p>为了解决这一痛点， 业界也有诸多成熟方案。如 SkyWalking，Pinpoint 等，但其运维成本和数据存储成本均不可小觑。如果有相应的资源去做那它们自然是不二之选。 但如果你资源有限，那么这里给出一个非常轻量的通过集成 TLog 来解决日志追踪问题的方案。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="tlog-是什么">TLog 是什么？<a class="hash-link" href="#tlog-是什么" title="标题的直接链接">​</a></h2><p>TLog 提供了一种最简单的方式来解决日志追踪问题，它不收集日志，也不需要另外的存储空间，它只是自动的对你的日志进行打标签，自动生成 TraceId 贯穿你微服务的一整条链路中。并且提供上下游节点信息。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="集成-tlog">集成 TLog<a class="hash-link" href="#集成-tlog" title="标题的直接链接">​</a></h2><p>盘古开发框架已将 TLog 作为缺省标准组件集成进盘古基础模块：<code>pangu-spring-boot-starter</code>。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="如何使用">如何使用<a class="hash-link" href="#如何使用" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="第一步依赖盘古基础模块">第一步：依赖盘古基础模块<a class="hash-link" href="#第一步依赖盘古基础模块" title="标题的直接链接">​</a></h3><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="第二步启动类调用日志增强方法">第二步：启动类调用日志增强方法<a class="hash-link" href="#第二步启动类调用日志增强方法" title="标题的直接链接">​</a></h3><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">AspectLogEnhance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">enhance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="第三步分别构造盘古消费者微服务和生产者微服务">第三步：分别构造盘古消费者微服务和生产者微服务<a class="hash-link" href="#第三步分别构造盘古消费者微服务和生产者微服务" title="标题的直接链接">​</a></h3><p>参见如下盘古范例模块。<a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples" target="_blank" rel="noopener noreferrer">获取代码</a></p><ul><li>pangu-examples-dubbo-service 服务生产者</li><li>pangu-examples-webapi-dubbo-service-based 服务消费者</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="查看日志输出效果">查看日志输出效果<a class="hash-link" href="#查看日志输出效果" title="标题的直接链接">​</a></h2><p>我们在一个 Dubbo 服务消费者和一个 Dubbo 服务生产者应用中分别做如上配置后，就可以在每个调用链的日志里看到 TLog 自定嵌入的 TraceId 标签值 <code>10812814178142336</code>。如下所示。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">消费端：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2022</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">06</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">23</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">14</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">40</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">50</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">INFO</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">47050</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">nio</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">8080</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">exec</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">x</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">DemoController</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10812814178142336</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> call case1</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">生产端：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2022</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">06</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">23</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">14</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">40</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">50</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">INFO</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">46395</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">20881</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">thread</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">x</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">UserServiceImpl</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10812814178142336</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">参数userIn：UserInDto</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> userType</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果是 HTTP 调用，则 TraceId 标签值 <code>10812814178142336</code> 会写入到 HTTP 请求的响应标题中。如下所示。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">tlogTraceId: 10812814178142336</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="技术杂文" term="技术杂文"/>
        <category label="运维" term="运维"/>
        <category label="TLog" term="TLog"/>
        <category label="盘古开发框架" term="盘古开发框架"/>
        <category label="服务端开发" term="服务端开发"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[盘古数字化赋能开发框架简介]]></title>
        <id>pangu-dev-framework-intro</id>
        <link href="https://xiongchun.github.io/blog/pangu-dev-framework-intro"/>
        <updated>2021-12-30T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[盘古开发框架 是一套轻量稳健的工业级前、中、后台三维多端行业数字化赋能开发基座。基于 Apache 协议免费开源发布，希望与开源社区一起 分享经验传递价值，共建共享开源生态。]]></summary>
        <content type="html"><![CDATA[<p><strong>盘古开发框架</strong> 是一套轻量稳健的工业级前、中、后台三维多端行业数字化赋能开发基座。基于 <a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener noreferrer">Apache</a> 协议<span style="background-color:#25c2a0;border-radius:3px;color:#fff;padding:0.1rem;margin:0.2rem">免费开源</span>发布，希望与开源社区一起 <strong>分享经验传递价值，共建共享开源生态</strong>。</p><p>盘古开发框架由如下三个生态子项目组成。</p><ul><li><p><a href="/docs/intro"><strong>盘古微服务开发框架</strong></a><br>
<!-- -->一套构建以「服务」为中心的现代应用架构，用户可以开发、管理自己的微服务应用。</p></li><li><p><a href="/admin/intro"><strong>盘古中后台业务系统开发脚手架</strong></a><br>
<!-- -->一套预置了权限系统的中后台统一解决方案，用户可以基于此快速搭建中后台业务系统前后端二次开发脚手架。</p></li><li><p><a href="/app/intro"><strong>盘古移动端多平台开发脚手架</strong></a><br>
<!-- -->一套移动端多平台快速开发脚手架，用户可以快速开发 Android / IOS 应用、微信小程序、H5 应用。</p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="适用场景">适用场景<a class="hash-link" href="#适用场景" title="标题的直接链接">​</a></h2><p>基于盘古开发框架的前、中、后台三维多端行业数字化赋能能力，用户既能快速构建面向互联网的电商、金融、云端 SaaS 等大并发高可用可扩展的互联网应用场景服务，同时也能满足诸如 ERP 、CRM 等各种企业数字化和各级电子政务系统的中小规模业务开发需求。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="设计原则">设计原则<a class="hash-link" href="#设计原则" title="标题的直接链接">​</a></h2><p>在类设计、模块结构划分、技术组件选型、框架体系架构设计时会优先遵循的一些设计范式和指导原则。</p><ul><li><strong>极简原则</strong><br>大道至简，简单代表好用、稳定、易协作。坚持「Keep it Simple &amp; Stupid」设计理念。</li><li><strong>服务优先原则</strong><br>「服务」是盘古开发框架的一等公民，旨在微服务和云原生范式基础上构建「以服务为中心」的现代应用架构。</li><li><strong>最佳实践原则</strong><br>通过大量的生产实例检验，沉淀复用最佳实践。</li><li><strong>透明原则</strong><br>不做无意义、故弄玄虚的封装；坚持组合优于继承，杜绝黑盒子；践行「Less is More」设计理念。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="核心价值链">核心价值链<a class="hash-link" href="#核心价值链" title="标题的直接链接">​</a></h2><ul><li><strong>初级程序员</strong><br>盘古助你成长为独挡一面的全栈开发攻城狮，成为团队里最靓的那个仔。</li><li><strong>中、高级程序员</strong><br>盘古助你成长为手持魔杖的全能型架构师 or 技术砖家。</li><li><strong>架构师、技术决策者</strong><br>盘古助你规避技术选型试错风险，优化自己的架构工具箱，更好的为业务服务。</li><li><strong>企业、组织</strong><br>盘古为你降低用人成本，夯实企业数字化基座，真正做到降本增效好帮手，持续助力企业业务增长。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="生态架构示意图">生态架构示意图<a class="hash-link" href="#生态架构示意图" title="标题的直接链接">​</a></h2><img loading="lazy" width="700" src="/assets/images/34-pangu-framework-0de7df15d6292c72e5ec79f6ee6b2e0b.png" alt="盘古开发框架生态架构图" class="img_ev3q"><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="仓库模块列表">仓库模块列表<a class="hash-link" href="#仓库模块列表" title="标题的直接链接">​</a></h2><ul><li><strong>pangu-dependencies</strong><br>盘古资源依赖声明管理模块。</li><li><strong>pangu-spring-boot-starter</strong><br>盘古启动器、中心化配置、基础类库等基自动装配模块</li><li><strong>pangu-generator-maven-plugin</strong><br>盘古代码生成器Maven插件</li><li><strong>pangu-admin</strong><br>盘古 Admin 中后台业务系统开发脚手架</li><li><strong>pangu-app-starter</strong><br>盘古 APP 移动端多平台开发脚手架</li><li><strong>pangu-website</strong><br>盘古框架官网 &amp; 文档教程</li><li><strong>pangu-examples</strong><br>盘古框架模版化参考范例集</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="重要的事情说三遍">重要的事情说三遍<a class="hash-link" href="#重要的事情说三遍" title="标题的直接链接">​</a></h2><p>盘古开发框架终身永久<span style="background-color:#67C23A;border-radius:3px;color:#fff;padding:0.1rem;margin:0.2rem">免费开源</span><span style="background-color:#409EFF;border-radius:3px;color:#fff;padding:0.1rem;margin:0.2rem">免费开源</span><span style="background-color:#F56C6C;border-radius:3px;color:#fff;padding:0.1rem;margin:0.2rem">免费开源</span>！ (请勿再咨询此问题)</p>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="服务端开发" term="服务端开发"/>
        <category label="盘古开发框架" term="盘古开发框架"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[如何进行盘古微服务网关开发]]></title>
        <id>deploy-pangu-dev-framework-create-microservice-as-webapi</id>
        <link href="https://xiongchun.github.io/blog/deploy-pangu-dev-framework-create-microservice-as-webapi"/>
        <updated>2021-02-08T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[在上文《如何开发微服务应用》中，已经介绍了如何开发一个微服务应用以及微服务模块之间的互相调用。本文主要讨论如何将微服务发布为 HTTP 接口供前端调用。（HTTP -> Dubbo Provider）]]></summary>
        <content type="html"><![CDATA[<p>在上文<a href="/blog/pangu-dev-framework-create-microservice">《如何开发微服务应用》</a>中，已经介绍了如何开发一个微服务应用以及微服务模块之间的互相调用。本文主要讨论如何将微服务发布为 HTTP 接口供前端调用。（HTTP -&gt; Dubbo Provider）</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="技术实现方案">技术实现方案<a class="hash-link" href="#技术实现方案" title="标题的直接链接">​</a></h2><p>在盘古开发框架下实现将微服务发布为 HTTP 接口有两种方式。  </p><ul><li><strong><a href="https://xiongchun.github.io/pangu-framework/docs/quick-start/gateway/webmvc" target="_blank" rel="noopener noreferrer">基于 Spring WebMVC 的接口调用模式</a></strong><br>严格意义上说，这只能算是一种将 Dubbo 服务包装为 HTTP 接口的传统模式。并不能算真正意义上的网关。</li><li><strong><a href="https://xiongchun.github.io/pangu-framework/docs/quick-start/gateway/shenyu" target="_blank" rel="noopener noreferrer">基于 Apache ShenYu 的泛化调用模式</a></strong><br>一种标准的网关实现。访问：<a href="https://shenyu.apache.org/" target="_blank" rel="noopener noreferrer">Apache ShenYu</a>。</li><li><strong>其它</strong><br>网关的实现方式或现成技术组件还很多。比如：你也可以自己在 WebMVC 或者 WebFlex 框架上实现 Dubbo 泛化调用；其次，除 ShenYu 之外，Dubbo 官方也 <a href="https://cn.dubbo.apache.org/zh-cn/overview/what/ecosystem/gateway/" target="_blank" rel="noopener noreferrer">推荐了几款的网关组件可以选择</a>。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="技术方案选型对比">技术方案选型对比<a class="hash-link" href="#技术方案选型对比" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="基于-spring-webmvc-的接口调用模式">基于 Spring WebMVC 的接口调用模式<a class="hash-link" href="#基于-spring-webmvc-的接口调用模式" title="标题的直接链接">​</a></h3><ul><li><strong>实现原理</strong><br>基于 Spring WebMVC，本质上是 Servlet 同步请求机制，依赖 Servlet 容器。</li><li><strong>Dubbo 集成</strong><br>依赖接口 JAR ，通过接口调用 Dubbo 服务。</li><li><strong>性能 &amp; 复杂度</strong><br>性能高，开发简单，部署运维简单。</li><li><strong>其它特性</strong>  <ul><li>关于跨域配置、流量控制、鉴权、熔断、白名单等（盘古 Web 模块提供了部分功能）。</li><li>提供了Controller聚合层，可一定程度上减少了微服务之间的循环依赖和调用。</li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="基于-apache-shenyu-的泛化调用模式">基于 Apache ShenYu 的泛化调用模式<a class="hash-link" href="#基于-apache-shenyu-的泛化调用模式" title="标题的直接链接">​</a></h3><ul><li><strong>实现原理</strong><br>基于 Spring Webflex，依赖 Netty 框架或 Servlet 3.1+ 容器。</li><li><strong>Dubbo 集成</strong><br>不依赖接口 JAR，泛化调用 Dubbo 服务。（需要维护接口元数据，有一定的性能损耗）</li><li><strong>性能 &amp; 复杂度</strong><br>网关自身性能较高（Webflex非阻塞模型）。部署和运维网关系统带来一定的成本。</li><li><strong>其它特性</strong><br>支持流量控制、鉴权、熔断、可观测性等。</li></ul><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>提示</div><div class="admonitionContent_S0QG"><p>上述是从不同维度简单粗暴的以定性的角度给出了一些比较，结论是孤立且脱离项目背景和业务场景的，仅供参考。采用什么样的开发模式不能一概而论，需要综合实际情况酌情选择。但对于大部分盘古开发项目而言，我们推荐整体性价比较高的方案一。当然，如果您的项目背景适合使用 ShenYu 网关，我们也给出了 <a href="http://localhost:3000/blog/pangu-dev-framework-apache-shenyu" target="_blank" rel="noopener noreferrer">详细的集成方案</a>，这也会是一个不错的选择。</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="编程实战一基于-spring-webmvc-的接口调用模式">编程实战一：基于 Spring WebMVC 的接口调用模式<a class="hash-link" href="#编程实战一基于-spring-webmvc-的接口调用模式" title="标题的直接链接">​</a></h2><p>此种模式基于 SpringMVC 通过 Controller 调用后端 Dubbo 服务。依赖 Servlet 容器，需要引入服务接口包。对于 HTTP 接口层面的鉴权、流控等需求都需要基于拦截器来实现。高可用和性能提升可通过Caddy/Nginx 充当 API 网关 反向代理后端多个 Web 节点实现。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装相关盘古模块">安装相关盘古模块<a class="hash-link" href="#安装相关盘古模块" title="标题的直接链接">​</a></h3><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">盘古 Parent</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">基础模块</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Dubbo模块</li><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Web模块</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">服务接口包</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-parent</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">latest.version.xxx</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">relativePath</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-dubbo-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6"><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-web-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-examples-dubbo-api</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">1.0.0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本地配置">本地配置<a class="hash-link" href="#本地配置" title="标题的直接链接">​</a></h3><blockquote><p>为便于理解，本文基于本地配置的方式编写。若改为标准的 Nacos 配置中心模式，请参阅：<a href="https://xiongchun.github.io/pangu-framework/docs/advanced-guide/nacos-config-center" target="_blank" rel="noopener noreferrer">配置中心</a> 章节。</p></blockquote><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">application</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">webapi</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">dubbo</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">service</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">based</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jackson</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">time</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">zone</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">GMT</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pangu</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">web</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cross</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">origin</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">protocol</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">dubbo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">protocol</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">port</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">consumer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">registry</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">address</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nacos</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">nacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">server</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">addr</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">?</span><span class="token plain">namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">nacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">namespace</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">consumer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">check</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">root</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">INFO</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="调用微服务接口">调用微服务接口<a class="hash-link" href="#调用微服务接口" title="标题的直接链接">​</a></h3><p>可以在任何一个 SpringBean 组件中（针对网关模块而言一般是 Controller 中），引入服务接口后就像本地接口调用一样调用远程服务。Dubbo 将提供高性能的基于代理的远程调用能力，服务以接口为粒度，为开发者屏蔽远程调用底层细节。
如下所示，通过 Cotroller 调用远程服务接口，实现将微服务接口发布为 WebAPI。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">DemoController.java</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 注入 Dubbo 服务接口</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:#d73a49">Reference</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"1.0.0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> group </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"pangu-examples-dubbo-service"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token maybe-class-name">UserService</span><span class="token plain"> userService</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 通过 Spring MVC 将 Duboo 微服务接口发布为 HTTP API</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:#d73a49">RequestMapping</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/case1"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token maybe-class-name">Result</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">List</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">UserOut</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">&gt; case1() </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"call case1..."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">UserIn</span><span class="token plain"> userIn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">UserIn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setUserType</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"1"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">List</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">UserOut</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> userOuts = userService.listUserOuts(userIn);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    return Result.success(userOuts);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启动入口">启动入口<a class="hash-link" href="#启动入口" title="标题的直接链接">​</a></h3><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">EnableDubbo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">SpringBootApplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">DubboProviderApplication</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter known-class-name class-name">String</span><span class="token parameter punctuation" style="color:#393A34">[</span><span class="token parameter punctuation" style="color:#393A34">]</span><span class="token parameter"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">PanGuApplicationBuilder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">DubboProviderApplication</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本范例源码">本范例源码<a class="hash-link" href="#本范例源码" title="标题的直接链接">​</a></h3><ul><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-dubbo-api" target="_blank" rel="noopener noreferrer">pangu-examples-dubbo-api</a>：Dubbo 服务接口包</li><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-dubbo-service" target="_blank" rel="noopener noreferrer">pangu-examples-dubbo-service</a>：Dubbo 服务提供者</li><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-webapi-dubbo-service-based" target="_blank" rel="noopener noreferrer">pangu-examples-webapi-dubbo-service-based</a>：基于 Spring Controller 将 Dubbo 服务发布为 HTTP 接口</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="编程实战二基于-shenyu-网关的泛化调用模式">编程实战二：基于 ShenYu 网关的泛化调用模式<a class="hash-link" href="#编程实战二基于-shenyu-网关的泛化调用模式" title="标题的直接链接">​</a></h2><p>详见：<a href="/blog/pangu-dev-framework-apache-shenyu">盘古开发框架集成 Apache ShenYu 网关</a>。</p>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="服务端开发" term="服务端开发"/>
        <category label="盘古开发框架" term="盘古开发框架"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[使用 Caddy 部署盘古项目官网]]></title>
        <id>deploy-pangu-website-by-caddy</id>
        <link href="https://xiongchun.github.io/blog/deploy-pangu-website-by-caddy"/>
        <updated>2021-02-02T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Caddy 2 is a powerful, enterprise-ready, open source web server with automatic HTTPS written in Go.]]></summary>
        <content type="html"><![CDATA[<p>Caddy 2 is a powerful, enterprise-ready, open source web server with automatic HTTPS written in Go.</p><p>— 摘自 <a href="https://caddyserver.com/" target="_blank" rel="noopener noreferrer">Caddy 官网</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="caddy-特性">Caddy 特性<a class="hash-link" href="#caddy-特性" title="标题的直接链接">​</a></h2><ul><li>缺省启用HTTP/2 协议，无需任何配置。</li><li>缺省全站HTTPS，无需任何配置。（自动申请和续期证书）</li><li>简单友好的配置文件，支持在线配置 API。</li><li>golang 开发，几乎无依赖，部署简单。</li><li>充当 API 流量网关, 反向代理后端多个 Web 节点（业务网关）。</li><li>天生插件架构，社区插件丰富，且自定义插件简单（写个插件顺便蹭一下 golang 的热度）。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="caddy-实战">Caddy 实战<a class="hash-link" href="#caddy-实战" title="标题的直接链接">​</a></h2><blockquote><p>Web Server 托管静态资源，以部署盘古开发框架项目官网为例。<a href="https://github.com/xiongchun/pangu-framework" target="_blank" rel="noopener noreferrer">https://github.com/xiongchun/pangu-framework</a></p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装">安装<a class="hash-link" href="#安装" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="fedora-rhelcentos-8">Fedora, RHEL/CentOS 8<a class="hash-link" href="#fedora-rhelcentos-8" title="标题的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ dnf </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'dnf-command(copr)'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ dnf copr </span><span class="token builtin class-name">enable</span><span class="token plain"> @caddy/caddy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ dnf </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> caddy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="rhelcentos-7">RHEL/CentOS 7<a class="hash-link" href="#rhelcentos-7" title="标题的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> yum-plugin-copr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ yum copr </span><span class="token builtin class-name">enable</span><span class="token plain"> @caddy/caddy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> caddy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="常用命令">常用命令<a class="hash-link" href="#常用命令" title="标题的直接链接">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ systemctl start</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">stop</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">restart</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> caddy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ systemctl reload caddy </span><span class="token comment" style="color:#999988;font-style:italic"># 重新加载配置文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ systemctl status caddy </span><span class="token comment" style="color:#999988;font-style:italic"># 查看运行状态</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="修改配置文件">修改配置文件<a class="hash-link" href="#修改配置文件" title="标题的直接链接">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># vi /etc/caddy/Caddyfile</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pangu.pulanit.com </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Set this path to your site's directory.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        root * /var/www/pangu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        encode </span><span class="token function" style="color:#d73a49">gzip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Enable the static file server.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        file_server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>静态资源文件上传到目录：<code>/var/www/pangu</code>。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="域名解析">域名解析<a class="hash-link" href="#域名解析" title="标题的直接链接">​</a></h3><p>域名解析地址必须和上述配置文件中的域名保持一致即可。尝试访问：<a href="https://github.com/xiongchun/pangu-framework" target="_blank" rel="noopener noreferrer">https://github.com/xiongchun/pangu-framework</a>。可见，<strong>网站自动开启了HTTPS</strong>。</p>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="技术杂文" term="技术杂文"/>
        <category label="中间件" term="中间件"/>
        <category label="运维" term="运维"/>
        <category label="Caddy" term="Caddy"/>
        <category label="盘古开发框架" term="盘古开发框架"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[如何基于盘古开发框架开发微服务应用]]></title>
        <id>pangu-dev-framework-create-microservice</id>
        <link href="https://xiongchun.github.io/blog/pangu-dev-framework-create-microservice"/>
        <updated>2021-01-20T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[本文介绍如何基于盘古开发框架 开发一个微服务应用。文中所述仅为搭建一个微服务应用的基本框架（服务注册&服务发现），如要增加配置中心、网关代理、数据持久化、缓存等能力请参考使用指南的相关章节。]]></summary>
        <content type="html"><![CDATA[<p>本文介绍如何基于<a href="https://github.com/xiongchun/pangu-framework" target="_blank" rel="noopener noreferrer">盘古开发框架</a> 开发一个微服务应用。文中所述仅为搭建一个微服务应用的基本框架（服务注册&amp;服务发现），如要增加配置中心、网关代理、数据持久化、缓存等能力请参考使用指南的相关章节。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="服务提供者">服务提供者<a class="hash-link" href="#服务提供者" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装相关盘古模块">安装相关盘古模块<a class="hash-link" href="#安装相关盘古模块" title="标题的直接链接">​</a></h3><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">盘古 Parent</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">基础模块</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Dubbo 模块</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">服务接口包</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-parent</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">latest.version.xxx</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">relativePath</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-dubbo-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-examples-dubbo-api</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">1.0.0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>警告</div><div class="admonitionContent_S0QG"><p>盘古框架微服务交互基于 Dubbo 提供的面向接口代理的高性能 RPC 调用能力。所以，对于内部服务模块之间的交互调用都需要依赖服务接口包。</p></div></div></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本地配置">本地配置<a class="hash-link" href="#本地配置" title="标题的直接链接">​</a></h3><blockquote><p>为便于理解，本文基于本地配置的方式编写。若改为标准的 Nacos 配置中心模式，请参阅：<a href="https://xiongchun.github.io/pangu-framework/docs/advanced-guide/nacos-config-center" target="_blank" rel="noopener noreferrer">配置中心</a> 章节。</p></blockquote><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">application.properties</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">application-dev.properties</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">profiles</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">active</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">profiles</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">active</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">dev</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">application</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">dubbo</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">protocol</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">dubbo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">protocol</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">20880</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">consumer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 服务注册中心地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">registry</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">address</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nacos</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">nacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">server</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">addr</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">?</span><span class="token plain">namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">nacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">namespace</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">consumer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">check</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 禁用 </span><span class="token maybe-class-name">Dubbo</span><span class="token plain"> 缺省的异常过滤器，盘古框架中启用了修改过的异常过滤器以支持直接抛出自定义的业务异常。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">provider</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">filter</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">exception</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">root</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">gitee</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pulanos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pangu</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">INFO</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="实现服务接口">实现服务接口<a class="hash-link" href="#实现服务接口" title="标题的直接链接">​</a></h3><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">声明接口 UserService.java</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token maybe-class-name">UserEntity</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">findUserEntity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Long</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">实现接口 UserServiceImpl.java</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:#d73a49">Service</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"1.0.0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> group </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"pangu-showcases-dubbo-service"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">UserServiceImpl</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">implements</span><span class="token plain"> </span><span class="token class-name">UserService</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token maybe-class-name">Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token maybe-class-name">UserEntity</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">findUserEntity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter maybe-class-name">Long</span><span class="token parameter"> id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"参数ID：{}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">UserEntity</span><span class="token plain"> userEntity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">UserEntity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        userEntity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        userEntity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"云南程序员老熊"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> userEntity</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启动入口">启动入口<a class="hash-link" href="#启动入口" title="标题的直接链接">​</a></h3><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">EnableDubbo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">SpringBootApplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">DubboProviderApplication</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter known-class-name class-name">String</span><span class="token parameter punctuation" style="color:#393A34">[</span><span class="token parameter punctuation" style="color:#393A34">]</span><span class="token parameter"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">PanGuApplicationBuilder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">DubboProviderApplication</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 启动参数设置（如下示例）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// -Dnacos.server-addr=127.0.0.1:8848 -Dnacos.namespace=pangu-dev</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_S0QG"><p>通过 <code>@EnableDubbo</code> 注解开启 Dubbo 支持。由于 Dubbo 的使用 netty 作为底层网络通信，所以缺省情况下微服务启动成功后观察控制台可知并没有 Tomcat 一类 Servlet 容器随之启动。</p></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="服务注册">服务注册<a class="hash-link" href="#服务注册" title="标题的直接链接">​</a></h3><p>成功启动应用会自动像 Nacos 服务注册中心注册服务。登录 Nacos 控制台即可在【服务管理-&gt;服务列表】页查看效果。如下图所示。</p><p><img loading="lazy" alt="盘古开发Dubbo服务" src="/assets/images/1-pangu-framework-nacos-service-regist-b8f879309f74a0ff44299f8d889ad6e8.png" width="2872" height="642" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="服务消费者">服务消费者<a class="hash-link" href="#服务消费者" title="标题的直接链接">​</a></h2><p>上述服务注册到 Nacos 服务中心以后就可以对外提供服务了。可以在任何一个 SpringBean 组件中（一般是 Service、Manager 等），引入服务接口后就像本地接口调用一样调用远程服务。Dubbo 将提供高性能的基于代理的远程调用能力，为开发者屏蔽远程调用底层细节。服务消费端所需要的依赖和提供端是一样的，这里不再赘述。仅给出消费相关代码。如下所示。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">服务消费端，调用远程服务代码 UserAdminManager.java</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">Component</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">UserAdminManager</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token function maybe-class-name" style="color:#d73a49">Reference</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"1.0.0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> group </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"pangu-examples-dubbo-service"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token maybe-class-name">UserService</span><span class="token plain"> userService</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">findUserEntityById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter maybe-class-name">Long</span><span class="token parameter"> id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"开始Dubbo远程调用..."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">UserEntity</span><span class="token plain"> userEntity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> userService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">findUserEntity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"[OK] 调用成功 {}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> userEntity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本文相关范例源码">本文相关范例源码<a class="hash-link" href="#本文相关范例源码" title="标题的直接链接">​</a></h2><ul><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-dubbo-api" target="_blank" rel="noopener noreferrer">pangu-examples-dubbo-api</a>：服务接口包</li><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-dubbo-service" target="_blank" rel="noopener noreferrer">pangu-examples-dubbo-service</a>：服务提供者</li><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-dubbo-consumer" target="_blank" rel="noopener noreferrer">pangu-examples-dubbo-consumer</a>：服务消费者</li></ul>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="服务端开发" term="服务端开发"/>
        <category label="盘古开发框架" term="盘古开发框架"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[如何基于盘古开发框架开发单体应用]]></title>
        <id>pangu-dev-framework-create-standalone-app</id>
        <link href="https://xiongchun.github.io/blog/pangu-dev-framework-create-standalone-app"/>
        <updated>2021-01-02T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[本文介绍如何基于盘古开发框架 开发一个单体分层架构的应用。文中所述仅为搭建一个单体应用的基本框架，增加配置中心、数据持久化、缓存等能力请参考 开发指南 的相关章节。]]></summary>
        <content type="html"><![CDATA[<p>本文介绍如何基于<a href="https://github.com/xiongchun/pangu-framework" target="_blank" rel="noopener noreferrer">盘古开发框架</a> 开发一个单体分层架构的应用。文中所述仅为搭建一个单体应用的基本框架，增加<strong>配置中心、数据持久化、缓存等能力</strong>请参考 <strong><a href="https://xiongchun.github.io/pangu-framework/docs/intro" target="_blank" rel="noopener noreferrer">开发指南</a></strong> 的相关章节。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="背景">背景<a class="hash-link" href="#背景" title="标题的直接链接">​</a></h2><p>软件架构的本质是一种在特定资源背景下折中平衡后追求业务增长的一门艺术。虽然盘古框架的标准姿势是分布式微服务架构开发，但决定技术开发架构选型的因素很多，单体应用依旧有很多应用场景。因此，盘古框架不会把用户绑定到一个固定的开发范式和架构上，而是支持随意组合、自动装配、灵活插拔。既能构建大并发高可用的分布式微服务架构也能搭建小巧的垂直单体分层架构。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装相关盘古模块">安装相关盘古模块<a class="hash-link" href="#安装相关盘古模块" title="标题的直接链接">​</a></h2><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">盘古 Parent</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">基础模块</li><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Web模块</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-parent</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">latest.version.xxx</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">relativePath</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6"><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-web-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>说明</div><div class="admonitionContent_S0QG"><p>这里仅演示了最简模块组合。如果需要数据持久化、消息队列等功能，请根据开发指南相关章节继续安装相关模块依赖即可。</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本地配置">本地配置<a class="hash-link" href="#本地配置" title="标题的直接链接">​</a></h2><blockquote><p>为便于理解，本文基于本地配置的方式编写。若改为标准的 Nacos 配置中心模式，请参阅：<a href="https://xiongchun.github.io/pangu-framework/docs/advanced-guide/nacos-config-center" target="_blank" rel="noopener noreferrer">配置中心</a> 章节。</p></blockquote><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">application</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">empty</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">web</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jackson</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">time</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">zone</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">GMT</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">root</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">gitee</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pulanos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pangu</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">INFO</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启动入口">启动入口<a class="hash-link" href="#启动入口" title="标题的直接链接">​</a></h2><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">SpringBootApplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">EmptyWebPanguApplication</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter known-class-name class-name">String</span><span class="token parameter punctuation" style="color:#393A34">[</span><span class="token parameter punctuation" style="color:#393A34">]</span><span class="token parameter"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">PanGuApplicationBuilder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">EmptyWebPanguApplication</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本文相关范例源码">本文相关范例源码<a class="hash-link" href="#本文相关范例源码" title="标题的直接链接">​</a></h2><ul><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-empty-web" target="_blank" rel="noopener noreferrer">pangu-examples-empty-web</a>：单体分层Web应用范例</li></ul>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="服务端开发" term="服务端开发"/>
        <category label="盘古开发框架" term="盘古开发框架"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[盘古开发框架架构模式选项对比]]></title>
        <id>pangu-dev-framework-architecture</id>
        <link href="https://xiongchun.github.io/blog/pangu-dev-framework-architecture"/>
        <updated>2020-12-30T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[软件架构的本质是一种在特定资源背景下折中平衡后追求业务增长的一门艺术。决定开发技术架构选型的因素很多。这里，我们简单的对两种不同开发架构模式进行客观比较，希望对大家在技术架构选型时能有所参考意义。]]></summary>
        <content type="html"><![CDATA[<p>软件架构的本质是一种在特定资源背景下折中平衡后追求业务增长的一门艺术。决定开发技术架构选型的因素很多。这里，我们简单的对两种不同开发架构模式进行客观比较，希望对大家在技术架构选型时能有所参考意义。</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_S0QG"><p><a href="https://github.com/xiongchun/pangu-framework" target="_blank" rel="noopener noreferrer">盘古开发框架</a> 不会把用户绑定到一个固定的开发范式和架构上，而是支持随意组合、自动装配、灵活插拔。 既能构建大并发高可用的分布式微服务架构也能搭建小巧的垂直单体分层架构。</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="单体分层架构-vs-微服务分布式架构">单体分层架构 VS 微服务分布式架构<a class="hash-link" href="#单体分层架构-vs-微服务分布式架构" title="标题的直接链接">​</a></h2><table><thead><tr><th><div style="width:80px">-</div></th><th>单体分层架构</th><th>微服务分布式架构</th></tr></thead><tbody><tr><td>开发</td><td>开发测试流程简单</td><td>开发测试流程相对复杂</td></tr><tr><td>部署运维</td><td>单机部署或集群部署（简单）、运维成本低</td><td>分布式部署（略难）、运维成本高</td></tr><tr><td>团队人员</td><td>团队围绕一个中心应用开发，对开发人员能力要求低。开发、维护成本相对较低。</td><td>团队基于分布式多应用协作，对开发人员能力要求略高。开发、维护成本相对较高。</td></tr><tr><td>其它</td><td>扩展性弱、可靠性低、技术创新能力弱、企业对代码等数字资产管控能力弱。</td><td>扩展性强、可靠性高、技术创新能力强、企业对代码等数字资产管控能力高。</td></tr></tbody></table><div class="theme-admonition theme-admonition-danger alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>警报</div><div class="admonitionContent_S0QG"><p>上述指标对比均为相对结果，仅供参考。在特定项目资源、团队背景、业务场景等环境下，相关指标的相对高低强弱对比是会有偏差甚至反转的。</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="盘古开发架构选型建议">盘古开发架构选型建议<a class="hash-link" href="#盘古开发架构选型建议" title="标题的直接链接">​</a></h2><p>如下是从不同维度简单粗暴的以定量或定性的角度给出了一些选型建议，结论是孤立的脱离实际的，仅供参考。采用什么样的架构开发模式不能一概而论，需要大家综合当下实际情况 <span style="background-color:#E6A23C;border-radius:3px;color:#fff;padding:0.1rem">酌情选择</span> 。 👻 </p><table><thead><tr><th>-</th><th align="center">单体分层架构</th><th align="center">微服务分布式架构</th></tr></thead><tbody><tr><td>开发人员 &lt; 5</td><td align="center">✔</td><td align="center"></td></tr><tr><td>研发预算 &lt; 100 w</td><td align="center">✔</td><td align="center"></td></tr><tr><td>用户数较小的管理类系统</td><td align="center">✔</td><td align="center"></td></tr><tr><td>面向C端的（移动）互联网应用</td><td align="center"></td><td align="center">✔</td></tr><tr><td>多任务多小组协作</td><td align="center"></td><td align="center">✔</td></tr><tr><td>有专职运维人员</td><td align="center"></td><td align="center">✔</td></tr><tr><td>追求可维护性和扩展性</td><td align="center"></td><td align="center">✔</td></tr><tr><td>追求技术团队长期收益 &amp; 增长</td><td align="center"></td><td align="center">✔</td></tr><tr><td>甲方企业自建的技术团队</td><td align="center"></td><td align="center">✔</td></tr></tbody></table>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="服务端开发" term="服务端开发"/>
        <category label="盘古开发框架" term="盘古开发框架"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[bit、Byte、KB、MB、GB... 之间的关系]]></title>
        <id>bit-byte-kb-etc</id>
        <link href="https://xiongchun.github.io/blog/bit-byte-kb-etc"/>
        <updated>2020-02-18T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[bit、Byte、KB、MB、GB... 之间的关系，必须记住的几个计算机存储容量换算单位。]]></summary>
        <content type="html"><![CDATA[<p>bit、Byte、KB、MB、GB... 之间的关系，必须记住的几个计算机存储容量换算单位。</p><ul><li><p>bit（比特位，简写 b）<br>
<!-- -->是计算机数据存储最小的单位，二进制中，0或者1就是一个位(比特位)bit。</p></li><li><p>Byte (字节，简写：B)<br>
<!-- -->是计算机信息技术用于计量存储容量的一种计量单位，通常情况下一字节等于8位，也就是：1Byte = 8bit = 1B = 8b。</p><img loading="lazy" width="300" src="/assets/images/53-byte-233313022b871165d3f3889ec2674146.png" alt="byte" class="img_ev3q"></li></ul><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>字符与字节的关系</div><div class="admonitionContent_S0QG"><p>字符：Character，在计算机和电信技术中，一个字符是一个单位的字形或符号的基本信息。不同字符集编码下一个字符占用的字节数不同。UTF-8 编码：一个英文字符或英文标点占 1 个字节；一个中文字符或中文标点占 3 个字节。Unicode 编码：所有字符都占 2 个字节。</p></div></div><ul><li><p>KB (Kibibyte，千字节)<br>
<!-- -->1KB = 1024B = 2^10B</p></li><li><p>MB (Mebibyte，百万字节，兆字节，简称“兆”)<br>
<!-- -->1MB = 1024KB</p></li><li><p>GB (Gibibyte，十亿字节，吉字节，又称“千兆”)<br>
<!-- -->1GB = 1024MB</p></li><li><p>TB (Tebibyte，万亿字节，太字节)<br>
<!-- -->1TB = 1024GB</p></li><li><p>PB (Pebibyte，千万亿字节，拍字节)<br>
<!-- -->1PB = 1024TB</p></li><li><p>EB (Exbibyte，百亿亿字节，艾字节)<br>
<!-- -->1EB = 1024PB</p></li><li><p>ZB (Zebibyte，十万亿亿字节，泽字节)<br>
<!-- -->1ZB = 1024EB</p></li><li><p>YB (Yobibyte，一亿亿亿字节，尧字节)<br>
<!-- -->1YB = 1024ZB</p></li></ul>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="技术杂文" term="技术杂文"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[基于 Lock4j 的分布式锁最佳实践]]></title>
        <id>pangu-dev-framework-distributed-lock</id>
        <link href="https://xiongchun.github.io/blog/pangu-dev-framework-distributed-lock"/>
        <updated>2020-02-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[盘古开发框架 基于 Lock4j 提供分布式锁。支持注解声明式和 API 编程式对业务代码在分布式环境下加并发锁。]]></summary>
        <content type="html"><![CDATA[<p><a href="https://github.com/xiongchun/pangu-framework" target="_blank" rel="noopener noreferrer">盘古开发框架</a> 基于 <a href="https://gitee.com/baomidou/lock4j" target="_blank" rel="noopener noreferrer">Lock4j</a> 提供分布式锁。支持注解声明式和 API 编程式对业务代码在分布式环境下加并发锁。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装相关盘古模块">安装相关盘古模块<a class="hash-link" href="#安装相关盘古模块" title="标题的直接链接">​</a></h2><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">盘古 Parent</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">基础模块</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">缓存模块</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-parent</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">latest.version.xxx</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">relativePath</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-cache-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本地配置">本地配置<a class="hash-link" href="#本地配置" title="标题的直接链接">​</a></h2><blockquote><p>为便于理解，本文基于本地配置的方式编写。若改为标准的 Nacos 配置中心模式，请参阅：<a href="/blog/pangu-dev-framework-configuration-center">配置中心</a> 章节。</p></blockquote><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">application.properties</li><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">application-dev.properties</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">profiles</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">active</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">profiles</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">active</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">dev</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6"><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">application</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">lock</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">redis</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">based</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># spring</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">redis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">host</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">redis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">database</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">redis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">6379</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">redis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">password</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">root</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">gitee</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pulanos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pangu</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">INFO</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="基于注解声明">基于注解声明<a class="hash-link" href="#基于注解声明" title="标题的直接链接">​</a></h2><p>直接在需要缓存的方法上加上 <code>@Lock4j</code> 注解。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="lock4j">@Lock4j<a class="hash-link" href="#lock4j" title="标题的直接链接">​</a></h3><p>分布式锁注解。</p><table><thead><tr><th>名称</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>name</td><td>空字符串</td><td>用于多个方法锁同一把锁 可以理解为锁资源名称，为空则会使用：包名 + 类名 + 方法名。（一般为空即可）</td></tr><tr><td>keys</td><td>空字符串</td><td>支持 SPEL 表达式，锁的 key = name + keys</td></tr><tr><td>acquireTimeout</td><td>3000</td><td>获取锁超时时间 单位：毫秒。可以理解为排队时常，超过这个时常就退出排队，抛出获取锁超时异常。</td></tr><tr><td>expire</td><td>30000</td><td>过期时间 单位：毫秒。主要是防止死锁，建议估计好你锁方法运行时常，正常没有复杂业务的增删改查最多几秒，留有一定冗余，10 秒足够。默认 30 秒是为了兼容绝大部分场景。</td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="代码片段">代码片段<a class="hash-link" href="#代码片段" title="标题的直接链接">​</a></h3><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 默认获取锁超时 3 秒，30 秒锁过期</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">Lock4j</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">doBiz</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"执行doBiz..."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">ThreadUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">25</span><span class="token operator" style="color:#393A34">*</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 配置获取锁超时时间和锁过期时间 支持 SPEL</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param accountId</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:#d73a49">Lock4j</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">keys </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">"#accountId"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> expire </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> acquireTimeout </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">doBiz2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter maybe-class-name">Long</span><span class="token parameter"> accountId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"执行doBiz2..."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">ThreadUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">20</span><span class="token operator" style="color:#393A34">*</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="基于-api-编程">基于 API 编程<a class="hash-link" href="#基于-api-编程" title="标题的直接链接">​</a></h2><p>注入 LockTemplate 对象即可使用。如下代码所示。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">Component</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ApiLockService</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token maybe-class-name">Autowired</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token maybe-class-name">LockTemplate</span><span class="token plain"> lockTemplate</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apiLock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter known-class-name class-name">String</span><span class="token parameter"> userId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//... 各种不需要上锁的操作</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token known-class-name class-name">String</span><span class="token plain"> lockKey </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"lock4j:ApiLockService:apiLock:"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> userId</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        final </span><span class="token maybe-class-name">LockInfo</span><span class="token plain"> lockInfo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> lockTemplate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">lock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lockKey</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//申请锁失败</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> lockInfo</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">LockException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"业务处理中，请稍后再试..."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//申请锁成功</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token maybe-class-name">ThreadUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">10000L</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"执行 apiLock, 当前线程{}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token maybe-class-name">Thread</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">currentThread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            lockTemplate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">releaseLock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lockInfo</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本文相关范例源码">本文相关范例源码<a class="hash-link" href="#本文相关范例源码" title="标题的直接链接">​</a></h2><ul><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-lock-redis-based" target="_blank" rel="noopener noreferrer">pangu-examples-lock-redis-based</a>：分布式锁范例</li></ul>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="服务端开发" term="服务端开发"/>
        <category label="盘古开发框架" term="盘古开发框架"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[快速搭建 Element Plus 开发脚手架]]></title>
        <id>element-plus-webpack</id>
        <link href="https://xiongchun.github.io/blog/element-plus-webpack"/>
        <updated>2020-01-09T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Element Plus 是基于 Vue 3，面向设计师和开发者的 UI 组件库。]]></summary>
        <content type="html"><![CDATA[<p><a href="https://element-plus.gitee.io/zh-CN" target="_blank" rel="noopener noreferrer">Element Plus</a> 是基于 Vue 3，面向设计师和开发者的 UI 组件库。</p><p>本文介绍搭建其开发脚手架的方式。</p><ul><li>官方建议的基于 vite 的开发模版。<a href="https://github.com/element-plus/element-plus-vite-starter" target="_blank" rel="noopener noreferrer">获取模版代码</a>  <!-- -->&nbsp;<!-- -->&nbsp;<!-- -->&nbsp;<a href="https://vite-starter.element-plus.org/" target="_blank" rel="noopener noreferrer">在线示例效果</a></li><li>基于 webpack 的开发模版。我自己习惯用这种，本文也重点介绍这种方式。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="初始化项目">初始化项目<a class="hash-link" href="#初始化项目" title="标题的直接链接">​</a></h3><p>第一步：需要预先安装 <a href="https://nodejs.org/zh-cn/" target="_blank" rel="noopener noreferrer">Node.js®</a> 环境。<br>
<!-- -->(<em>Node.js® 是一个开源、跨平台的 JavaScript 运行时环境。</em>) 安装完成后顺便设置淘宝镜像源。</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> config </span><span class="token builtin class-name">set</span><span class="token plain"> registry https://registry.npm.taobao.org</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>第二步：安装 vue-cli，创建工程模版：element-plus-webpack-starter。</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -g @vue/cli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vue create element-plus-webpack-starter</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装-element-plus">安装 Element Plus<a class="hash-link" href="#安装-element-plus" title="标题的直接链接">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> element-plus --save</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="资源依赖">资源依赖<a class="hash-link" href="#资源依赖" title="标题的直接链接">​</a></h3><p>共有2种资源依赖方式。</p><ul><li>完整引入<br>如果你对打包后的文件大小不是很在乎，那么使用完整导入会更方便。</li><li>按需导入<br>如果你想控制打包文件大小那就需要使用额外的插件来按需导入要使用的组件。可自动导入或手工导入，<a href="https://element-plus.gitee.io/zh-CN/guide/quickstart.html#%E6%8C%89%E9%9C%80%E5%AF%BC%E5%85%A5" target="_blank" rel="noopener noreferrer">详见官方文档</a>。</li></ul><p>本文介绍下完整引入的例子。修改 main.js 文件。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> createApp </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'vue'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">App</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./App.vue'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">ElementPlus</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'element-plus'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'element-plus/dist/index.css'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createApp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">App</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">ElementPlus</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'#app'</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用验证">使用验证<a class="hash-link" href="#使用验证" title="标题的直接链接">​</a></h3><p>为了验证我们安装是否成功，可以将如下 ElButton 组件插入页面 HelloWorld.vue 查看效果。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">el-button</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">primary</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">Element Plus 安装成功</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">el-button</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>启动工程，查看效果如下图所示。</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> run serve</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="element-plus-webpack" src="/assets/images/52-elementplus-45f4322bbd59558f2cf4b05baf2e5cb5.png" width="1826" height="654" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="编译打包">编译打包<a class="hash-link" href="#编译打包" title="标题的直接链接">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> run build</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>静态资源文件输出文件夹 dist/ 。</p>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="客户端开发" term="客户端开发"/>
        <category label="Web" term="Web"/>
        <category label="Element Plus" term="Element Plus"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[基于 Laying Cache 的分布式多级缓存方案]]></title>
        <id>pangu-dev-framework-laying-cache</id>
        <link href="https://xiongchun.github.io/blog/pangu-dev-framework-laying-cache"/>
        <updated>2019-12-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[盘古开发框架 基于 Laying Cache，提供支持分布式环境的多级缓存功能。使用 Caffeine 作为一级本地缓存，Redis 作为二级集中式缓存。支持缓存信息监控统计、支持缓存过期时间在注解上直接配置、支持缓存的自动刷新、缓存 Key 支持 SpEL 表达式、支持无感禁用一级缓存或二级缓存。]]></summary>
        <content type="html"><![CDATA[<p><a href="https://github.com/xiongchun/pangu-framework" target="_blank" rel="noopener noreferrer">盘古开发框架</a> 基于 <a href="https://github.com/xiaolyuh/layering-cache" target="_blank" rel="noopener noreferrer">Laying Cache</a>，提供支持分布式环境的多级缓存功能。使用 Caffeine 作为一级本地缓存，Redis 作为二级集中式缓存。支持缓存信息监控统计、支持缓存过期时间在注解上直接配置、支持缓存的自动刷新、缓存 Key 支持 SpEL 表达式、支持无感禁用一级缓存或二级缓存。</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>扩展：什么是缓存穿透、缓存雪崩和缓存击穿？</div><div class="admonitionContent_S0QG"><p><strong>缓存穿透</strong>（cache penetration）是用户访问的数据既不在缓存当中，也不在数据库中。这就导致每次请求都会到底层数据库进行查询，缓存也失去了意义。当高并发或有人利用不存在的Key频繁攻击时，数据库的压力骤增，甚至崩溃，这就是缓存穿透问题。<br>
<strong>缓存雪崩</strong>（Cache Avalanche）当大量的热点KEY同时失效或者缓存服务故障导致请求全部转发到数据库，从而导致数据库压力骤增，甚至宕机。从而形成一系列的连锁反应，造成系统崩溃等情况。<br>
<strong>缓存击穿</strong>（Cache Breakdown）如果有单个热点key，在不停的扛着大并发，在这个key失效的瞬间，持续的大并发请求就会击破缓存，直接请求到数据库，好像蛮力击穿一样。</p></div></div><p>盘古分布式多级缓存组件通过缓存空值或默认值来解决缓存穿透问题、通过判断即将过期时发起异步加载缓存的方式来解决缓存击穿和雪崩问题。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装相关盘古模块">安装相关盘古模块<a class="hash-link" href="#安装相关盘古模块" title="标题的直接链接">​</a></h2><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">盘古 Parent</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">基础模块</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">缓存模块</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-parent</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">latest.version.xxx</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">relativePath</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-cache-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本地配置">本地配置<a class="hash-link" href="#本地配置" title="标题的直接链接">​</a></h2><blockquote><p>为便于理解，本文基于本地配置的方式编写。若改为标准的 Nacos 配置中心模式，请参阅：<a href="https://xiongchun.github.io/pangu-framework/docs/advanced-guide/nacos-config-center" target="_blank" rel="noopener noreferrer">配置中心</a> 章节。</p></blockquote><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">application.properties</li><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">application-dev.properties</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">profiles</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">active</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">profiles</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">active</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">dev</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6"><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">application</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">cache</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">layering</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># layering</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">cache 多级缓存</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">layering</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">stats</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># redis单机</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">layering</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">redis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">database</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">layering</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">redis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">host</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">layering</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">redis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">6379</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">layering</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">redis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">password</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># redis集群</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#layering</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">redis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">password</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#layering</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">redis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cluster</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">127.0</span><span class="token number" style="color:#36acaa">.0</span><span class="token number" style="color:#36acaa">.1</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">6379</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">127.0</span><span class="token number" style="color:#36acaa">.0</span><span class="token number" style="color:#36acaa">.1</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">6378</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">layering</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">redis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">serializer</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">github</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">xiaolyuh</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">redis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">serializer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">JacksonRedisSerializer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">root</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">gitee</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pulanos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pangu</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">INFO</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="关键配置项说明">关键配置项说明<a class="hash-link" href="#关键配置项说明" title="标题的直接链接">​</a></h3><table><thead><tr><th><div style="width:120px">配置项</div></th><th>配置说明</th></tr></thead><tbody><tr><td>layering-cache.stats</td><td>缓存监控统计开关，缺省true</td></tr><tr><td>layering-cache.redis.serializer</td><td>Redis序列化方式</td></tr></tbody></table><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="基于注解声明">基于注解声明<a class="hash-link" href="#基于注解声明" title="标题的直接链接">​</a></h2><p>直接在需要缓存的方法上加上 <code>@Cacheable</code>、<code>@CacheEvict</code>、<code>@CachePut</code> 注解。（ <code>@FirstCache</code>、<code>@SecondaryCache</code> 为注解配置项，不能单独使用）</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="firstcache">@FirstCache<a class="hash-link" href="#firstcache" title="标题的直接链接">​</a></h3><p>一级缓存配置项。</p><table><thead><tr><th>名称</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>initialCapacity</td><td>10</td><td>缓存初始 Size</td></tr><tr><td>maximumSize</td><td>5000</td><td>缓存最大 Size</td></tr><tr><td>expireTime</td><td>9</td><td>缓存有效时间</td></tr><tr><td>timeUnit</td><td>TimeUnit.MINUTES</td><td>时间单位，默认分钟</td></tr><tr><td>expireMode</td><td>ExpireMode.WRITE</td><td>缓存失效模式，ExpireMode.WRITE：最后一次写入后到期失效，ExpireMode.ACCESS：最后一次访问后到期失效</td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="secondarycache">@SecondaryCache<a class="hash-link" href="#secondarycache" title="标题的直接链接">​</a></h3><p>二级缓存配置项。</p><table><thead><tr><th>名称</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>expireTime</td><td>5</td><td>缓存有效时间</td></tr><tr><td>preloadTime</td><td>1</td><td>缓存主动在失效前强制刷新缓存的时间，建议是 expireTime * 0.2</td></tr><tr><td>timeUnit</td><td>TimeUnit.HOURS</td><td>时间单位，默认小时</td></tr><tr><td>forceRefresh</td><td>false</td><td>是否强制刷新（直接执行被缓存方法）</td></tr><tr><td>magnification</td><td>1</td><td>非空值和 null 值之间的时间倍率，默认是 1。如 expireTime=60 秒，magnification=10，那么当缓存空值时，空值的缓存过期时间是 60/10=6 秒。</td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cacheable">@Cacheable<a class="hash-link" href="#cacheable" title="标题的直接链接">​</a></h3><p>表示用的方法的结果是可以被缓存的，当该方法被调用时先检查缓存是否命中，如果没有命中再调用被缓存的方法，并将其返回值放到缓存中。</p><table><thead><tr><th>名称</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>cacheNames</td><td>空字符串数组</td><td>缓存名称</td></tr><tr><td>key</td><td>空字符串</td><td>缓存 key，支持 SpEL 表达式</td></tr><tr><td>depict</td><td>空字符串</td><td>缓存描述（在缓存统计页面会用到）</td></tr><tr><td>enableFirstCache</td><td>true</td><td>是否启用一级缓存</td></tr><tr><td>firstCache</td><td></td><td>一级缓存配置</td></tr><tr><td>secondaryCache</td><td></td><td>二级缓存配置</td></tr></tbody></table><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">@Cacheable 范例代码</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:#d73a49">Cacheable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cacheNames </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"user"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"#userId"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        firstCache </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> @</span><span class="token function maybe-class-name" style="color:#d73a49">FirstCache</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expireTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        secondaryCache </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> @</span><span class="token function maybe-class-name" style="color:#d73a49">SecondaryCache</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expireTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token maybe-class-name">UserVO</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter maybe-class-name">Long</span><span class="token parameter"> userId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"执行AnnotationBasedDemoService.getUser()"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 从DB或其它资源渠道获取数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">UserVO</span><span class="token plain"> userVO </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">UserVO</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userVO</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">userId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userVO</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"钱学森"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> userVO</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cacheput">@CachePut<a class="hash-link" href="#cacheput" title="标题的直接链接">​</a></h3><p>将数据放到缓存中，新增缓存。</p><table><thead><tr><th>名称</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>cacheNames</td><td>空字符串数组</td><td>缓存名称</td></tr><tr><td>key</td><td>空字符串</td><td>缓存 key，支持 SpEL表达式</td></tr><tr><td>depict</td><td>空字符串</td><td>缓存描述（在缓存统计页面会用到）</td></tr><tr><td>enableFirstCache</td><td>true</td><td>是否启用一级缓存</td></tr><tr><td>firstCache</td><td></td><td>一级缓存配置</td></tr><tr><td>secondaryCache</td><td></td><td>二级缓存配置</td></tr></tbody></table><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">@CachePut 范例代码</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:#d73a49">CachePut</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cacheNames </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"user"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"#userVO.id"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        firstCache </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> @</span><span class="token function maybe-class-name" style="color:#d73a49">FirstCache</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expireTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        secondaryCache </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> @</span><span class="token function maybe-class-name" style="color:#d73a49">SecondaryCache</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expireTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token maybe-class-name">UserVO</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">saveUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter maybe-class-name">UserVO</span><span class="token parameter"> userVO</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"执行AnnotationBasedDemoService.saveUser()"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> userVO</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cacheevict">@CacheEvict<a class="hash-link" href="#cacheevict" title="标题的直接链接">​</a></h3><p>删除缓存。</p><table><thead><tr><th>名称</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>value</td><td>空字符串数组</td><td>缓存名称，cacheNames 的别名</td></tr><tr><td>cacheNames</td><td>空字符串数组	缓存名称</td><td></td></tr><tr><td>key</td><td>空字符串</td><td>缓存 key，支持 SpEL 表达式</td></tr><tr><td>allEntries</td><td>false</td><td>是否删除缓存中所有数据，默认情况下是只删除关联 key 的缓存数据，当该参数设置成 true 时 key 参数将无效</td></tr></tbody></table><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">@CacheEvict 范例代码</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:#d73a49">CacheEvict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cacheNames </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"user"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"#userId"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">delUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter maybe-class-name">Long</span><span class="token parameter"> userId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"执行AnnotationBasedDemoService.delUser()"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:#d73a49">CacheEvict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cacheNames </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"user"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> allEntries </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">delAllUsers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"执行AnnotationBasedDemoService.delAllUsers()"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="基于-api-编程">基于 API 编程<a class="hash-link" href="#基于-api-编程" title="标题的直接链接">​</a></h2><p>可以直接使用 Laying Cahce 提供的 API 进行硬编码操作两级缓存，但不建议使用。这里就不做详细讲解了，可以在参考范例的 <code>ApiBasedDemoService</code> 类中找到相关的代码。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启动入口">启动入口<a class="hash-link" href="#启动入口" title="标题的直接链接">​</a></h2><p>需要 <code>@EnableLayeringCache</code> 注解的加持。如下代码所示。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">EnableLayeringCache</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">SpringBootApplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">LayeringCachePanguApplication</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter known-class-name class-name">String</span><span class="token parameter punctuation" style="color:#393A34">[</span><span class="token parameter punctuation" style="color:#393A34">]</span><span class="token parameter"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">PanGuApplicationBuilder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">LayeringCachePanguApplication</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><b>快速 QA：</b>可以禁用一级缓存，只使用二级缓存吗？</summary><div><div class="collapsibleContent_i85q"><div>必须可以。设置 enableFirstCache = false 即可。</div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><b>快速 QA：</b>可以禁用二级缓存，只使用一级缓存吗？</summary><div><div class="collapsibleContent_i85q"><div>可以。设置二级缓存 expireTime 为 0 即可。</div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><b>快速 QA：</b>我可以用 Spring Cache 的 RedisTemplate API 吗？</summary><div><div class="collapsibleContent_i85q"><div>可以。Laying Cache 和 Spring Cache 相互隔离的，你只要在配置文件加入 Spring Cache 的配置，就可以注入 RedisTemplate 直接使用了。可以单独使用，也可以和 Laying Cache 混合使用。具体用法可以参考范例：pangu-examples-cache-single。</div></div></div></details><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本文相关范例源码">本文相关范例源码<a class="hash-link" href="#本文相关范例源码" title="标题的直接链接">​</a></h2><ul><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-empty-web" target="_blank" rel="noopener noreferrer">pangu-examples-cache-layering</a>：两级缓存（本地缓存 + Redis 集中缓存）范例</li><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-cache-single" target="_blank" rel="noopener noreferrer">pangu-examples-cache-single</a>：Spring Cache 一级缓存 API（ RedisTemplate ）范例</li></ul>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="服务端开发" term="服务端开发"/>
        <category label="盘古开发框架" term="盘古开发框架"/>
        <category label="缓存" term="缓存"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[基于 ShardingSphere 的数据分片数据治理]]></title>
        <id>pangu-dev-framework-data-sharding</id>
        <link href="https://xiongchun.github.io/blog/pangu-dev-framework-data-sharding"/>
        <updated>2019-10-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[盘古开发框架 集成了数据库中间件 ShardingSphere 来提供数据治理相关功能。如：数据分片、读写分离、数据加密等。]]></summary>
        <content type="html"><![CDATA[<p><a href="https://github.com/xiongchun/pangu-framework" target="_blank" rel="noopener noreferrer">盘古开发框架</a> 集成了数据库中间件 <a href="https://shardingsphere.apache.org/index.html" target="_blank" rel="noopener noreferrer">ShardingSphere</a> 来提供数据治理相关功能。如：数据分片、读写分离、数据加密等。</p><p>随着业务规模不断的扩大，将数据集中存储到单一节点的解决方案，在<strong>性能</strong>、<strong>可用性</strong>和<strong>运维成本</strong>等方面已经难于满足高并发和海量数据系统的场景。从性能方面来说，高并发访问请求使得集中式数据库成为系统的最大瓶颈；从可用性的方面来讲，单一数据节点或简单主从架构，已经越来越难以满足互联网 To C 业务对高可用的迫切诉求，数据库的可用性俨然已成为整个系统的关键；从运维成本和系统风险方面考虑，当一个数据库实例中的数据达到临界阈值以上，数据备份和恢复的时间成本和风险都将随着数据量的大小而愈发不可控。数据分片将存放在单一库中的数据分散至多个库或表中以达到提升性能、提高可用性和降低运维成本的效果，是应对高并发和海量数据系统的有效手段。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="数据分片概念">数据分片概念<a class="hash-link" href="#数据分片概念" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="数据分片类型">数据分片类型<a class="hash-link" href="#数据分片类型" title="标题的直接链接">​</a></h3><p>数据分片可分为垂直分片和水平分片。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="垂直分片">垂直分片<a class="hash-link" href="#垂直分片" title="标题的直接链接">​</a></h4><p>垂直分片是按照业务域将数据库纵向切分为不同的数据库。如电商系统的用户库、订单库、会员库、仓储库、账户库等。垂直拆分可以缩库但无法缩表，即可以减小单节点下数据库数据量，但每个数据表里面的数据量是没有变化的；垂直拆分可以一定程度降低单节点数据库的负载，但是每个数据表的并发压力依旧没变。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="水平分片">水平分片<a class="hash-link" href="#水平分片" title="标题的直接链接">​</a></h4><p>水平分片又称为横向拆分。相对于垂直分片，水平分片不再根据业务逻辑分类，而是通过某个字段（或某几个字段），根据某种规则将数据分散至多个库或多个表中。水平分片从理论上突破了单机数据量处理的瓶颈，并且扩展相对自由，是数据分片的标准解决方案。水平分片从具体实现上又可以分为3种：<strong>只分表</strong>、<strong>只分库</strong>、<strong>分库分表</strong>。如下图所示。</p><img loading="lazy" width="800" src="/assets/images/29-pangu-framework-sharding-dab030840f6f6f807dde9cfaf3bce235.png" alt="数据治理之数据分片" class="img_ev3q"><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="相关专业术语">相关专业术语<a class="hash-link" href="#相关专业术语" title="标题的直接链接">​</a></h3><ul><li><strong>逻辑表</strong>：相同结构的水平拆分数据库（表）的逻辑名称，是 SQL 中数据表的逻辑标识。如：t_order 表被拆分为 t_order0 和 t_order1，则 t_order 是逻辑表，并不存放数据，仅用于 SQL 中的逻辑标识。</li><li><strong>真实表</strong>：在水平拆分的数据库中真实存在的物理表。如：t_order 表被拆分为 t_order0 和 t_order1，则 t_order0 和 t_order1 是真实表，用于存储数据。</li><li><strong>绑定表</strong>：指分片规则一致的主表和子表。例如：t_order 表和 t_order_item 表，均按照 order_id 分片，并且使用 order_id 进行关联，则此两张表互为绑定表关系，绑定表的关联查询不会出现笛卡尔积关联或跨库关联，关联查询效率将大大提升。可以在配置中配置绑定表关系。</li><li><strong>广播表</strong>：指在所有的分片数据源中都存在的表，表结构及其数据均完全一致。适用于数据量不大且需要与海量数据的表进行关联查询的场景。例如：字典表、地址表等。对广播表的DML操作，会自动路由到所有的数据节点。可以在配置中配置广播表。</li><li><strong>单表</strong>：指不需要参与分片且所有数据源中唯一存在的表。</li><li><strong>数据节点</strong>：数据分片的最小单元，由数据源名称和真实表组成。 如：ds0.t_order0。</li><li><strong>分片键</strong>：用于将数据库（表）水平拆分的数据库字段。</li><li><strong>分片策略</strong>：分片键 + 分片算法。</li><li><strong>分布式主键</strong>：分片后的表主键不能使用数据库自身的自增列机制，需要额外引入主键生成策略。ShardingSphere 提供了基于 UUID 和 SNOWFLAKE 的分布式主键生成机制，但不建议使用。最灵活的方式还是自己生成分布式ID传给新增的实体对象。盘古框架使用 MyBatis Plus 的主键生成功能。（同样可选 UUID 主键和 SNOWFLAKE 算法主键）<blockquote><p>提示：SNOWFLAKE 算法主键能保证递增，但不能保证数字的连续性。如果需要递增且连续的分布式主键，需要自己实现。</p></blockquote></li><li><strong>强制分片路由</strong>：基于 Hint 机制指定了强制分片路由的 SQL 请求会忽略分片逻辑，直接将请求路由至指定的真实数据节点。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="数据分片面临的挑战">数据分片面临的挑战<a class="hash-link" href="#数据分片面临的挑战" title="标题的直接链接">​</a></h3><p>虽然数据分片解决了性能、可用性以及单点备份恢复等问题，但分布式的架构在获得了收益的同时，也引入了新的问题。</p><ul><li>分片后的数据散乱且关系复杂，应用开发工程师和数据库管理员对数据库的操作变得异常繁重且困难。他们需要明确知道数据从哪写入，从哪读取。</li><li>数据分片后势必会带来分布式事务的处理。能够优雅的处理好分布式事务，这对开发而言也是一个全新的挑战。（分布式事务处理跨参考：<a href="/blog/pangu-dev-framework-distributed-transaction">盘古框架分布式事务最佳实践</a>）</li><li>数据库请求路由至多数据节点的时候，部分SQL支持不完整或性能损耗较大的问题。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="数据分片参考原则">数据分片参考原则<a class="hash-link" href="#数据分片参考原则" title="标题的直接链接">​</a></h2><ul><li>需综合权衡业务场景、客观估算数据分片性价比，不要盲目分片。数据分片在获得收益的同时，也引入了新的问题。</li><li>分片参考临界值：一般来讲 MySQL单表记录控制在 1000 万以内、数据库单实例数据大小控制在 1 TB 以内是比较合理的范围。</li><li>分表不分库仅涉及本地事务，垂直分片和水平分片的分库分表均会带来分布式事务。设计过程应考虑不要人为扩大没必要的分布式事务使用边界。（也可以适当放宽）</li><li>分片键的规划尤为重要，需要结合业务特点来<strong>精心设计</strong>。</li><li>对分片表的查询必须包含分片键，且尽可能的保持单表。分片表的关联查询，请结合绑定表和广播表酌情合理使用。</li></ul><p>总之，采用什么样的数据架构需要结合<strong>性能诉求</strong>、<strong>可用性</strong>、<strong>运维成本</strong>、<strong>开发成本</strong>、<strong>项目背景</strong>和<strong>业务场景</strong>等方面来做权衡选择。上述仅为一些孤立的参考原则。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="数据分片实现原理">数据分片实现原理<a class="hash-link" href="#数据分片实现原理" title="标题的直接链接">​</a></h2><p>实现数据分片大致有 2 种方案。如下图所示。</p><img loading="lazy" width="800" src="/assets/images/30-pangu-framework-sharding-507e3b88920f904d77795cec8d8fcb6c.png" alt="数据分片实现原理" class="img_ev3q"><ul><li><p><strong>数据库代理模式（服务端代理）</strong><br>
<!-- -->在数据库和应用系统之间独立部署一个数据库代理中间件，所有的 SQL 请求先发送到这个代理，由它完成 SQL 解析、SQL改写、SQL 路由、结果集聚合等必要操作。在这种模式下，路由规则、分配逻辑都配置到代理上，数据分片的逻辑对开发人员是透明的。</p></li><li><p><strong>数据源代理模式（客户端代理）</strong><br>
<!-- -->通过在应用端引入组件包，代理应用普通数据源。在这种模式下，路由规则、分片逻辑配置到应用侧，所有 SQL 请求都通过代理数据源完成 SQL 解析、SQL改写、SQL 路由、结果集聚合等必要操作。
</p></li></ul><table><thead><tr><th><div style="width:120px">实现方式</div></th><th>可选组件</th><th><div style="width:150px">优点</div></th><th><div style="width:200px">缺点</div></th></tr></thead><tbody><tr><td><strong>数据库代理模式</strong></td><td>ShardingSphere-Proxy <br> MyCat</td><td>多语言支持<br>独立部署（升级简单）<br>对开发完全透明</td><td>独立部署（增加不稳定因素）<br> 运维成本高<br>性能损耗高</td></tr><tr><td><strong>数据源代理模式 💋 </strong></td><td>ShardingSphere-JDBC</td><td>集成简单、轻松驾驭<br>性能较好</td><td>嵌入 JAR（升级麻烦）<br>日常数据维护麻烦</td></tr></tbody></table><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>警告</div><div class="admonitionContent_S0QG"><p>盘古开发框架使用 ShardingSphere-JDBC 组件，通过数据源代理的方式实现数据分片功能。</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装相关盘古模块">安装相关盘古模块<a class="hash-link" href="#安装相关盘古模块" title="标题的直接链接">​</a></h2><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">盘古 Parent</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">基础模块</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">JDBC 模块</li><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">数据治理模块</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-parent</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">latest.version.xxx</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">relativePath</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-jdbc-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6"><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-data-governance-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="编程实战一只分表">编程实战一：只分表<a class="hash-link" href="#编程实战一只分表" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="初始化数据库环境">初始化数据库环境<a class="hash-link" href="#初始化数据库环境" title="标题的直接链接">​</a></h3><p>数据库表结构和分片算法逻辑如下图所示。</p><img loading="lazy" width="350" src="/assets/images/31-pangu-framework-sharding-eb2faf1e9c03a45527d5f746304a2bff.png" alt="数据分片实现-只分表" class="img_ev3q"><p>请根据如下逻辑表结构创建真实表 t_order0 和 t_order1。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">create table </span><span class="token function" style="color:#d73a49">t_order</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    order_id bigint      not </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token plain"> primary key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user_id  int         not </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status   </span><span class="token function" style="color:#d73a49">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">comment </span><span class="token string" style="color:#e3116c">'逻辑表:订单表'</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本地配置">本地配置<a class="hash-link" href="#本地配置" title="标题的直接链接">​</a></h3><blockquote><p>为便于理解，本文基于本地配置的方式编写。若改为标准的 Nacos 配置中心模式，请参阅：<a href="https://xiongchun.github.io/pangu-framework/docs/advanced-guide/nacos-config-center" target="_blank" rel="noopener noreferrer">配置中心</a> 章节。</p></blockquote><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">application</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">shardingsphere</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">sharding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mybatis</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mapperLocations</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">classpath</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mapper</span><span class="token comment" style="color:#999988;font-style:italic">/**/</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">xml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mybatis</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">configuration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">log</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">impl</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">org</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">apache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ibatis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">stdout</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">StdOutImpl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token operator" style="color:#393A34">=</span><span class="token maybe-class-name">Memory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># print shardingsphere </span><span class="token maybe-class-name">Actual</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SQL</span><span class="token plain"> log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sql</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">show</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">names</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">zaxxer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">hikari</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">HikariDataSource</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">driver</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">class</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jdbc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jdbc</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">url</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">jdbc</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">localhost</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3306</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">username</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">password</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">123456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># sharding table </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">t_order</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">tables</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">t_order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">actual</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">data</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">nodes</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">t_order$</span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0.</span><span class="token number" style="color:#36acaa">.1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">tables</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">t_order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">table</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">strategy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">standard</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">column</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">order_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">tables</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">t_order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">table</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">strategy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">standard</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">algorithm</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">sa</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># sharding</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">algorithms configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">algorithms</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sa</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">INLINE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">algorithms</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sa</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">algorithm</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">expression</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">t_order$</span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">order_id </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="关键配置项说明">关键配置项说明<a class="hash-link" href="#关键配置项说明" title="标题的直接链接">​</a></h4><table><thead><tr><th><div style="width:460px">配置项</div></th><th><div style="width:300px">配置说明</div></th></tr></thead><tbody><tr><td>*.t_order.actual-data-nodes</td><td>表 t_order 对应的数据节点（真实表）</td></tr><tr><td>*.t_order.table-strategy.standard.sharding-column</td><td>表 t_order 的分片键</td></tr><tr><td>*.t_order.table-strategy.standard.sharding-algorithm-name</td><td>表 t_order 的分片算法名称（自定义标识符）</td></tr><tr><td>*.sharding-algorithms.sa-0.type</td><td>分片算法 sa-0 的类型（INLINE：内置算法）</td></tr><tr><td>*.sharding-algorithms.sa-0.props.algorithm-expression</td><td>分片算法 sa-0 的分片表达式</td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="测试用例">测试用例<a class="hash-link" href="#测试用例" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="测试写入数据分片">测试写入数据分片<a class="hash-link" href="#测试写入数据分片" title="标题的直接链接">​</a></h4><p>写入时将分片键 order_id 对 2 求模，并根据求模结果将订单数据分片到 2 个表中存储。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">Test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createOrder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">TOrderEntity</span><span class="token plain"> entity1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">TOrderEntity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setUserId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setStatus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"0"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tOrderMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">insert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">entity1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">TOrderEntity</span><span class="token plain"> entity2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">TOrderEntity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setUserId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setStatus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"0"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tOrderMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">insert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">entity2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>TOrderEntity</code> 的 orderId 主键请通过如下注解生成。当然也可以自定义 ID 算法赋值。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:#d73a49">TableId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"order_id"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">IdType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">ASSIGN_ID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token maybe-class-name">Long</span><span class="token plain"> orderId</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="测试根据分片键路由查询">测试根据分片键路由查询<a class="hash-link" href="#测试根据分片键路由查询" title="标题的直接链接">​</a></h4><p>根据分片算法，将SQL查询请求路由到对应的真实表查询。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">Test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">routingQuery</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">TOrderEntity</span><span class="token plain"> entity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tOrderMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">selectById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">150681599250L</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"结果集：{}"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> entity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">TOrderEntity</span><span class="token plain"> entity2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tOrderMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">selectById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">150683023105L</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"结果集：{}"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> entity2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="测试结果集归并绑定表关联查询强制路由等特性">测试结果集归并、绑定表关联查询、强制路由等特性<a class="hash-link" href="#测试结果集归并绑定表关联查询强制路由等特性" title="标题的直接链接">​</a></h4><p>不再赘述。请直接获取 <a href="#%E6%9C%AC%E6%96%87%E7%9B%B8%E5%85%B3%E8%8C%83%E4%BE%8B%E6%BA%90%E7%A0%81">本范例源码</a> 查看。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="编程实战二只分库">编程实战二：只分库<a class="hash-link" href="#编程实战二只分库" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="初始化数据库环境-1">初始化数据库环境<a class="hash-link" href="#初始化数据库环境-1" title="标题的直接链接">​</a></h3><p>数据库表结构和分片算法逻辑如下图所示。</p><img loading="lazy" width="350" src="/assets/images/32-pangu-framework-sharding-81551ebc3a1f4f760ecec33f0c29df15.png" alt="数据分片实现-只分库" class="img_ev3q"><p>数据库逻辑表结构 <a href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93%E7%8E%AF%E5%A2%83">同上</a>，请自行创建相关真实库表结构。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本地配置-1">本地配置<a class="hash-link" href="#本地配置-1" title="标题的直接链接">​</a></h3><blockquote><p>为便于理解，本文基于本地配置的方式编写。若改为标准的 Nacos 配置中心模式，请参阅：<a href="https://xiongchun.github.io/pangu-framework/docs/advanced-guide/nacos-config-center" target="_blank" rel="noopener noreferrer">配置中心</a> 章节。</p></blockquote><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">application</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">shardingsphere</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">sharding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mybatis</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mapperLocations</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">classpath</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mapper</span><span class="token comment" style="color:#999988;font-style:italic">/**/</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">xml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mybatis</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">configuration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">log</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">impl</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">org</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">apache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ibatis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">stdout</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">StdOutImpl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token operator" style="color:#393A34">=</span><span class="token maybe-class-name">Memory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># print shardingsphere </span><span class="token maybe-class-name">Actual</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SQL</span><span class="token plain"> log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sql</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">show</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">names</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">zaxxer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">hikari</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">HikariDataSource</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">driver</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">class</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jdbc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jdbc</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">url</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">jdbc</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">localhost</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3306</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">username</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">password</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">123456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">zaxxer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">hikari</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">HikariDataSource</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">driver</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">class</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jdbc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jdbc</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">url</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">jdbc</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">localhost</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3306</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">username</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">password</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">123456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># sharding table </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">t_order</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">tables</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">t_order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">actual</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">data</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">nodes</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">$</span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0.</span><span class="token number" style="color:#36acaa">.1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">t_order</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword module" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">database</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">strategy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">standard</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">column</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">user_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword module" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">database</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">strategy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">standard</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">algorithm</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">sa</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># sharding</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">algorithms configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">algorithms</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sa</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">INLINE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">algorithms</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sa</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">algorithm</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">expression</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">$</span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">user_id </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="关键配置项说明-1">关键配置项说明<a class="hash-link" href="#关键配置项说明-1" title="标题的直接链接">​</a></h4><table><thead><tr><th><div style="width:460px">配置项</div></th><th><div style="width:300px">配置说明</div></th></tr></thead><tbody><tr><td>*.t_order.actual-data-nodes</td><td>表 t_order 对应的数据节点（真实表）</td></tr><tr><td>*.default-database-strategy.standard.sharding-column</td><td>表 t_order 的分片键</td></tr><tr><td>*.default-database-strategy.standard.sharding-algorithm-name</td><td>表 t_order 的分片算法名称（自定义标识符）</td></tr><tr><td>*.sharding-algorithms.sa-0.type</td><td>分片算法 sa-0 的类型（INLINE：内置算法）</td></tr><tr><td>*.sharding-algorithms.sa-0.props.algorithm-expression</td><td>分片算法 sa-0 的分片表达式</td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="测试用例-1">测试用例<a class="hash-link" href="#测试用例-1" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="测试写入数据分片-1">测试写入数据分片<a class="hash-link" href="#测试写入数据分片-1" title="标题的直接链接">​</a></h4><p>写入时将分片键：user_id 对 2 求模，根据求模结果将不同用户的订单数据分到2个库中存储。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">Test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createOrder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">TOrderEntity</span><span class="token plain"> entity1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">TOrderEntity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setUserId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setStatus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"0"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tOrderMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">insert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">entity1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">TOrderEntity</span><span class="token plain"> entity2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">TOrderEntity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setUserId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setStatus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"0"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tOrderMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">insert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">entity2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="测试根据分片键路由查询-1">测试根据分片键路由查询<a class="hash-link" href="#测试根据分片键路由查询-1" title="标题的直接链接">​</a></h4><p>根据分片算法，将SQL查询请求路由到对应的真实表查询。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">Test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">routingQuery</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">List</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">TOrderEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> list1 = tOrderMapper.selectList(Wrappers.</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">TOrderEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">lambdaQuery().eq(TOrderEntity::getUserId, 1));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    log.info("结果集：{}" , list1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    List</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">TOrderEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> list2 = tOrderMapper.selectList(Wrappers.</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">TOrderEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">lambdaQuery().eq(TOrderEntity::getUserId, 2));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    log.info("结果集：{}" , list2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="测试结果集归并绑定表关联查询强制路由等特性-1">测试结果集归并、绑定表关联查询、强制路由等特性<a class="hash-link" href="#测试结果集归并绑定表关联查询强制路由等特性-1" title="标题的直接链接">​</a></h4><p>不再赘述。请直接获取 <a href="#%E6%9C%AC%E6%96%87%E7%9B%B8%E5%85%B3%E8%8C%83%E4%BE%8B%E6%BA%90%E7%A0%81">本范例源码</a> 查看。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="编程实战三分库分表">编程实战三：分库分表<a class="hash-link" href="#编程实战三分库分表" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="初始化数据库环境-2">初始化数据库环境<a class="hash-link" href="#初始化数据库环境-2" title="标题的直接链接">​</a></h3><p>数据库表结构和分片算法逻辑如下图所示。</p><img loading="lazy" width="400" src="/assets/images/33-pangu-framework-sharding-b9fb7cf363c0acb41dd02137e257b8bc.png" alt="数据分片实现-只分库" class="img_ev3q"><p>数据库逻辑表结构 <a href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93%E7%8E%AF%E5%A2%83">同上</a>，请自行创建相关真实库表结构。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本地配置-2">本地配置<a class="hash-link" href="#本地配置-2" title="标题的直接链接">​</a></h3><blockquote><p>为便于理解，本文基于本地配置的方式编写。若改为标准的 Nacos 配置中心模式，请参阅：<a href="https://xiongchun.github.io/pangu-framework/docs/advanced-guide/nacos-config-center" target="_blank" rel="noopener noreferrer">配置中心</a> 章节。</p></blockquote><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">application</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">shardingsphere</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">sharding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mybatis</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mapperLocations</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">classpath</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mapper</span><span class="token comment" style="color:#999988;font-style:italic">/**/</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">xml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mybatis</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">configuration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">log</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">impl</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">org</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">apache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ibatis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">stdout</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">StdOutImpl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token operator" style="color:#393A34">=</span><span class="token maybe-class-name">Memory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># print shardingsphere </span><span class="token maybe-class-name">Actual</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SQL</span><span class="token plain"> log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sql</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">show</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">names</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">zaxxer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">hikari</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">HikariDataSource</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">driver</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">class</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jdbc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jdbc</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">url</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">jdbc</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">localhost</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3306</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">username</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">password</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">123456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">zaxxer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">hikari</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">HikariDataSource</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">driver</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">class</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jdbc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jdbc</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">url</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">jdbc</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">localhost</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3306</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">username</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">password</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">123456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># sharding table </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">t_order</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword module" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">database</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">strategy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">standard</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">column</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">user_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword module" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">database</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">strategy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">standard</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">algorithm</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">sa</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">tables</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">t_order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">actual</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">data</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">nodes</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">$</span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0.</span><span class="token number" style="color:#36acaa">.1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">t_order$</span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0.</span><span class="token number" style="color:#36acaa">.1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">tables</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">t_order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">table</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">strategy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">standard</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">column</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">order_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">tables</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">t_order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">table</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">strategy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">standard</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">algorithm</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">sa</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># sharding databases algorithms configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">algorithms</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sa</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">INLINE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">algorithms</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sa</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">algorithm</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">expression</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">$</span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">user_id </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># sharding tables algorithms configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">algorithms</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sa</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">INLINE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sharding</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">algorithms</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sa</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">algorithm</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">expression</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">t_order$</span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">order_id </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="关键配置项说明-2">关键配置项说明<a class="hash-link" href="#关键配置项说明-2" title="标题的直接链接">​</a></h4><table><thead><tr><th><div style="width:460px">配置项</div></th><th><div style="width:300px">配置说明</div></th></tr></thead><tbody><tr><td>*.t_order.actual-data-nodes</td><td>表 t_order 对应的数据节点（真实表）</td></tr><tr><td>*.default-database-strategy.standard.sharding-column</td><td>表 t_order 的分库分片键</td></tr><tr><td>*.default-database-strategy.standard.sharding-algorithm-name</td><td>表 t_order 的分库分片算法名称</td></tr><tr><td>*.t_order.table-strategy.standard.sharding-column</td><td>表 t_order 的库内分表分片键</td></tr><tr><td>*.t_order.table-strategy.standard.sharding-algorithm-name</td><td>表 t_order 的库内分表算法名称</td></tr><tr><td>*.sharding-algorithms.sa-0.type</td><td>分库算法的类型</td></tr><tr><td>*.sharding-algorithms.sa-0.props.algorithm-expression</td><td>分库表达式</td></tr><tr><td>*.sharding-algorithms.sa-1.type</td><td>库内分表算法的类型</td></tr><tr><td>*.sharding-algorithms.sa-1.props.algorithm-expression</td><td>库内分表表达式</td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="测试用例-2">测试用例<a class="hash-link" href="#测试用例-2" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="测试写入数据分片-2">测试写入数据分片<a class="hash-link" href="#测试写入数据分片-2" title="标题的直接链接">​</a></h4><p>写入时将分片键 user_id 对 2 求模，根据求模结果将订单数据分片到 2 个库中，再将分片键 order_id 对 2 求模，并根据求模结果将订单数据分片到库中不同的表来存储。（注意：本例有两个分片键，第一个用来分库；第二个用来库内分表。）</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">Test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createOrder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">TOrderEntity</span><span class="token plain"> entity1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">TOrderEntity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setUserId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setStatus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"0"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tOrderMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">insert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">entity1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">TOrderEntity</span><span class="token plain"> entity2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">TOrderEntity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setUserId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setStatus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"0"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tOrderMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">insert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">entity2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>TOrderEntity</code> 的 orderId 主键请通过如下注解生成。当然也可以自定义 ID 算法赋值。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:#d73a49">TableId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"order_id"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">IdType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">ASSIGN_ID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token maybe-class-name">Long</span><span class="token plain"> orderId</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="测试根据分片键路由查询-2">测试根据分片键路由查询<a class="hash-link" href="#测试根据分片键路由查询-2" title="标题的直接链接">​</a></h4><p>根据分片算法，将SQL查询请求路由到对应的真实表查询。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">Test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">routingQuery</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">List</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">TOrderEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> list1 = tOrderMapper.selectList(Wrappers.</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">TOrderEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">lambdaQuery().eq(TOrderEntity::getUserId, 1));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    log.info("结果集：{}" , list1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    List</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">TOrderEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> list2 = tOrderMapper.selectList(Wrappers.</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">TOrderEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">lambdaQuery().eq(TOrderEntity::getUserId, 2));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    log.info("结果集：{}" , list2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="测试结果集归并绑定表关联查询强制路由等特性-2">测试结果集归并、绑定表关联查询、强制路由等特性<a class="hash-link" href="#测试结果集归并绑定表关联查询强制路由等特性-2" title="标题的直接链接">​</a></h4><p>不再赘述。请直接获取 <a href="#%E6%9C%AC%E6%96%87%E7%9B%B8%E5%85%B3%E8%8C%83%E4%BE%8B%E6%BA%90%E7%A0%81">本范例源码</a> 查看。</p><div class="theme-admonition theme-admonition-warning alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>警报</div><div class="admonitionContent_S0QG"><ul><li>对分片表的查询操作，查询条件务必要包含分片键，否则会遍历所有数据节点。尽量维持单表查询。</li><li>如果需要关联查询，请结合绑定表、广播表酌情合理应用。</li></ul></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本文相关范例源码">本文相关范例源码<a class="hash-link" href="#本文相关范例源码" title="标题的直接链接">​</a></h2><ul><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-shardingsphere-sharding" target="_blank" rel="noopener noreferrer">pangu-examples-shardingsphere-sharding</a>：数据治理之数据分片范例</li></ul>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="服务端开发" term="服务端开发"/>
        <category label="盘古开发框架" term="盘古开发框架"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[基于 ShardingSphere 的读写分离数据治理]]></title>
        <id>pangu-dev-framework-readwrite-splitting</id>
        <link href="https://xiongchun.github.io/blog/pangu-dev-framework-readwrite-splitting"/>
        <updated>2019-10-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[盘古开发框架 集成了数据库中间件 ShardingSphere 来提供数据治理相关功能。如：读写分离、数据分片、数据加密等。]]></summary>
        <content type="html"><![CDATA[<p><a href="https://github.com/xiongchun/pangu-framework" target="_blank" rel="noopener noreferrer">盘古开发框架</a> 集成了数据库中间件 <a href="https://shardingsphere.apache.org/index.html" target="_blank" rel="noopener noreferrer">ShardingSphere</a> 来提供数据治理相关功能。如：读写分离、数据分片、数据加密等。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="读写分离概念">读写分离概念<a class="hash-link" href="#读写分离概念" title="标题的直接链接">​</a></h2><p>随着业务系统日益增加的系统访问量，数据库的吞吐量往往成为系统并发的性能瓶颈。对于同一时刻有大量并发读操作和较少写操作类型的应用系统来说，将数据库拆分为主库和从库搭架主从集群，由主库负责处理事务性的增删改操作，从库负责处理查询操作，能够有效的避免数据更新导致的行锁，从而一定程度提升整个系统的读写并发性能。如下图所示。</p><img loading="lazy" width="400" src="/assets/images/28-pangu-framework-readwrite-splitting-5350969993059c6d60c320e0a46bab20.png" alt="虚拟业务场景设计" class="img_ev3q"><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_S0QG"><p>目前支持一主一从或一主多从的主从集群架构，不支持多主写的架构。对于多从的架构可根据路由算法做读负载均衡，以将查询请求均匀的分散到多个数据副本。（数据库主从架构搭架不在本文讨论范围之内）</p></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="读写分离后面临的问题">读写分离后面临的问题<a class="hash-link" href="#读写分离后面临的问题" title="标题的直接链接">​</a></h3><p>对于一般的简单理解，读写分离就是 DQL 请求走从库，DML 请求走主库。但对于开发人员而言，在实际开发中还需要考虑如下问题。</p><ul><li><p><strong>主从数据同步延迟问题</strong><br>
<!-- -->因为我们主从同步是异步复制的，不可避免的会有延迟。因此有可能出现 mastre 节点已经写入，但是从 slave 节点读取不到数据的问题。解决方法见后续测试用例章节：读操作强制走主库和事务方法里的所有读写操作都自动走主库。</p></li><li><p><strong>事务问题</strong>
如果一个事务方法里既包含有 DML 请求也有 DQL 请求，如果读请求走从库写请求走主库的话，则势必会带来分布式事务的问题。但对于大部分读写分离场景而言，很显然我们并不希望为了读写分离而去处理分布式事务的问题。因此对于读写分离，恰当的做法是将事务方法中的所有 SQL 请求统一都走主库，将跨库的分布式事务转为本地事务来处理。见后续测试用例章节：事务方法里的所有读写操作都自动走主库。（如果对于分布式场景下的分布式事务问题的处理感兴趣，可以参考：<a href="https://xiongchun.github.io/pangu-framework/docs/advanced-guide/distributed-transaction" target="_blank" rel="noopener noreferrer">盘古框架分布式事务最佳实践</a>）</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="相关专业术语">相关专业术语<a class="hash-link" href="#相关专业术语" title="标题的直接链接">​</a></h3><ul><li><strong>主库</strong>：数据 DML 写操作（insert、update、delete）使用的数据库。仅支持单主库。</li><li><strong>从库</strong>：数据 DQL 读操作（select）使用的数据库。可支持多从库。</li><li><strong>主从同步</strong>：将主库数据同步到从库的操作。依赖数据库自身的同步机制，比如：MySQL 基于 binlog 的异步复制。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="读写分离实现原理">读写分离实现原理<a class="hash-link" href="#读写分离实现原理" title="标题的直接链接">​</a></h2><p>实现读写分离大致有 3 种方案。如下图所示。</p><img loading="lazy" width="800" src="/assets/images/27-pangu-framework-readwrite-splitting-895f2714eb8356719428797a474cfce6.png" alt="读写分离实现原理" class="img_ev3q"><ul><li><p><strong>数据库代理模式（服务端代理）</strong><br>
<!-- -->在数据库和应用系统之间独立部署一个数据库代理中间件，所有的 SQL 请求先发送到这个代理，由它完成 SQL 解析、SQL 路由等必要操作。在这种模式下，路由规则都配置到代理上，读写分离的逻辑对开发人员是透明的。</p></li><li><p><strong>数据源代理模式（客户端代理）</strong><br>
<!-- -->通过在应用端引入组件包，代理应用普通数据源。在这种模式下，路由规则配置到应用侧，所有 SQL 请求都通过代理数据源完成 SQL 解析、SQL 路由等必要操作。</p></li><li><p><del><strong>ORM 框架代理模式（客户端代理）</strong></del><br>
<!-- -->通过 ORM 框架（Hibernate、Mybatis 等）的插件、拦截器机制实现。这只能算是特定环境下的一种实现方法，不能作为一套完整的标准化解决方案。故在此不做更多描述。
</p></li></ul><table><thead><tr><th><div style="width:120px">实现方式</div></th><th>可选组件</th><th><div style="width:150px">优点</div></th><th><div style="width:200px">缺点</div></th></tr></thead><tbody><tr><td><strong>数据库代理模式</strong></td><td>ShardingSphere-Proxy <br> MyCat</td><td>多语言支持<br>独立部署（升级简单）<br>对开发完全透明</td><td>独立部署（增加不稳定因素）<br> 运维成本高<br>性能损耗高</td></tr><tr><td><strong>数据源代理模式 💋 </strong></td><td>ShardingSphere-JDBC</td><td>集成简单、轻松驾驭<br>性能较好</td><td>嵌入 JAR（升级麻烦）<br>日常数据维护麻烦</td></tr><tr><td><strong><del>ORM 框架代理模式</del></strong></td><td>自研/硬编码</td><td>硬撸一时爽</td><td>事后火葬场</td></tr></tbody></table><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>警告</div><div class="admonitionContent_S0QG"><p>盘古开发框架使用 ShardingSphere-JDBC 组件，通过数据源代理的方式实现读写分离功能。</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="编程实战">编程实战<a class="hash-link" href="#编程实战" title="标题的直接链接">​</a></h2><p>本实例以一主二从的数据库主从集群为例，来演示如何基于盘古框架开发一个读写分离且支持读负载均衡的范例程序。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="初始化数据库环境">初始化数据库环境<a class="hash-link" href="#初始化数据库环境" title="标题的直接链接">​</a></h3><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">主库 DB</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">create table </span><span class="token function" style="color:#d73a49">t_order</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    order_id bigint auto_increment primary key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user_id  int         not </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status   </span><span class="token function" style="color:#d73a49">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    comment </span><span class="token string" style="color:#e3116c">'订单表'</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>根据上述脚本，再创建从库 1 和 从库 2 的 t_order 表。（仅演示读写分离效果，不搭建真实主从复制集群，可手工插入从库所需测试数据）</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装相关盘古模块">安装相关盘古模块<a class="hash-link" href="#安装相关盘古模块" title="标题的直接链接">​</a></h3><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">盘古 Parent</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">基础模块</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">JDBC 模块</li><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">数据治理模块</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-parent</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">latest.version.xxx</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">relativePath</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-jdbc-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6"><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-data-governance-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本地配置">本地配置<a class="hash-link" href="#本地配置" title="标题的直接链接">​</a></h3><blockquote><p>为便于理解，本文基于本地配置的方式编写。若改为标准的 Nacos 配置中心模式，请参阅：<a href="https://xiongchun.github.io/pangu-framework/docs/advanced-guide/nacos-config-center" target="_blank" rel="noopener noreferrer">配置中心</a> 章节。</p></blockquote><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">application</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">shardingsphere</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">readwrite</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">splitting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mybatis</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mapperLocations</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">classpath</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mapper</span><span class="token comment" style="color:#999988;font-style:italic">/**/</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">xml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mybatis</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">configuration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">log</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">impl</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">org</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">apache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ibatis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">stdout</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">StdOutImpl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># print shardingsphere </span><span class="token maybe-class-name">Actual</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SQL</span><span class="token plain"> log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sql</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">show</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">names</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">master</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">slave</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">slave</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 主库数据源配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">master</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">zaxxer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">hikari</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">HikariDataSource</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">master</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">driver</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">class</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jdbc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">master</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jdbc</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">url</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">jdbc</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">localhost</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3306</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">master</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">username</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">master</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">password</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">123456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 从库 </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> 数据源配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">slave</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">zaxxer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">hikari</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">HikariDataSource</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">slave</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">driver</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">class</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jdbc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">slave</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jdbc</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">url</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">jdbc</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">localhost</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3306</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">slave</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">username</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">slave</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">password</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">123456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 从库 </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> 数据源配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">slave</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">zaxxer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">hikari</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">HikariDataSource</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">slave</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">driver</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">class</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jdbc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">slave</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jdbc</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">url</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">jdbc</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">localhost</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3306</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">slave</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">username</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">slave</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">password</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">123456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 读写分离策略配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">readwrite</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">splitting</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">data</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">sources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">rws</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token operator" style="color:#393A34">=</span><span class="token maybe-class-name">Static</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 写数据源配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">readwrite</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">splitting</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">data</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">sources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">rws</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">write</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">data</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">source</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 读数据源配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">readwrite</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">splitting</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">data</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">sources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">rws</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">read</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">data</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">source</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">names</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">slave</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">ds</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">slave</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 读负载均衡算法配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shardingsphere</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">readwrite</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">splitting</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">load</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">balancers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">read</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">RANDOM</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="测试用例">测试用例<a class="hash-link" href="#测试用例" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启动类">启动类<a class="hash-link" href="#启动类" title="标题的直接链接">​</a></h3><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">EnableTransactionManagement</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">SpringBootApplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ReadWriteSplittingApplication</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter known-class-name class-name">String</span><span class="token parameter punctuation" style="color:#393A34">[</span><span class="token parameter punctuation" style="color:#393A34">]</span><span class="token parameter"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">PanGuApplicationBuilder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">ReadWriteSplittingApplication</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="测试写操作自动走主库">测试写操作自动走主库<a class="hash-link" href="#测试写操作自动走主库" title="标题的直接链接">​</a></h3><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">Test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">writeRoute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">TOrderEntity</span><span class="token plain"> entity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">TOrderEntity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setUserId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setStatus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"测试"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tOrderMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">insert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">entity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="测试读操作自动走从库负载均衡">测试读操作自动走从库负载均衡<a class="hash-link" href="#测试读操作自动走从库负载均衡" title="标题的直接链接">​</a></h3><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">Test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">readRoute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tOrderMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">selectById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">1508317805991194627L</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tOrderMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">selectById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">1508317805991194628L</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="测试读操作强制走主库">测试读操作强制走主库<a class="hash-link" href="#测试读操作强制走主库" title="标题的直接链接">​</a></h3><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">Test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">readByWriteRoute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">HintManager</span><span class="token plain"> hintManager </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">HintManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hintManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setWriteRouteOnly</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"查询数据（强制走主库）..."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">TOrderEntity</span><span class="token plain"> entity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tOrderMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">selectById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">2L</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"查询结果 {}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> entity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hintManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="测试事务方法自动走主库">测试事务方法自动走主库<a class="hash-link" href="#测试事务方法自动走主库" title="标题的直接链接">​</a></h3><p>事务方法里的所有读写操作都自动走主库。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">Test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:#d73a49">Transactional</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rollbackFor </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">RuntimeException</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">doWithTransaction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"插入数据..."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">TOrderEntity</span><span class="token plain"> entity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">TOrderEntity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setUserId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setStatus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"测试"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tOrderMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">insert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">entity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"查询数据（事务方法内所有请求自动走主库）..."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tOrderMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">selectById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">1L</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本文相关范例源码">本文相关范例源码<a class="hash-link" href="#本文相关范例源码" title="标题的直接链接">​</a></h2><ul><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-shardingsphere-readwrite-splitting" target="_blank" rel="noopener noreferrer">pangu-examples-shardingsphere-readwrite-splitting</a>：数据治理之读写分离范例</li></ul>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="服务端开发" term="服务端开发"/>
        <category label="盘古开发框架" term="盘古开发框架"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[基于 Nacos 实现盘古开发框架配置中心]]></title>
        <id>pangu-dev-framework-configuration-center</id>
        <link href="https://xiongchun.github.io/blog/pangu-dev-framework-configuration-center"/>
        <updated>2019-08-18T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[配置中心作为分布式微服务开发的标配组件，业界已有很多成功的典型应用，如：携程 Apollo 分布式配置中心、百度 Disconf 分布式配置中心等。盘古开发框架 配置中心基于阿里的 Nacos 提供动态配置服务。]]></summary>
        <content type="html"><![CDATA[<p>配置中心作为分布式微服务开发的标配组件，业界已有很多成功的典型应用，如：携程 Apollo 分布式配置中心、百度 Disconf 分布式配置中心等。<a href="https://github.com/xiongchun/pangu-framework" target="_blank" rel="noopener noreferrer">盘古开发框架</a> 配置中心基于阿里的 <a href="https://nacos.io/en-us/index.html" target="_blank" rel="noopener noreferrer">Nacos</a> 提供动态配置服务。</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_S0QG"><p>鉴于文档可读性，盘古教程和参考范例都使用的本地配置的方式。本文将介绍如何基于配置中心让盘古应用获得动态配置服务的能力。在实际应用中，如无特殊需求我们一般都建议采用配置中心的方式来开发。</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置中心介绍">配置中心介绍<a class="hash-link" href="#配置中心介绍" title="标题的直接链接">​</a></h2><p>Nacos 动态配置服务可以让你以中心化、外部化和动态化的方式管理所有环境的应用配置和服务配置。动态配置消除了配置变更时重新部署应用和服务的需要，让配置管理变得更加高效和敏捷。配置中心化管理让实现无状态服务变得更简单，让服务按需弹性扩展变得更容易。它还提供了一个简洁易用的 UI 帮助你管理所有的服务和应用的配置，包括配置版本跟踪、金丝雀发布、一键回滚配置等一系列开箱即用的配置管理特性，帮助你更安全地在生产环境中管理配置变更和降低配置变更带来的风险。</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><b>快速 QA：</b>前文中 Nacos 用于服务注册，为什么配置中心也是它？</summary><div><div class="collapsibleContent_i85q"><div>Nacos 是构建以“服务”为中心的现代应用架构 (例如微服务范式、云原生范式) 的服务基础设施。致力于发现、配置和管理微服务，完美的整合了配置中心和服务注册中心。因此，Nacos 不仅是服务注册中心也是功能完善的分布式配置中心。</div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><b>快速 QA：</b>单体分层架构的开发模式也可以使用配置中心进行配置吗？</summary><div><div class="collapsibleContent_i85q"><div>配置中心是分布式微服务架构开发环境下强烈建议的必选标配组件。但如果你是基于单体分层架构开发，配置中心也是一样可以使用的。对于这些基础能力，无论是微服务还是单体，盘古框架都做了完美适配，只需要依赖 `pangu-spring-boot-starter` 就可以实现开箱即用。</div></div></div></details><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="相关名词解释">相关名词解释<a class="hash-link" href="#相关名词解释" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="命名空间">命名空间<a class="hash-link" href="#命名空间" title="标题的直接链接">​</a></h4><p>用于进行租户粒度的配置隔离。不同的命名空间下，可以存在相同的 Group 或 Data ID 的配置。Namespace 的常用场景之一是不同环境的配置的区分隔离，例如开发测试环境和生产环境的资源（如配置、服务）隔离等。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置管理">配置管理<a class="hash-link" href="#配置管理" title="标题的直接链接">​</a></h4><p>系统配置的编辑、存储、分发、变更管理、历史版本管理、变更审计等所有与配置相关的活动。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置项">配置项<a class="hash-link" href="#配置项" title="标题的直接链接">​</a></h4><p>一个具体的可配置的参数与其值域，通常以 param-key=param-value 的形式存在。例如我们常配置系统的日志输出级别（ logLevel=INFO|WARN|ERROR ）就是一个配置项。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置集">配置集<a class="hash-link" href="#配置集" title="标题的直接链接">​</a></h4><p>一组相关或者不相关的配置项的集合称为配置集。在系统中，一个配置文件通常就是一个配置集，包含了系统各个方面的配置。例如，一个配置集可能包含了数据源、线程池、日志级别等配置项。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置集id">配置集ID<a class="hash-link" href="#配置集id" title="标题的直接链接">​</a></h4><p>Nacos 中的某个配置集的 ID。配置集 ID 是组织划分配置的维度之一。一个系统或者应用可以包含多个配置集，每个配置集都可以被一个有意义的名称标识。（比如：使用应用名称作为 Data ID）</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置快照">配置快照<a class="hash-link" href="#配置快照" title="标题的直接链接">​</a></h4><p>Nacos 的客户端 SDK 会在本地生成配置的快照。当客户端无法连接到 Nacos Server 时，可以使用配置快照显示系统的整体容灾能力。配置快照类似于 Git 中的本地 commit，也类似于缓存，会在适当的时机更新，但是并没有缓存过期（ expiration ）的概念。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本地配置与配置中心对比">本地配置与配置中心对比<a class="hash-link" href="#本地配置与配置中心对比" title="标题的直接链接">​</a></h3><ul><li><strong>本地配置（配置文件）</strong><ul><li>配置分散、与应用耦合、静态配置 </li><li>无环境隔离无版本支持，容易引发生产事故 </li><li>无安全审计 </li></ul></li><li><strong>配置中心</strong><ul><li>配置集中、外部化、动态化实时生效</li><li>多环境隔离多版本支持，较安全</li><li>配置权限控制、操作变更审计</li></ul></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置中心实战">配置中心实战<a class="hash-link" href="#配置中心实战" title="标题的直接链接">​</a></h2><p>下面介绍一个使用配置中心的例子。其它基于本地配置的范例都可以参考这个例子改为基于配置中心的动态配置。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装相关盘古模块">安装相关盘古模块<a class="hash-link" href="#安装相关盘古模块" title="标题的直接链接">​</a></h3><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">盘古 Parent</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">基础模块</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-parent</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">latest.version.xxx</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">relativePath</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本地配置">本地配置<a class="hash-link" href="#本地配置" title="标题的直接链接">​</a></h3><p>基于配置中心的配置也是需要一个本地配置文件的，但这个配置文件是固定的模版格式。用于配置一些与配置中心进行数据通信相关的基础类参数。如下所示。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">application</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">config</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">remote</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">nacos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">profiles</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">active</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">profiles</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">active</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">dev</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">bootstrap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">enable</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">bootstrap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">log</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">enable</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">auto</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">refresh</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">nacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">namespace</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">dev</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">server</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">addr</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">nacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">server</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">addr</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">127.0</span><span class="token number" style="color:#36acaa">.0</span><span class="token number" style="color:#36acaa">.1</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8848</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#nacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">properties</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nacos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">data</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">application</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="关键配置项说明">关键配置项说明<a class="hash-link" href="#关键配置项说明" title="标题的直接链接">​</a></h4><ul><li>nacos.config.auto-refresh<br>配置中心的配置变更后自动刷新到配置客户端 </li><li>nacos.config.namespace<br>命名空间（注意是对应命名空间的 ID 值），建议使用命名空间来区分部署环境 </li><li>nacos.config.server-addr<br>配置中心通信地址 </li><li>nacos.config.type<br>配置中心使用的配置格式（ properties、yaml 等）   </li><li>nacos.config.data-id<br>配置中心某配置集的唯一标识 </li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置中心配置">配置中心配置<a class="hash-link" href="#配置中心配置" title="标题的直接链接">​</a></h3><p>在进行完上述本地配置后，我们的应用就能和配置中心进行数据同步了。现在根据本地配置信息在配置中心创建相对应的命名空间和同名 data-id 的配置集。</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><b>快速 QA：</b>客户端是如何与 Nacos 配置中心进行数据同步的？</summary><div><div class="collapsibleContent_i85q"><div>客户端通过 http 长轮询机制拉取 nacos server 端的配置数据，并会在本地创建配置快照（容灾）。在长轮询的超时等待过程中，nacos server 端如果配置发生改变，会主动将配置写入 response 并返回，模拟了“推送”效果。所以客户端能实时感知配置中心的配置变化。</div></div></div></details><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建命名空间">创建命名空间<a class="hash-link" href="#创建命名空间" title="标题的直接链接">​</a></h4><p>在 Nacos 管理系统的『命名空间』菜单新建 ID 为 <code>pangu-dev</code> 的命名空间（此 ID 即为上述配置项 nacos.config.namespace 的值）。如下图所示。</p><p><img loading="lazy" alt="创建命名空间" src="/assets/images/5-pangu-framework-nacos-fe8c6993888d62ca44a92af4f8cb1a53.png" width="2870" height="766" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建配置集">创建配置集<a class="hash-link" href="#创建配置集" title="标题的直接链接">​</a></h4><p>一个命名空间下可以创建多组配置集，每个配置集由 data-id 来唯一标识。在 Nacos 管理系统的『配置管理-配置列表』菜单新建 data-id 值为 <code>pangu-examples-config-remote-nacos</code> 的配置集。如下图所示。</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">配置集列表</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">新增/编辑配置集</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p><img loading="lazy" alt="创建配置集" src="/assets/images/6-pangu-framework-nacos-0a9156bbb5b3f7d49c4c50c5e0fb61a5.png" width="2624" height="726" class="img_ev3q"></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><img loading="lazy" alt="创建配置集" src="/assets/images/7-pangu-framework-nacos-31a90858740c790cd14ec9e0b9a676a2.png" width="2240" height="1370" class="img_ev3q"></p></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启动入口">启动入口<a class="hash-link" href="#启动入口" title="标题的直接链接">​</a></h3><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">SpringBootApplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">NacosConfigurationApplication</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter known-class-name class-name">String</span><span class="token parameter punctuation" style="color:#393A34">[</span><span class="token parameter punctuation" style="color:#393A34">]</span><span class="token parameter"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">PanGuApplicationBuilder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">NacosConfigurationApplication</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用配置">使用配置<a class="hash-link" href="#使用配置" title="标题的直接链接">​</a></h3><p>至此，我们就可以在应用中使用 <code>@NacosValue</code> 注解来获取配置项了。如下代码所示。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 开启 autoRefreshed配置项, 可以实现参数的动态刷新</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:#d73a49">NacosValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"${demo.app.id}"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token plain"> appId</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:#d73a49">NacosValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"${demo.app.name}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> autoRefreshed </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token plain"> appName</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:#d73a49">NacosValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"${demo.app.author}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> autoRefreshed </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token plain"> appAuthor</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><b>快速 QA：</b>范例只演示了几个简单的变量参数，数据库等中间件的连接配置信息可以放配置中心吗？</summary><div><div class="collapsibleContent_i85q"><div>当然是可以的，干就完了。</div></div></div></details><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本文相关范例源码">本文相关范例源码<a class="hash-link" href="#本文相关范例源码" title="标题的直接链接">​</a></h2><ul><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-config-remote-nacos" target="_blank" rel="noopener noreferrer">pangu-examples-config-remote-nacos</a>：配置中心参考范例</li><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-log-dynamic" target="_blank" rel="noopener noreferrer">pangu-examples-log-dynamic</a>：基于配置中心的日志级别热切换参考范例</li></ul>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="服务端开发" term="服务端开发"/>
        <category label="盘古开发框架" term="盘古开发框架"/>
        <category label="Nacos" term="Nacos"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[基于 Nacos 实现盘古开发框架服务注册中心]]></title>
        <id>pangu-dev-framework-service-discovery-center</id>
        <link href="https://xiongchun.github.io/blog/pangu-dev-framework-service-discovery-center"/>
        <updated>2019-07-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[注册中心是分布式微服务开发的标配组件，盘古开发框架 服务注册中心借助 Nacos 提供动态服务注册和服务发现能力。]]></summary>
        <content type="html"><![CDATA[<p>注册中心是分布式微服务开发的标配组件，<a href="https://github.com/xiongchun/pangu-framework" target="_blank" rel="noopener noreferrer">盘古开发框架</a> 服务注册中心借助 <a href="https://nacos.io/en-us/index.html" target="_blank" rel="noopener noreferrer">Nacos</a> 提供动态服务注册和服务发现能力。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="注册中心介绍">注册中心介绍<a class="hash-link" href="#注册中心介绍" title="标题的直接链接">​</a></h2><p>服务注册中心是以服务为中心架构，实现服务化管理的核心组件。类似于目录服务的作用，主要用来存储服务实例信息，譬如提供者地址、路由信息等。服务注册中心是微服务架构中必选的标配基础设施之一。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="相关名词解释">相关名词解释<a class="hash-link" href="#相关名词解释" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="注册中心">注册中心<a class="hash-link" href="#注册中心" title="标题的直接链接">​</a></h4><p>存储服务实例和服务负载均衡策略的系统。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="服务注册">服务注册<a class="hash-link" href="#服务注册" title="标题的直接链接">​</a></h4><p>将服务实例地址和元数据信息写入服务注册中心的过程。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="服务发现">服务发现<a class="hash-link" href="#服务发现" title="标题的直接链接">​</a></h4><p>在计算机网络上，使用服务名对服务的实例地址和元数据进行探测，并以预先定义的接口提供给客户端进行查询。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="健康检查">健康检查<a class="hash-link" href="#健康检查" title="标题的直接链接">​</a></h4><p>以指定方式检查服务下挂载实例的健康度，从而确认该实例是否能提供服务。根据检查结果，实例会被判断为健康或不健康。对服务发起解析请求时，不健康的实例不会返回给客户端。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="注册中心图示">注册中心图示<a class="hash-link" href="#注册中心图示" title="标题的直接链接">​</a></h3><p><img loading="lazy" alt="盘古开发框架注册中心图示" src="/assets/images/8-pangu-framework-nacos-7fa670ee776977bdde35ba85cffeb379.png" width="2872" height="1358" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="注册中心实战">注册中心实战<a class="hash-link" href="#注册中心实战" title="标题的直接链接">​</a></h2><p>请参考 <a href="/blog/pangu-dev-framework-create-microservice">如何基于盘古开发框架开发微服务应用</a> 博文，那里已经详细完整的讲解了服务注册&amp;服务发现的相关内容。</p>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="服务端开发" term="服务端开发"/>
        <category label="盘古开发框架" term="盘古开发框架"/>
        <category label="Nacos" term="Nacos"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[消息队列 RabbitMQ 入门与实践]]></title>
        <id>rabbitmq-quick-start-and-best-practice</id>
        <link href="https://xiongchun.github.io/blog/rabbitmq-quick-start-and-best-practice"/>
        <updated>2018-11-29T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[盘古开发框架 缺省使用的消息队列中间件是 RabbitMQ。消息队列在分布式系统的异步通信、服务解耦、消峰填谷、缓存同步等应用场景下有广泛的使用。]]></summary>
        <content type="html"><![CDATA[<p><a href="https://github.com/xiongchun/pangu-framework" target="_blank" rel="noopener noreferrer">盘古开发框架</a> 缺省使用的消息队列中间件是 <a href="https://www.rabbitmq.com/" target="_blank" rel="noopener noreferrer">RabbitMQ</a>。消息队列在分布式系统的异步通信、服务解耦、消峰填谷、缓存同步等应用场景下有广泛的使用。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装相关盘古模块">安装相关盘古模块<a class="hash-link" href="#安装相关盘古模块" title="标题的直接链接">​</a></h2><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">盘古 Parent</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">基础模块</li><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">消息队列模块</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-parent</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">latest.version.xxx</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">relativePath</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6"><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-rabbitmq-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="队列规划">队列规划<a class="hash-link" href="#队列规划" title="标题的直接链接">​</a></h2><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>建议</div><div class="admonitionContent_S0QG"><p>建议提前规划队列结构模型，而不是通过客户端 API 动态创建消息交换机和绑定队列。</p></div></div><p>根据应用场景和业务类型先规划设计出队列结构模型，然后分别将队列相关信息分配给生产侧和消费侧开发人员。本教程使用的队列模型如下图所示。</p><img loading="lazy" width="580" src="/assets/images/14-pangu-framework-queue-5a69054a213557c7a93c4653ff7df4ad.png" alt="队列规划" class="img_ev3q"><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="图示说明">图示说明<a class="hash-link" href="#图示说明" title="标题的直接链接">​</a></h3><p>上图所示虚拟机、交换主机、队列、路由类型、路由键等为 RabbitMQ 中间件的概念。本文对其做如下简要描述，详细信息请查阅 <a href="https://www.rabbitmq.com/" target="_blank" rel="noopener noreferrer">RabbitMQ</a> 相关文档。</p><ul><li><strong>虚拟主机（Virtual Host）</strong><br>一个资源管理概念，用作逻辑隔离。不同 Vhost 之间的 Exchange 和 Queue 相互隔离，互不干扰。</li><li><strong>交换机（Exchange）</strong><br>生产者将消息发送到 Exchange 中，Exchange 根据消息的属性或内容将消息路由到一个或多个 Queue 中（或者丢弃），Consumer 从 Queue 中拉取消息进行消费。</li><li><strong>路由类型</strong><br>交换机的关键属性。包括：Direct、Fanout、Topic。<ul><li><strong>Direct</strong>：该类型的交换机会把消息路由到与路由键完全匹配的 Queue 中。</li><li><strong>Fanout</strong>：该类型的交换机会将消息路由到所有与其绑定的 Queue 中。</li><li><strong>Topic</strong>：该类型的交换机会支持多条件匹配和模糊匹配将消息路由至与其绑定的 Queue 中。（本文不讲解，一般情况使用 Direct、Fanout 即可）</li></ul></li><li><strong>路由键</strong><br>当交换机路由类型为 Direct 或 Topic 时，交换机绑定队列时需要设置路由键，给交换机发送消息时需要带上这个参数，交换机根据路由类型和路由键匹配规则将消息投递到合适的队列等待消费。（Direct 是精确匹配、Topic 是模糊匹配、Fanout 不需要路由匹配）</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建队列">创建队列<a class="hash-link" href="#创建队列" title="标题的直接链接">​</a></h2><p>本文以腾讯云 TDMQ (RabbitMQ 版本) 为例。TDMQ RabbitMQ 版是一款腾讯研发的消息队列服务，支持 AMQP 0-9-1 协议，完全兼容开源 RabbitMQ 的各个组件与概念。因此，本教程也适用原生开源 RabbitMQ 中间件和兼容开源 RabbitMQ 的其它云端消息服务。</p><p>在控制台创建队列及相关组件如下图所示。</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">虚拟主机</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">交换机</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">队列</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">路由关系</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p><img loading="lazy" alt="虚拟主机" src="/assets/images/17-pangu-framework-queue-3f644ee310a66a137d590f70b0ac0990.png" width="2406" height="576" class="img_ev3q"></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><img loading="lazy" alt="交换机" src="/assets/images/18-pangu-framework-queue-757b4770b7e2729e710c4c7778b286b4.png" width="2410" height="702" class="img_ev3q"></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><img loading="lazy" alt="队列" src="/assets/images/19-pangu-framework-queue-ffeb4363d1c2353b582a1e740dc2d737.png" width="2398" height="1016" class="img_ev3q"></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><img loading="lazy" alt="路由关系" src="/assets/images/20-pangu-framework-queue-e6103b0b9b4b0e481013e283b84c45f6.png" width="2404" height="946" class="img_ev3q"></p></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="消息生产者">消息生产者<a class="hash-link" href="#消息生产者" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本地配置">本地配置<a class="hash-link" href="#本地配置" title="标题的直接链接">​</a></h3><blockquote><p>为便于理解，本文基于本地配置的方式编写。若改为标准的 Nacos 配置中心模式，请参阅：<a href="https://xiongchun.github.io/pangu-framework/docs/advanced-guide/nacos-config-center" target="_blank" rel="noopener noreferrer">配置中心</a> 章节。</p></blockquote><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">application.properties</li><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">application-dev.properties</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">profiles</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">active</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">profiles</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">active</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">dev</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6"><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">application</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">mq</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">rabbitmq</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">sender</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rabbitmq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">host</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">jzaep3orxb2b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">public</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">tencenttdmq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">com</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rabbitmq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5672</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rabbitmq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">username</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rabbitmq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">password</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">123456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rabbitmq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">virtual</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">host</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">vhost</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">pangu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">root</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">gitee</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pulanos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pangu</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">INFO</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="消息发送代码">消息发送代码<a class="hash-link" href="#消息发送代码" title="标题的直接链接">​</a></h3><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">Slf4j</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">Component</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">SendService</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token maybe-class-name">Autowired</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token maybe-class-name">RabbitTemplate</span><span class="token plain"> rabbitTemplate</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * 发送消息到Fanout交换机</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sendMsg1FanoutBased</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token known-class-name class-name">String</span><span class="token plain"> msg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"我是云南大熊(Fanout), "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token maybe-class-name">DateUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 参数说明：参数1：交换机名称。  参数2：routing key  参数3：消息内容</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rabbitTemplate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">convertAndSend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"exchange-fanout"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"消息发送成功。{}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * 发送消息到Direct交换机</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sendMsg1DirectBased</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter known-class-name class-name">String</span><span class="token parameter"> routingKey</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token known-class-name class-name">String</span><span class="token plain"> msg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"我是云南大熊(Direct), "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token maybe-class-name">DateUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 参数说明：参数1：交换机名称。  参数2：routing key  参数3：消息内容</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rabbitTemplate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">convertAndSend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"exchange-direct"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> routingKey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"消息发送成功。{}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_S0QG"><p>发送消息到 Fanout 交换机时，路由键参数为空；发送消息到 Direct 交换机时候路由键根据上图（队列规划）传参。（如：Key-1、Key-2）。</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="消息消费者">消息消费者<a class="hash-link" href="#消息消费者" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本地配置-1">本地配置<a class="hash-link" href="#本地配置-1" title="标题的直接链接">​</a></h3><blockquote><p>为便于理解，本文基于本地配置的方式编写。若改为标准的 Nacos 配置中心模式，请参阅：<a href="https://xiongchun.github.io/pangu-framework/docs/advanced-guide/nacos-config-center" target="_blank" rel="noopener noreferrer">配置中心</a> 章节。</p></blockquote><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">application.properties</li><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">application-dev.properties</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">profiles</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">active</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">profiles</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">active</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">dev</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6"><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">application</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">mq</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">rabbitmq</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">receiver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rabbitmq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">host</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">jzaep3orxb2b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">public</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">tencenttdmq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">com</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rabbitmq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5672</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rabbitmq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">username</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rabbitmq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">password</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">123456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rabbitmq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">virtual</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">host</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">vhost</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">pangu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 开启</span><span class="token constant" style="color:#36acaa">ACK</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NONE</span><span class="token operator" style="color:#393A34">|</span><span class="token constant" style="color:#36acaa">MANUAL</span><span class="token operator" style="color:#393A34">|</span><span class="token constant" style="color:#36acaa">AUTO</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword module" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rabbitmq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">listener</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">simple</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">acknowledge</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">mode</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">manual</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">root</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">gitee</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pulanos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pangu</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">INFO</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="关键配置项说明">关键配置项说明<a class="hash-link" href="#关键配置项说明" title="标题的直接链接">​</a></h4><ul><li>消息确认模式配置项（<code>spring.rabbitmq.listener.simple.acknowledge-mode</code>）  <ul><li>NONE：无消息确认支持。消息一旦从队列取出即被永久删除。</li><li>AUTO：自动确认（缺省配置）。消费代码抛出异常则重新将消息放入队列，无异常则抛出则确认消费。</li><li>MANUAL：手工确认。如下代码根据业务逻辑进行手工确认消息。</li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="消息监听代码">消息监听代码<a class="hash-link" href="#消息监听代码" title="标题的直接链接">​</a></h3><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">Component</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Queue1Listener</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token maybe-class-name">RabbitHandler</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token function maybe-class-name" style="color:#d73a49">RabbitListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">queues </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"queue-1"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">receiveMsg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Message</span><span class="token plain"> message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token maybe-class-name">Channel</span><span class="token plain"> channel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> throws </span><span class="token maybe-class-name">IOException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        long deliveryTag </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> message</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getMessageProperties</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getDeliveryTag</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"接收消息(queue-1)：{}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">message</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getBody</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// do business...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            channel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">basicAck</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">deliveryTag</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Exception</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"消费出错了"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            channel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">basicNack</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">deliveryTag</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如上为 <code>queue-1</code> 的监听代码，其余类似。如果 ACK 消息确认模式为自动模式则消费代码不需要 <code>try</code> 结构。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="测试">测试<a class="hash-link" href="#测试" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="消费者启动消费监听程序">消费者：启动消费监听程序<a class="hash-link" href="#消费者启动消费监听程序" title="标题的直接链接">​</a></h3><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">SpringBootApplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">RabbitmqReceiverApplication</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter known-class-name class-name">String</span><span class="token parameter punctuation" style="color:#393A34">[</span><span class="token parameter punctuation" style="color:#393A34">]</span><span class="token parameter"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">PanGuApplicationBuilder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">RabbitmqReceiverApplication</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="生产者执行测试用例发送消息">生产者：执行测试用例发送消息<a class="hash-link" href="#生产者执行测试用例发送消息" title="标题的直接链接">​</a></h3><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 发送消息交换机</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">Test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sendMsg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//发送消息到Fanout交换机</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sendService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sendMsg1FanoutBased</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//发送消息到Direct交换机</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sendService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sendMsg1DirectBased</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"key-1"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//发送消息到Direct交换机</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sendService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sendMsg1DirectBased</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"key-2"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="测试结果截图">测试结果截图<a class="hash-link" href="#测试结果截图" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="生产者">生产者<a class="hash-link" href="#生产者" title="标题的直接链接">​</a></h4><p><img loading="lazy" alt="生产者" src="/assets/images/15-pangu-framework-queue-a46980fa9e9eee4f987202887fac4ade.png" width="2366" height="496" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="消费者">消费者<a class="hash-link" href="#消费者" title="标题的直接链接">​</a></h4><p><img loading="lazy" alt="消费者" src="/assets/images/16-pangu-framework-queue-17feb39cb253ed67c5e972b875193524.png" width="2116" height="376" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本文相关范例源码">本文相关范例源码<a class="hash-link" href="#本文相关范例源码" title="标题的直接链接">​</a></h2><ul><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-mq-rabbitmq-sender" target="_blank" rel="noopener noreferrer">pangu-examples-mq-rabbitmq-sender</a>：消息队列范例（生产者）</li><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-mq-rabbitmq-receiver" target="_blank" rel="noopener noreferrer">pangu-examples-mq-rabbitmq-receiver</a>：消息队列范例（消费者）</li></ul>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="服务端开发" term="服务端开发"/>
        <category label="盘古开发框架" term="盘古开发框架"/>
        <category label="消息队列" term="消息队列"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[基于 Mybatis Plus 的数据持久化 API 总结]]></title>
        <id>mybatis-plus-data-persistance-summary</id>
        <link href="https://xiongchun.github.io/blog/mybatis-plus-data-persistance-summary"/>
        <updated>2018-07-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[盘古开发框架 数据持久化 API 依赖 MyBatis Plus 提供。在 MyBatis 的基础上提供了强大的内置通用 Mapper CRUD 操作、支持 Lambda 表达式、内置屏蔽不通数据库方言差异的分页插件、自动填充字段值、多种主键自动生成策略、逻辑删除、乐观锁插件等。]]></summary>
        <content type="html"><![CDATA[<p><a href="https://github.com/xiongchun/pangu-framework" target="_blank" rel="noopener noreferrer">盘古开发框架</a> 数据持久化 API 依赖 MyBatis Plus 提供。在 MyBatis 的基础上提供了强大的内置通用 Mapper CRUD 操作、支持 Lambda 表达式、内置屏蔽不通数据库方言差异的分页插件、自动填充字段值、多种主键自动生成策略、逻辑删除、乐观锁插件等。</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><b>快速 QA：</b>可以支持兼容哪些数据库类型？</summary><div><div class="collapsibleContent_i85q"><div>与 MyBatis Plus 一致。支持所有 JDBC 标准数据库。分页方言兼容如下数据库： mysql、oracle、db2、h2、hsql、sqlite、postgresql、sqlserver、phoenix、gauss、clickhouse、sybase、oceanbase、firebird、cubrid、goldilocks、csiidb、达梦数据库、虚谷数据库、人大金仓数据库、南大通用(华库)数据库、南大通用数据库、神通数据库、瀚高数据库。</div></div></div></details><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装相关盘古模块">安装相关盘古模块<a class="hash-link" href="#安装相关盘古模块" title="标题的直接链接">​</a></h2><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">盘古 Parent</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">基础模块</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">JDBC 模块</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-parent</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">latest.version.xxx</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">relativePath</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-framework-jdbc-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本地配置">本地配置<a class="hash-link" href="#本地配置" title="标题的直接链接">​</a></h2><blockquote><p>为便于理解，本文基于本地配置的方式编写。若改为标准的Nacos配置中心模式，请参阅:<a href="https://xiongchun.github.io/pangu-framework/docs/advanced-guide/nacos-config-center" target="_blank" rel="noopener noreferrer">配置中心</a>章节。</p></blockquote><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">application.properties</li><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">application-dev.properties</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">profiles</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">active</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">profiles</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">active</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">dev</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6"><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">application</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">crud</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">zaxxer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">hikari</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">HikariDataSource</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">driver</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">class</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jdbc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">url</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">jdbc</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">localhost</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3306</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">?</span><span class="token plain">useUnicode</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">true</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">characterEncoding</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">utf</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">8</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">autoReconnect</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">true</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">failOverReadOnly</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">false</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">allowMultiQueries</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">true</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">useSSL</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">false</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rewriteBatchedStatements</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">username</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">password</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">root123456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mybatis</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mapperLocations</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">classpath</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mapper</span><span class="token comment" style="color:#999988;font-style:italic">/**/</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">xml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mybatis</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">configuration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">log</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">impl</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">org</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">apache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ibatis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">slf4j</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Slf4jImpl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 分页</span><span class="token constant" style="color:#36acaa">SQL</span><span class="token plain">方言数据库类型标识（缺省：自动识别）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pangu</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jdbc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">db</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">root</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">gitee</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pulanos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pangu</span><span class="token operator" style="color:#393A34">=</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">gitee</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pulanos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pangu</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">showcases</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">crud</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">dao</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">debug</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="生成持久化所需的模版代码">生成持久化所需的模版代码<a class="hash-link" href="#生成持久化所需的模版代码" title="标题的直接链接">​</a></h2><p>基于实践经验，我们建议使用盘古代码生成器，而不是使用 Mybatis Plus 官方生成器。关于生成代码相关内容，请参阅 <a href="https://xiongchun.github.io/pangu-framework/docs/code-generator" target="_blank" rel="noopener noreferrer">《代码生成器插件》</a> 章节，这里不再赘述。（针对每一个数据表会生成一个 <code>*Mapper.java</code> 文件和一个 <code>*Entity.java</code> 文件）</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="基本数据持久化操作">基本数据持久化操作<a class="hash-link" href="#基本数据持久化操作" title="标题的直接链接">​</a></h2><blockquote><p>这里只是给出几个简单典型的操作代码，更多内容请参阅范例或阅读 <a href="https://baomidou.com/pages/24112f/" target="_blank" rel="noopener noreferrer">Mybatis Plus 官方文档</a>。</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="新增">新增<a class="hash-link" href="#新增" title="标题的直接链接">​</a></h3><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token maybe-class-name">UserEntity</span><span class="token plain"> userEntity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">UserEntity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">userEntity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"XC"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setAge</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">18</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setUserType</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"1"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int row </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> userMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">insert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">userEntity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"成功插入{}条数据。{}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> row</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> userEntity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="修改">修改<a class="hash-link" href="#修改" title="标题的直接链接">​</a></h3><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//方式1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">userMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">updateById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">UserEntity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">1L</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"XC2"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//方式2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">LambdaUpdateWrapper</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">UserEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> updateWrapper = Wrappers.lambdaUpdate();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">updateWrapper.set(UserEntity::getAge, 100);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">updateWrapper.eq(UserEntity::getId, 2L);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">userMapper.update(null, updateWrapper);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">//方式2简写</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">userMapper.update(null, Wrappers.</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">UserEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">lambdaUpdate().set(UserEntity::getName, "XC2").eq(UserEntity::getId, 3L));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">//方式3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">UserEntity userEntity = new UserEntity();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">userEntity.setName("XC2");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">userMapper.update(userEntity, Wrappers.</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">UserEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">lambdaUpdate().eq(UserEntity::getId, 4L));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="删除">删除<a class="hash-link" href="#删除" title="标题的直接链接">​</a></h3><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//方式1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">userMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">deleteById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">1000L</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//方式2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">userMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">deleteBatchIds</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Arrays</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">asList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">1000L</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> 1001L</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//方式3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">userMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">delete</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Wrappers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">UserEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">lambdaQuery().ge(UserEntity::getAge, 150));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">userMapper.delete(Wrappers.lambdaQuery(UserEntity.class).ge(UserEntity::getAge, 150));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">//方式4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">userMapper.deleteById(new UserEntity().setId(2000L));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="简单查询">简单查询<a class="hash-link" href="#简单查询" title="标题的直接链接">​</a></h3><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//方式1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">UserEntity</span><span class="token plain"> userEntity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> userMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">selectById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">1L</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//方式2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">UserEntity</span><span class="token plain"> userEntity1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> userMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">selectOne</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Wrappers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">UserEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">lambdaQuery().eq(UserEntity::getId, 1L));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">//方式3 (需要注意对传入 ID 集合为非空判断，否则生成的 SQL in() 语法将报错)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">if(CollUtil.isNotEmpty(userIds))</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userEntities </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> userMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">selectBatchIds</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">userIds</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">//方式4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">LambdaQueryWrapper</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">UserEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> lambdaQueryWrapper = Wrappers.lambdaQuery();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">//动态组合查询条件的简便写法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">lambdaQueryWrapper.between(ObjectUtil.isNotEmpty(age), UserEntity::getAge, 1, age);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">lambdaQueryWrapper.eq(UserEntity::getUserType, "1");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">lambdaQueryWrapper.orderByDesc(UserEntity::getId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">List</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">UserEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> userEntities1 = userMapper.selectList(lambdaQueryWrapper);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">//方式5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">LambdaQueryWrapper</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">UserRoleEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> lambdaQueryWrapper = Wrappers.lambdaQuery();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">lambdaQueryWrapper.eq(UserRoleEntity::getUserId, userId).orderByDesc(UserRoleEntity::getRoleId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">List</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">UserRoleEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> userRoleEntities = userRoleMapper.selectList(lambdaQueryWrapper);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">List</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">Long</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> roleIds = userRoleEntities.stream().map(UserRoleEntity::getRoleId).collect(Collectors.toList());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">//方式6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">List&lt;Map&lt;String, Object&gt;&gt; userMaps = userMapper.selectMaps(Wrappers.</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">UserEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">lambdaQuery().eq(UserEntity::getUserType, "1"));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">//方式7 count 查询</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">Long cnt = userMapper.selectCount(Wrappers.</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">UserEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">lambdaQuery().le(UserEntity::getGmtCreate, DateUtil.date()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">//方式8 group 查询</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">QueryWrapper</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">UserEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> queryWrapper1 = Wrappers.query();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">queryWrapper1.select("age, count(id) as cnt").groupBy("age");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">List&lt;Map&lt;String, Object&gt;&gt; mapList = userMapper.selectMaps(queryWrapper1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">//方式9 or 查询</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">if (ObjectUtil.isNotEmpty(keyword))</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lambdaQueryWrapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">and</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">w </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> w</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">like</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token maybe-class-name">UserEntity</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">getName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> keyword</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">or</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">like</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">UserEntity</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">getUserName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> keyword</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">//方式10 指定查询字段</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">LambdaQueryWrapper</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">UserEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> lambdaQueryWrapper = Wrappers.lambdaQuery();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">lambdaQueryWrapper.select(UserEntity::getId, UserEntity::getUserName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">lambdaQueryWrapper.eq(...);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">//方式11 排除查询字段</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">lambdaQueryWrapper.select(UserEntity.class, info -&gt; !info.getColumn().equals("password") &amp;&amp; !info.getColumn().equals("password2"));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="分页查询">分页查询<a class="hash-link" href="#分页查询" title="标题的直接链接">​</a></h3><p>盘古框架已经做了 Mybatis Plus 分页插件的自动装配工作，直接使用即可。无需额外配置。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="基于-mapper-api-的分页查询">基于 Mapper API 的分页查询<a class="hash-link" href="#基于-mapper-api-的分页查询" title="标题的直接链接">​</a></h4><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">aPageQuery</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"MyBatisPlus API 分页查询数据..."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">Page</span><span class="token plain"> page </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Page</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">UserEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">(1,3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    userMapper.selectPage(page, Wrappers.</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">UserEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">lambdaQuery().ge(UserEntity::getAge, 10).orderByAsc(UserEntity::getId));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    Console.log("总数：{}", page.getTotal());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    List</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">UserEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> userEntities = page.getRecords();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    userEntities.forEach(System.out::println);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="基于手工映射-sql-的分页查询">基于手工映射 SQL 的分页查询<a class="hash-link" href="#基于手工映射-sql-的分页查询" title="标题的直接链接">​</a></h4><p>继续阅读本文后面的 <a href="#%E6%89%8B%E5%B7%A5%E7%BC%96%E5%86%99sql%E6%98%A0%E5%B0%84">《手工编写SQL映射》</a> 章节可以找到。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="一个完整的分页查询例子">一个完整的分页查询例子<a class="hash-link" href="#一个完整的分页查询例子" title="标题的直接链接">​</a></h4><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 分页入参对象</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">RoleIn</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">Page</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Controller</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:#d73a49">GetMapping</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/list"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token maybe-class-name">Result</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">PageResult</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">RoleEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">&gt; list(RoleIn roleIn) </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">PageResult</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">RoleEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> pageResult = roleService.list(roleIn);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    return Result.success(pageResult);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">// Service实现</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">public PageResult</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">RoleEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> list(RoleIn roleIn) </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">Page</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">RoleEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> page = PagingUtil.createPage(roleIn);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    LambdaQueryWrapper</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">RoleEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> lambdaQueryWrapper = Wrappers.lambdaQuery();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    lambdaQueryWrapper.like(ObjectUtil.isNotEmpty(roleIn.getName()), RoleEntity::getName, roleIn.getName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    roleMapper.selectPage(page, lambdaQueryWrapper);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    return PagingUtil.getPageResult(page);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="手工编写sql映射">手工编写SQL映射<a class="hash-link" href="#手工编写sql映射" title="标题的直接链接">​</a></h3><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_S0QG"><p>一般来说在日常开发中我们是不需要再编写SQL代码的，Mapper API已经能满足我们的需求了。但对于一些特殊需求，我们也可以手工写SQL映射的方式来处理。如下范例演示了手工SQL查询的操作，新增、修改、删除也是同理。</p></div></div><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">bPageQuery</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"自定义SQL映射分页查询数据..."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">Page</span><span class="token plain"> page </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Page</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">UserEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">(1,3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    Map&lt;String, Object&gt; params = Maps.newHashMap();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    params.put("userType", "1");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    List</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">UserEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> userEntities = crudMapper.listUsersByPage(page, params);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    Console.log("总数：{}", page.getTotal());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    userEntities.forEach(System.out::println);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">public void cPageQuery()</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"自定义SQL映射分页查询数据..."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">Page</span><span class="token plain"> page </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Page</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token known-class-name class-name">Map</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token known-class-name class-name">String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token known-class-name class-name">String</span><span class="token plain"> userType </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"1"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">List</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token known-class-name class-name">Map</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token known-class-name class-name">String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> userMaps </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> crudMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">listUserMapsByPage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">page</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> userType</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">Console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"总数：{}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> page</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getTotal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userMaps</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">out</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">println</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">public void bSelect() </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"自定义SQL映射查询数据..."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token known-class-name class-name">Map</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token known-class-name class-name">String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Maps</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">newHashMap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    params</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"userType"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"1"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">List</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">UserEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> userEntities = crudMapper.listUsersByMap(params);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    userEntities.forEach(System.out::println);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/main/java/com/gitee/pulanos/pangu/showcases/crud/dao/mapper/CrudMapper.java</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 提示：自定义sql手工映射大部分时候为复杂的多表联合查询的SQL，单表操作都应该统一使用mybatis plus的API</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token maybe-class-name">Mapper</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">CrudMapper</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">List</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">UserEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> listUsersByPage(Page</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">UserEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> page, Map&lt;String, Object&gt; param);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    List&lt;Map&lt;String, Object&gt;&gt; listUserMapsByPage(Page&lt;Map&lt;String, Object&gt;&gt; page, String userType);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    List</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">UserEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"> listUsersByMap(Map&lt;String, Object&gt; param);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/main/resources/mapper/CrudMapper.xml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">mapper</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">namespace</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">com.gitee.pulanos.pangu.showcases.crud.dao.mapper.CrudMapper</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">&lt;!-- 分页查询 --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">select</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">listUsersByPage</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">resultType</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">com.gitee.pulanos.pangu.showcases.crud.dao.entity.UserEntity</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    select id,name,age,user_type,gmt_create,gmt_update from user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">where</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">if</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">test</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">param.userType!=null and param.userType!=</span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">            user_type = #</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">param</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">userType</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">if</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">where</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    ORDER BY id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">select</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">&lt;!-- 分页查询 --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">select</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">listUserMapsByPage</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">resultType</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">java.util.Map</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    select age, count(id) as userCnt from user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">where</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">if</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">test</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">userType!=null and userType!=</span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">            user_type = #</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">userType</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">if</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">where</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    GROUP BY age</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    ORDER BY age DESC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">select</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">&lt;!-- 普通查询 --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">select</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">listUsersByMap</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">resultType</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">com.gitee.pulanos.pangu.showcases.crud.dao.entity.UserEntity</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    select id,name,age,user_type,gmt_create,gmt_update from user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">where</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">if</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">test</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">userType!=null and userType!=</span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">            user_type = #</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">userType</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">if</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">where</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">select</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">mapper</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="高级特性">高级特性<a class="hash-link" href="#高级特性" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="事务">事务<a class="hash-link" href="#事务" title="标题的直接链接">​</a></h3><p>单一数据源事务，直接使用 Spring 事务相关注解即可（ <code>@EnableTransactionManagement</code>、<code>@Transactional</code> ）。对于分布式事务请参阅 <a href="https://xiongchun.github.io/pangu-framework/docs/advanced-guide/distributed-transaction" target="_blank" rel="noopener noreferrer">《分布式事务》</a> 章节。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="逻辑删除">逻辑删除<a class="hash-link" href="#逻辑删除" title="标题的直接链接">​</a></h3><p>盘古框架借助 Mybatis Plus 对逻辑删除提供了非常友好的支持。通过如下简单配置即可实现从物理删除到逻辑删除在 CRUD 上面的无感体验。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 指定逻辑删除的标识字段</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mybatis</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">global</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">db</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">logic</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">delete</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">field</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">deleted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 删除前的缺省值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mybatis</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">global</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">db</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">logic</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">not</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">delete</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">value</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 删除后的值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mybatis</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">global</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">db</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">logic</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">delete</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">value</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">id</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置说明">配置说明<a class="hash-link" href="#配置说明" title="标题的直接链接">​</a></h4><ul><li>逻辑删除字段 deleted 建议通过数据库设置默认值 0。</li><li>删除后的值建议不用 1，这会带来某字段需要唯一索引时的尴尬问题。因此建议将删除后的值更新为当前记录的 ID 字段值，如上配置所示。这时如果表中某字段需要建立唯一索引，则可以和 deleted 字段一起创建联合唯一索引。</li><li>查询和更新操作，框架会自动拼接逻辑删除字段作为条件。（AND deleted = 0）</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本文相关范例源码">本文相关范例源码<a class="hash-link" href="#本文相关范例源码" title="标题的直接链接">​</a></h2><ul><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-crud" target="_blank" rel="noopener noreferrer">pangu-examples-crud</a>：数据持久化参考范例</li></ul>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="服务端开发" term="服务端开发"/>
        <category label="盘古开发框架" term="盘古开发框架"/>
        <category label="数据持久化" term="数据持久化"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[盘古开发框架代码生成器基本应用]]></title>
        <id>pangu-dev-framework-code-generator</id>
        <link href="https://xiongchun.github.io/blog/pangu-dev-framework-code-generator"/>
        <updated>2018-05-28T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[盘古开发框架 代码生成器是基于 Maven 的一个自定义插件。可以方便快捷的以插件的方式安装到任何一个 Maven 模块中去。目前支持生成如下代码。]]></summary>
        <content type="html"><![CDATA[<p><a href="https://github.com/xiongchun/pangu-framework" target="_blank" rel="noopener noreferrer">盘古开发框架</a> 代码生成器是基于 Maven 的一个自定义插件。可以方便快捷的以插件的方式安装到任何一个 Maven 模块中去。目前支持生成如下代码。</p><ul><li>MyBatis Plus Mapper.java 映射接口文件</li><li>MyBatis Plus Entity.java 实体文件</li></ul><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>建议</div><div class="admonitionContent_S0QG"><p>根据实践经验，不建议使用 MyBatis Plus 的生成器，更不建议生成 Mybatis Plus 风格的 Service 文件。</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装-maven-插件">安装 Maven 插件<a class="hash-link" href="#安装-maven-插件" title="标题的直接链接">​</a></h2><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">pom.xml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">com.gitee.pulanos.pangu</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">pangu-framework-generator-maven-plugin</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">5.0.6</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">jdbc:mysql://127.0.0.1:3306/pangu-showcases</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">user</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">root</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">user</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">password</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">root123456</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">password</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">tables</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">user,resource</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">tables</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">author</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">xiongchun</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">author</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">entityFilePath</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">project</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">basedir</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text">/src/main/java/com/gitee/pulanos/pangu/showcases/crud/dao/entity</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">entityFilePath</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">mapperFilePath</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">project</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">basedir</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text">/src/main/java/com/gitee/pulanos/pangu/showcases/crud/dao/mapper</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">mapperFilePath</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="插件参数说明">插件参数说明<a class="hash-link" href="#插件参数说明" title="标题的直接链接">​</a></h3><table><thead><tr><th><div style="width:120px">配置项</div></th><th>配置说明</th></tr></thead><tbody><tr><td>url</td><td>数据库连接地址</td></tr><tr><td>user</td><td>数据库用户名</td></tr><tr><td>password</td><td>数据库密码</td></tr><tr><td>tables</td><td>目标数据库表，多个表用逗号分割</td></tr><tr><td>author</td><td>源代码文件的作者签名</td></tr><tr><td>entityFilePath</td><td>实体类文件输出路径（根据此路径推导包结构）</td></tr><tr><td>mapperFilePath</td><td>Mapper 类文件输出路径（根据此路径推导包结构）</td></tr></tbody></table><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_S0QG"><ul><li>上表中输出路径参数可以是基于 ${project.basedir} 的相对路径，也可以是绝对路径。</li><li>微服务开发中实体类文件一般是生成到服务接口包里，与服务消费方共享。（可以在接口包模块安装此插件，或者在服务实现模块将实体类生成路径直接指向接口包）</li></ul></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="运行maven插件">运行Maven插件<a class="hash-link" href="#运行maven插件" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="方式一">方式一<a class="hash-link" href="#方式一" title="标题的直接链接">​</a></h3><p>通过 IDEA 或 Eclipse 等开发工具来执行名为 <code>pangu</code> 的 Maven 插件。如下图所示。</p><img loading="lazy" width="500" src="/assets/images/13-pangu-framework-generator-1b1785f2701023393ecf019f5eb02f1e.png" alt="盘古代码生成器" class="img_ev3q"><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="方式二">方式二<a class="hash-link" href="#方式二" title="标题的直接链接">​</a></h3><p>通过 Mavne 脚本执行。如下所示。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">命令行脚本</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd pom</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">xml所在的更目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mvn pangu</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">generate</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="输出结果">输出结果<a class="hash-link" href="#输出结果" title="标题的直接链接">​</a></h3><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">控制台输出日志</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">xc@xc</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">mac pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">crud </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> mvn pangu</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">generate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token maybe-class-name">Scanning</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> projects</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">gitee</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pulanos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pangu</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">crud </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token maybe-class-name">Building</span><span class="token plain"> pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">crud </span><span class="token number" style="color:#36acaa">1.0</span><span class="token number" style="color:#36acaa">.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> jar </span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">framework</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">generator</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">maven</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plugin</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">5.0</span><span class="token number" style="color:#36acaa">.6</span><span class="token operator" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">generate</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword module" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">cli</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> @ pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">crud </span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> 开始生成数据表</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">user</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">对应的实体对象</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token maybe-class-name">UserEntity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">java</span><span class="token plain"> 生成成功。文件路径：</span><span class="token operator" style="color:#393A34">/</span><span class="token maybe-class-name">Users</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">xc</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">git2</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">framework</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">crud</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">src</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">main</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">java</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">com</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">gitee</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pulanos</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">showcases</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">crud</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">dao</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">entiity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">java</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> 开始生成数据表</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">user</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">对应的数据访问接口</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token maybe-class-name">UserMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">java</span><span class="token plain"> 生成成功。文件路径：</span><span class="token operator" style="color:#393A34">/</span><span class="token maybe-class-name">Users</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">xc</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">git2</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">framework</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">examples</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">crud</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">src</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">main</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">java</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">com</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">gitee</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pulanos</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pangu</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">showcases</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">crud</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">dao</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mapper</span><span class="token operator" style="color:#393A34">/</span><span class="token maybe-class-name">UserMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">java</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">BUILD</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SUCCESS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token maybe-class-name">Total</span><span class="token plain"> time</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">1.291</span><span class="token plain"> s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token maybe-class-name">Finished</span><span class="token plain"> at</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2021</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">11</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">15T21</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">54</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">22</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">08</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">00</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">INFO</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本文相关范例源码">本文相关范例源码<a class="hash-link" href="#本文相关范例源码" title="标题的直接链接">​</a></h2><ul><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-crud" target="_blank" rel="noopener noreferrer">pangu-examples-crud</a>：数据持久化参考范例（含代码生成器演示）</li><li><a href="https://gitee.com/xiong-chun/pangu-framework/tree/master/pangu-examples/pangu-examples-dubbo-api" target="_blank" rel="noopener noreferrer">pangu-examples-dubbo-api</a>：服务接口包（含代码生成器演示）</li></ul>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="服务端开发" term="服务端开发"/>
        <category label="盘古开发框架" term="盘古开发框架"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[开源十年，AOSuite 开发平台停止维护 [EOL]]]></title>
        <id>aosuite-eol</id>
        <link href="https://xiongchun.github.io/blog/aosuite-eol"/>
        <updated>2018-05-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[AOSuite 是我在 2006 - 2016 年间开发和维护的一节开源项目。那还是一个 jQuery UI 和 ExtJS 横行的年代。现在想来还满满都是回忆。随着前端技术的发展和后端微服务技术的流行，AOSuite 到了该退场的时候了。撰写此文也仅做备忘和回忆往年往事罢了。]]></summary>
        <content type="html"><![CDATA[<p><a href="https://gitee.com/xiong-chun/AOSuite" target="_blank" rel="noopener noreferrer">AOSuite</a> 是我在 2006 - 2016 年间开发和维护的一节开源项目。那还是一个 jQuery UI 和 ExtJS 横行的年代。现在想来还满满都是回忆。随着前端技术的发展和后端微服务技术的流行，AOSuite 到了该退场的时候了。撰写此文也仅做备忘和回忆往年往事罢了。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="简介">简介<a class="hash-link" href="#简介" title="标题的直接链接">​</a></h2><p>AOSuite 开发套件基于 JavaEE 技术体系，以“标准功能可复用、通用模块可配置、行业需求快速开发、异构系统无缝集成”为目标， 帮助企业落实IT策略、屏蔽技术壁垒，快速实现可水平扩展的高性能高可用业务愿景。 为传统软件企业和互联网企业研发团队提供高效可控、随需应变、快速实现业务需求的全栈式技术解决方案，以最低成本和最低风险获得更高质量、更快交付业务和运维支持的核心技术竞争力。项目封印归档地址：<a href="https://gitee.com/xiong-chun/AOSuite" target="_blank" rel="noopener noreferrer">https://gitee.com/xiong-chun/AOSuite</a>。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="适用场景">适用场景<a class="hash-link" href="#适用场景" title="标题的直接链接">​</a></h2><p>AOSuite 以开发传统应用系统为主并一定程度兼顾了互联网应用场景的需求，适合构建和开发中大型企业应用管理系统、各级政务信息化系统、银行保险医疗等传统行业管理系统；也具备构建基于(移动)互联网面向C端的各类电商、P2P 网贷、理财、小贷、社交等 APP 后端接口服务、面向B端的商户管理系统、 面向运营企业的后台管理系统。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="技术特点">技术特点<a class="hash-link" href="#技术特点" title="标题的直接链接">​</a></h2><ul><li>ExtJS without JS。平台缺省主题主要依赖 ExtJS 库，但经过了深度封装和 JSP 自定义标签化，可使得开发人员脱离繁琐的 Html、CSS、JS 编程也能开发出标准化的风格界面、使用统一的组件事件响应模型。</li><li>原生支持集群部署模式。抛弃 Servlet 容器会话依赖，使用 Redis 集中模式的请求状态管理使得平台对集群部署结构非常友好，达到单体应用的高性能和高可用集群部署方案的最佳实践。</li><li>核心依赖主流经典正统。核心依赖使用 SpringMVC-MyBatis 的组合，主流、经典、正统，开发人员积累储备的经验技能可以得到最大化的复用和升值。</li><li>大量模版代码自动生成。</li><li>完善的权限管理系统。平台内置完善的权限管理系统，涵盖用户、部门、资源、监控等系统管理模块开箱即用，大大节约开发成本，让开发人员专心于具体业务实现。</li><li>长期实践，久经考验。平台已在各行业各类型项目经过大量的实战检验。虽已久经考验，规避了大小坑无数。但，我相信总有一个还属于你......</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="历史局限性">历史局限性<a class="hash-link" href="#历史局限性" title="标题的直接链接">​</a></h2><ul><li><p>关于前端。目前基于 ExtJS 的 AOSUI 标签库所带来一致的界面风格和交互体验以及容易上手快速开发的特点一直是我们的优势，加之多年来我们在这套前端 UI 体系上已经有了大量的经验和积累。但其劣势也是明显的，比如视觉体验相对传统古板，不善于开发一些脱离标准模版而随意定制的复杂或非标准界面等。</p></li><li><p>关于后端。AOSuite目前后端结构为集中式单体应用的开发模式，对于分布式的支持可以使用反向代理软负载机制部署多个单体集群节点实现一定程度的高性能和高可用。这种模式在服务治理如服务模块化、服务注册、服务发现、服务管理监控、弹性容量规划、灵活扩展性等方面并非很友好。</p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="发展方向">发展方向<a class="hash-link" href="#发展方向" title="标题的直接链接">​</a></h2><p>鉴于上述局限性，加之近年来，各种前端技术琳琅满目层出不穷；后端微服务技术趋于成熟，dubbo 之类的分布式服务治理框架得到广泛使用，spring cloud 也开始流行；云计算深入人心，云端技术得到普遍认可和接受。正所谓这是一个最坏的时代，技术的发展和革新，不得不随时要刷新我们的技术栈、系统架构、开发方法、部署运维方式等；但换一个角度看，这也是一个最好的时代。在苦于变化的同时，也让我们具备了更多的技术手段、方法来解决更多的问题，扩展我们的想象空间。因此，我决定结束 AOSuite 生命周期，于现在主流前后端技术栈重构一个新的开源项目 —— <a href="https://xiongchun.github.io/pangu-framework" target="_blank" rel="noopener noreferrer">盘古开发框架</a>，欢迎大家围观。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="我的十年开源图鉴">我的十年开源图鉴<a class="hash-link" href="#我的十年开源图鉴" title="标题的直接链接">​</a></h2><p><img loading="lazy" alt="AOSuite" src="/assets/images/1-b28882a8f4dcb1117f451721a22321ef.jpeg" width="1600" height="803" class="img_ev3q"></p><p><img loading="lazy" alt="AOSuite" src="/assets/images/2-5886d2329360aa31459772cfd0eb1416.gif" width="1220" height="782" class="img_ev3q"></p><p><img loading="lazy" alt="AOSuite" src="/assets/images/3-33fa76a046879b5c83be311c7fc6d9ed.gif" width="1288" height="816" class="img_ev3q"></p><p><img loading="lazy" alt="AOSuite" src="/assets/images/4-c5fef3d3cbd725c880838ddb75f8e655.jpg" width="1326" height="806" class="img_ev3q"></p><p><img loading="lazy" alt="AOSuite" src="/assets/images/5-ec73ddb8835120b60232e6f181c99ea6.jpeg" width="1176" height="640" class="img_ev3q"></p><p><img loading="lazy" alt="AOSuite" src="/assets/images/7-3b749e2936892c0b02ac244116932181.jpg" width="1538" height="837" class="img_ev3q"></p><p><img loading="lazy" alt="AOSuite" src="/assets/images/8-39406c3f31d118baeff0fbedfe31d13e.jpg" width="1326" height="806" class="img_ev3q"></p><p><img loading="lazy" alt="AOSuite" src="/assets/images/9-39406c3f31d118baeff0fbedfe31d13e.jpg" width="1326" height="806" class="img_ev3q"></p>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="技术杂文" term="技术杂文"/>
        <category label="服务端开发" term="服务端开发"/>
        <category label="前端开发" term="前端开发"/>
        <category label="AOSuite" term="AOSuite"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[关于跨域问题的总结]]></title>
        <id>summary-crossorigin</id>
        <link href="https://xiongchun.github.io/blog/summary-crossorigin"/>
        <updated>2018-01-22T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[关于「跨域」的一些基础知识这里就不讨论了，如果需要先充电的同学请移步这里看看：跨域资源共享 CORS 详解。在这里，我就直接抛出问题：由于浏览器出于安全目的而制定的 同源策略，导致 Web 页面通过 XMLHttpRequest 发起 ajax 请求的时候，如果访问非同源服务接口，则报错：has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource。]]></summary>
        <content type="html"><![CDATA[<p>关于「跨域」的一些基础知识这里就不讨论了，如果需要先充电的同学请移步这里看看：<a href="http://www.ruanyifeng.com/blog/2016/04/cors.html" target="_blank" rel="noopener noreferrer">跨域资源共享 CORS 详解</a>。在这里，我就直接抛出问题：由于浏览器出于安全目的而制定的 <a href="http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html" target="_blank" rel="noopener noreferrer">同源策略</a>，导致 Web 页面通过 XMLHttpRequest 发起 ajax 请求的时候，如果访问非同源服务接口，则报错：has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource。</p><blockquote><p>言外之意：“跨域”是针对网页中通过 XMLHttpRequest 对象发起的 ajax 请求才会出现的问题。在 Android 和 IOS 原生开发、基于 http 的微服务与微服务之间的调用都是不存在跨域问题的。这点需要先厘清楚。</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="跨域问题常用解决办法">跨域问题常用解决办法<a class="hash-link" href="#跨域问题常用解决办法" title="标题的直接链接">​</a></h2><p>归纳起来，解决跨域问题有两种基本的思路。</p><ul><li>一种就是在跨域的基础上本质都是要往 response 的头信息中追加 <code>Access-Control-*</code> 相关的属性。这种思路根据不同的上下文环境，也只是实现方式不同而已。</li><li>一种就是规避出现跨域环境，也就是在部署阶段将前后端部署在同一个域下。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="方法一强撸追加-access-control-">方法一：强撸追加 Access-Control-*<a class="hash-link" href="#方法一强撸追加-access-control-" title="标题的直接链接">​</a></h3><p>这是一种最简单粗暴也很有效的方法。即在能获取 HttpServletResponse 对象的上下文环境中，使用 response.addHeader(); 方法来增加 <code>Access-Control-*</code> 相关属性。这种上下文有可能是具体的某个 Controller 方法，也可以是原生 Servlet 环境亦或是 Struts、SpringMVC 的过滤器、拦截器等。下面以 SpringMVC 的拦截器举例说明。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">CrossOriginInterceptor</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">HandlerInterceptorAdapter</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token maybe-class-name">Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> boolean </span><span class="token function" style="color:#d73a49">preHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">HttpServletRequest</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token maybe-class-name">HttpServletResponse</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token plain"> handler</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throws </span><span class="token maybe-class-name">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getHeader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">HttpHeaders</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">ORIGIN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addHeader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Access-Control-Allow-Origin"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"*"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addHeader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Access-Control-Allow-Credentials"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"true"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addHeader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Access-Control-Allow-Methods"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"POST, GET, OPTIONS"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addHeader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Access-Control-Max-Age"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"86400"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="方法二注解追加-access-control-">方法二：注解追加 Access-Control-*<a class="hash-link" href="#方法二注解追加-access-control-" title="标题的直接链接">​</a></h3><p>在 SpringMVC 的环境下，我们也可以在 Controller 的类上或方法使用 @CrossOrigin 注解来实现跨域，<code>Access-Control-*</code> 相关属性也会自动的追加到 response 头信息里去。  </p><blockquote><p>这种方式的优劣是很明显的，大家根据实际情况酌情使用。@CrossOrigin (<del>如果需要，这里可以设置具体属性值</del>)：@CrossOrigin(value="*", allowCredentials="true")</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="方法三网关追加-access-control-">方法三：网关追加 Access-Control-*<a class="hash-link" href="#方法三网关追加-access-control-" title="标题的直接链接">​</a></h3><p>这是在微服务开发中特有的一种方式，具体配置方式根据不同的网关框架而定。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="方法四通过部署来规避跨域">方法四：通过部署来规避跨域<a class="hash-link" href="#方法四通过部署来规避跨域" title="标题的直接链接">​</a></h3><p>同步部署规划，可以有效规避跨域问题的出现。比如，如下盘古通用权限参考实现系统的部署方法。</p><ul><li><a href="https://pangu-admin.pulanit.com" target="_blank" rel="noopener noreferrer">https://pangu-admin.pulanit.com</a> 部署前端资源</li><li><a href="https://pangu-admin.pulanit.com/api" target="_blank" rel="noopener noreferrer">https://pangu-admin.pulanit.com/api</a> 代理后端服务  </li></ul><p>如上，则可将前后端部署在同一个域下从而有效避免了跨域问题。</p>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="技术杂文" term="技术杂文"/>
        <category label="客户端开发" term="客户端开发"/>
        <category label="Web" term="Web"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[中文文档排版指南]]></title>
        <id>chinese-copywriting-guidelines</id>
        <link href="https://xiongchun.github.io/blog/chinese-copywriting-guidelines"/>
        <updated>2018-01-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[编制此排版指南的目的是统一和优化相关中文文案排版格式，降低用户阅读成本，增强网站气质，提升品牌影响力。]]></summary>
        <content type="html"><![CDATA[<p>编制此排版指南的目的是统一和优化相关中文文案排版格式，降低用户阅读成本，增强网站气质，提升品牌影响力。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="空格">空格<a class="hash-link" href="#空格" title="标题的直接链接">​</a></h2><p>「有研究显示，打字时候不喜欢在中文和英文之间加空格的人，感情路都走得很辛苦。有七成的比例会在 34 岁的时候跟自己不爱的人结婚，而其余三成的人最后只能把遗产留给自己的猫。毕竟爱情跟书写都需要适时地留白。」摘录自 <a href="https://github.com/vinta/pangu.js#readme" target="_blank" rel="noopener noreferrer">vinta/pangu.js</a>。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="中英文之间增加空格">中英文之间增加空格<a class="hash-link" href="#中英文之间增加空格" title="标题的直接链接">​</a></h3><p><strong>正确</strong> </p><blockquote><p>盘古开发框架基于 Apache-2.0 协议开源发布，且是免费的。</p></blockquote><p><strong>错误</strong></p><blockquote><p>盘古开发框架基于Apache-2.0协议开源发布，且是免费的。</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="中文与数字之间增加空格">中文与数字之间增加空格<a class="hash-link" href="#中文与数字之间增加空格" title="标题的直接链接">​</a></h3><p><strong>正确</strong> </p><blockquote><p>盘古开发框架在 GitEE 网站上已经有 2500 个 Stars 了。</p></blockquote><p><strong>错误</strong></p><blockquote><p>盘古开发框架在 GitEE 网站上已经有2500个 Stars 了。</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="数字与单位之间增加空格">数字与单位之间增加空格<a class="hash-link" href="#数字与单位之间增加空格" title="标题的直接链接">​</a></h3><p><strong>正确</strong> </p><blockquote><p>我的计算机有 16 GB 内存和 512 GB 固态存储。</p></blockquote><p><strong>错误</strong></p><blockquote><p>我的计算机有 16GB 内存和 512GB 固态存储。</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="链接与字符之间增加空格">链接与字符之间增加空格<a class="hash-link" href="#链接与字符之间增加空格" title="标题的直接链接">​</a></h3><p><strong>正确</strong> </p><blockquote><p>通过我们的 <a href="https://xiongchun.github.io/pangu-framework/community" target="_blank" rel="noopener noreferrer">开发者社区</a> 寻求更多帮助。</p></blockquote><p><strong>错误</strong></p><blockquote><p>通过我们的<a href="https://xiongchun.github.io/pangu-framework/community" target="_blank" rel="noopener noreferrer">开发者社区</a>寻求更多帮助。</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="全角标点与字符之间不加空格">全角标点与字符之间不加空格<a class="hash-link" href="#全角标点与字符之间不加空格" title="标题的直接链接">​</a></h3><p><strong>正确</strong> </p><blockquote><p>我自从用上了 Manjaro Linux，再也不用面对 Windows 恶心的蓝屏了。</p></blockquote><p><strong>错误</strong></p><blockquote><p>我自从用上了 Manjaro Linux ，再也不用面对 Windows 恶心的蓝屏了。</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="标点符号">标点符号<a class="hash-link" href="#标点符号" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="不重复使用标点符号">不重复使用标点符号<a class="hash-link" href="#不重复使用标点符号" title="标题的直接链接">​</a></h3><p><strong>正确</strong> </p><blockquote><p>大熊，你的程序怎么又出 bug 了？</p></blockquote><blockquote><p>大熊尽然说：让我重启电脑试试？！</p></blockquote><p><strong>错误</strong></p><blockquote><p>大熊，你的程序怎么又出 bug 了？？？</p></blockquote><blockquote><p>大熊尽然说：让我重启电脑试试？！！</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="中文使用全角标点">中文使用全角标点<a class="hash-link" href="#中文使用全角标点" title="标题的直接链接">​</a></h3><p><strong>正确</strong> </p><blockquote><p>嗨！你知道吗？今天前台的小妹跟我说「喵」了哎！</p></blockquote><p><strong>错误</strong></p><blockquote><p>嗨! 你知道嘛? 今天前台的小妹跟我说 “喵” 了哎!</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="英文使用半角标点">英文使用半角标点<a class="hash-link" href="#英文使用半角标点" title="标题的直接链接">​</a></h3><p><strong>正确</strong> </p><blockquote><p>乔布斯那句话是怎么说的？「Stay hungry, Stay foolish.」</p></blockquote><p><strong>错误</strong></p><blockquote><p>乔布斯那句话是怎么说的？「Stay hungry，Stay foolish。」</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="名词">名词<a class="hash-link" href="#名词" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用正确的大小写">使用正确的大小写<a class="hash-link" href="#使用正确的大小写" title="标题的直接链接">​</a></h3><p>大小写相关用法原属于英文书写范畴，但部分专有名词以其官方书写规范为准。（如：GitEE、GitHub、PanGu Dev Framework等）</p><p><strong>正确</strong> </p><blockquote><p>盘古开发框架（PanGu Dev Framework）的代码托管到了国内 Gitee 和 国外 GitHub 平台。</p></blockquote><p><strong>错误</strong></p><blockquote><p>盘古开发框架（Pangu Dev Framework）的代码托管到了国内 gitee 和 国外 Github 平台。</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="不使用不地道的缩写">不使用不地道的缩写<a class="hash-link" href="#不使用不地道的缩写" title="标题的直接链接">​</a></h3><p><strong>正确</strong> </p><blockquote><p>我们需要一位熟悉 JavaScript、HTML5、Element Plus 和 PanGu Dev Framework 的全栈开发者。</p></blockquote><p><strong>错误</strong></p><blockquote><p>我们需要一位熟悉 Js、h5、element+ 和 PGDF 的全栈开发者。</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="其它">其它<a class="hash-link" href="#其它" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="段首不缩进">段首不缩进<a class="hash-link" href="#段首不缩进" title="标题的直接链接">​</a></h3><p><strong>正确</strong> </p><blockquote><p>盘古开发框架是完全独立于 Spring Cloud 生态的一套轻量灵活、成熟可靠的工业级分布式微服务开发和治理框架（兼容垂直单体分层架构)。它基于 <a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener noreferrer">Apache-2.0</a> 协议<strong>开源</strong>发布，且是<strong>免费</strong>的。</p></blockquote><p><strong>错误</strong></p><blockquote><p>&nbsp;<!-- -->&nbsp;<!-- -->&nbsp;<!-- -->&nbsp;<!-- -->&nbsp;<!-- -->&nbsp;<!-- -->&nbsp;<!-- -->&nbsp;<!-- -->盘古开发框架是完全独立于 Spring Cloud 生态的一套轻量灵活、成熟可靠的工业级分布式微服务开发和治理框架（兼容垂直单体分层架构)。它基于 <a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener noreferrer">Apache-2.0</a> 协议<strong>开源</strong>发布，且是<strong>免费</strong>的。</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="参考文献">参考文献<a class="hash-link" href="#参考文献" title="标题的直接链接">​</a></h2><ul><li><a href="https://github.com/sparanoid/chinese-copywriting-guidelines/blob/master/README.zh-Hans.md" target="_blank" rel="noopener noreferrer">sparanoid/chinese-copywriting-guidelines</a></li><li><a href="https://github.com/vinta/pangu.js#readme" target="_blank" rel="noopener noreferrer">vinta/pangu.js</a></li></ul>]]></content>
        <author>
            <name>程序员老熊</name>
            <uri>https://xiongchun.github.io</uri>
        </author>
        <category label="技术杂文" term="技术杂文"/>
    </entry>
</feed>